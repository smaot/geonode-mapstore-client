(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[38225],{415107:(t,e,i)=>{"use strict";i.d(e,{Z:()=>h});var s=i(624969),n=i(859900),r=i(85386),o=i(102022);class a extends s.Z{constructor(t,e,i,s,n,r){super(t,e,r),this.crossOrigin_=s,this.src_=i,this.key=i,this.image_=new Image,null!==s&&(this.image_.crossOrigin=s),this.unlisten_=null,this.tileLoadFunction_=n}getImage(){return this.image_}setImage(t){this.image_=t,this.state=n.Z.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=n.Z.ERROR,this.unlistenImage_(),this.image_=function(){const t=(0,r.E4)(1,1);return t.fillStyle="rgba(0,0,0,0)",t.fillRect(0,0,1,1),t.canvas}(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=n.Z.LOADED:this.state=n.Z.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==n.Z.ERROR&&(this.state=n.Z.IDLE,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==n.Z.IDLE&&(this.state=n.Z.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=(0,o.K)(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}const h=a},624969:(t,e,i)=>{"use strict";i.d(e,{Z:()=>l});var s=i(66575),n=i(173381),r=i(859900),o=i(949179),a=i(286320);class h extends s.Z{constructor(t,e,i){super(),i=i||{},this.tileCoord=t,this.state=e,this.interimTile=null,this.key="",this.transition_=void 0===i.transition?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(n.Z.CHANGE)}release(){this.state===r.Z.ERROR&&this.setState(r.Z.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){if(!this.interimTile)return this;let t=this.interimTile;do{if(t.getState()==r.Z.LOADED)return this.transition_=0,t;t=t.interimTile}while(t);return this}refreshInterimChain(){if(!this.interimTile)return;let t=this.interimTile,e=this;do{if(t.getState()==r.Z.LOADED){t.interimTile=null;break}t.getState()==r.Z.LOADING?e=t:t.getState()==r.Z.IDLE?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==r.Z.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){(0,o.O3)()}getAlpha(t,e){if(!this.transition_)return 1;let i=this.transitionStarts_[t];if(i){if(-1===i)return 1}else i=e,this.transitionStarts_[t]=i;const s=e-i+1e3/60;return s>=this.transition_?1:(0,a.YQ)(s/this.transition_)}inTransition(t){return!!this.transition_&&-1!==this.transitionStarts_[t]}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}}const l=h},19473:(t,e,i)=>{"use strict";i.d(e,{T:()=>n,Z:()=>r});class s{constructor(t,e,i,s){this.minX=t,this.maxX=e,this.minY=i,this.maxY=s}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function n(t,e,i,n,r){return void 0!==r?(r.minX=t,r.maxX=e,r.minY=i,r.maxY=n,r):new s(t,e,i,n)}const r=s},859900:(t,e,i)=>{"use strict";i.d(e,{Z:()=>s});const s={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4}},935594:(t,e,i)=>{"use strict";i.d(e,{Z:()=>o});var s=i(677701),n=i(71534);class r extends s.Z{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.setPreload(void 0!==t.preload?t.preload:0),this.setUseInterimTilesOnError(void 0===t.useInterimTilesOnError||t.useInterimTilesOnError)}getPreload(){return this.get(n.Z.PRELOAD)}setPreload(t){this.set(n.Z.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(n.Z.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(n.Z.USE_INTERIM_TILES_ON_ERROR,t)}getData(t){return super.getData(t)}}const o=r},438225:(t,e,i)=>{"use strict";i.d(e,{Z:()=>o});var s=i(935594),n=i(283637);class r extends s.Z{constructor(t){super(t)}createRenderer(){return new n.Z(this)}}const o=r},71534:(t,e,i)=>{"use strict";i.d(e,{Z:()=>s});const s={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"}},283637:(t,e,i)=>{"use strict";i.d(e,{Z:()=>_});var s=i(704089),n=i(415107),r=i(707245),o=i(19473),a=i(859900),h=i(782359),l=i(179682),c=i(421915),u=i(218672),d=i(949179),g=i(450596);class m extends s.Z{constructor(t){super(t),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=(0,c.lJ)(),this.tmpTileRange_=new o.Z(0,0,0,0)}isDrawableTile(t){const e=this.getLayer(),i=t.getState(),s=e.getUseInterimTilesOnError();return i==a.Z.LOADED||i==a.Z.EMPTY||i==a.Z.ERROR&&!s}getTile(t,e,i,s){const n=s.pixelRatio,r=s.viewState.projection,o=this.getLayer();let h=o.getSource().getTile(t,e,i,n,r);return h.getState()==a.Z.ERROR&&o.getUseInterimTilesOnError()&&o.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(h)||(h=h.getInterimTile()),h}getData(t){const e=this.frameState;if(!e)return null;const i=this.getLayer(),s=(0,h.nn)(e.pixelToCoordinateTransform,t.slice()),o=i.getExtent();if(o&&!(0,c.b8)(o,s))return null;const l=e.pixelRatio,u=e.viewState.projection,d=e.viewState,m=i.getRenderSource(),_=m.getTileGridForProjection(d.projection),T=m.getTilePixelRatio(e.pixelRatio);for(let t=_.getZForResolution(d.resolution);t>=_.getMinZoom();--t){const e=_.getTileCoordForCoordAndZ(s,t),i=m.getTile(t,e[1],e[2],l,u);if(!(i instanceof n.Z||i instanceof r.Z)||i instanceof r.Z&&i.getState()===a.Z.EMPTY)return null;if(i.getState()!==a.Z.LOADED)continue;const o=_.getOrigin(t),h=(0,g.Pq)(_.getTileSize(t)),c=_.getResolution(t),E=Math.floor(T*((s[0]-o[0])/c-e[1]*h[0])),f=Math.floor(T*((o[1]-s[1])/c-e[2]*h[1])),x=Math.round(T*m.getGutterForProjection(d.projection));return this.getImageData(i.getImage(),E+x,f+x)}return null}loadedTileCallback(t,e,i){return!!this.isDrawableTile(i)&&super.loadedTileCallback(t,e,i)}prepareFrame(t){return!!this.getLayer().getSource()}renderFrame(t,e){const i=t.layerStatesArray[t.layerIndex],s=t.viewState,n=s.projection,r=s.resolution,o=s.center,g=s.rotation,m=t.pixelRatio,_=this.getLayer(),T=_.getSource(),E=T.getRevision(),f=T.getTileGridForProjection(n),x=f.getZForResolution(r,T.zDirection),p=f.getResolution(x);let R=t.extent;const Z=t.viewState.resolution,I=T.getTilePixelRatio(m),v=Math.round((0,c.dz)(R)/Z*m),S=Math.round((0,c.Cr)(R)/Z*m),C=i.extent&&(0,u.dY)(i.extent,n);C&&(R=(0,c.Ed)(R,(0,u.dY)(i.extent,n)));const P=p*v/2/I,O=p*S/2/I,w=[o[0]-P,o[1]-O,o[0]+P,o[1]+O],Y=f.getTileRangeForExtentAndZ(R,x),L={};L[x]={};const D=this.createLoadedTileFinder(T,n,L),b=this.tmpExtent,X=this.tmpTileRange_;this.newTiles_=!1;const M=g?(0,c.dY)(s.center,Z,g,t.size):void 0;for(let e=Y.minX;e<=Y.maxX;++e)for(let s=Y.minY;s<=Y.maxY;++s){if(g&&!f.tileCoordIntersectsViewport([x,e,s],M))continue;const n=this.getTile(x,e,s,t);if(this.isDrawableTile(n)){const e=(0,d.sq)(this);if(n.getState()==a.Z.LOADED){L[x][n.tileCoord.toString()]=n;let t=n.inTransition(e);t&&1!==i.opacity&&(n.endTransition(e),t=!1),this.newTiles_||!t&&this.renderedTiles.includes(n)||(this.newTiles_=!0)}if(1===n.getAlpha(e,t.time))continue}const r=f.getTileCoordChildTileRange(n.tileCoord,X,b);let o=!1;r&&(o=D(x+1,r)),o||f.forEachTileCoordParentTileRange(n.tileCoord,D,X,b)}const W=p/r*m/I;(0,h.qC)(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/m,1/m,g,-v/2,-S/2);const F=(0,h.BB)(this.pixelTransform);this.useContainer(e,F,this.getBackground(t));const y=this.context,j=y.canvas;(0,h.nb)(this.inversePixelTransform,this.pixelTransform),(0,h.qC)(this.tempTransform,v/2,S/2,W,W,0,-v/2,-S/2),j.width!=v||j.height!=S?(j.width=v,j.height=S):this.containerReused||y.clearRect(0,0,v,S),C&&this.clipUnrotated(y,t,C),T.getInterpolate()||(y.imageSmoothingEnabled=!1),this.preRender(y,t),this.renderedTiles.length=0;let A,G,z,k=Object.keys(L).map(Number);k.sort(l.j2),1!==i.opacity||this.containerReused&&!T.getOpaque(t.viewState.projection)?(A=[],G=[]):k=k.reverse();for(let e=k.length-1;e>=0;--e){const i=k[e],s=T.getTilePixelSize(i,m,n),r=f.getResolution(i)/p,o=s[0]*r*W,a=s[1]*r*W,l=f.getTileCoordForCoordAndZ((0,c.rL)(w),i),u=f.getTileCoordExtent(l),g=(0,h.nn)(this.tempTransform,[I*(u[0]-w[0])/p,I*(w[3]-u[3])/p]),_=I*T.getGutterForProjection(n),E=L[i];for(const e in E){const s=E[e],n=s.tileCoord,r=l[1]-n[1],h=Math.round(g[0]-(r-1)*o),u=l[2]-n[2],m=Math.round(g[1]-(u-1)*a),f=Math.round(g[0]-r*o),p=Math.round(g[1]-u*a),R=h-f,Z=m-p,I=x===i,v=I&&1!==s.getAlpha((0,d.sq)(this),t.time);let S=!1;if(!v)if(A){z=[f,p,f+R,p,f+R,p+Z,f,p+Z];for(let t=0,e=A.length;t<e;++t)if(x!==i&&i<G[t]){const e=A[t];(0,c.kK)([f,p,f+R,p+Z],[e[0],e[3],e[4],e[7]])&&(S||(y.save(),S=!0),y.beginPath(),y.moveTo(z[0],z[1]),y.lineTo(z[2],z[3]),y.lineTo(z[4],z[5]),y.lineTo(z[6],z[7]),y.moveTo(e[6],e[7]),y.lineTo(e[4],e[5]),y.lineTo(e[2],e[3]),y.lineTo(e[0],e[1]),y.clip())}A.push(z),G.push(i)}else y.clearRect(f,p,R,Z);this.drawTileImage(s,t,f,p,R,Z,_,I),A&&!v?(S&&y.restore(),this.renderedTiles.unshift(s)):this.renderedTiles.push(s),this.updateUsedTiles(t.usedTiles,T,s)}}return this.renderedRevision=E,this.renderedResolution=p,this.extentChanged=!this.renderedExtent_||!(0,c.fS)(this.renderedExtent_,w),this.renderedExtent_=w,this.renderedPixelRatio=m,this.renderedProjection=n,this.manageTilePyramid(t,T,f,m,n,R,x,_.getPreload()),this.scheduleExpireCache(t,T),this.postRender(y,t),i.extent&&y.restore(),y.imageSmoothingEnabled=!0,F!==j.style.transform&&(j.style.transform=F),this.container}drawTileImage(t,e,i,s,n,r,o,a){const h=this.getTileImage(t);if(!h)return;const l=(0,d.sq)(this),c=e.layerStatesArray[e.layerIndex],u=c.opacity*(a?t.getAlpha(l,e.time):1),g=u!==this.context.globalAlpha;g&&(this.context.save(),this.context.globalAlpha=u),this.context.drawImage(h,o,o,h.width-2*o,h.height-2*o,i,s,n,r),g&&this.context.restore(),u!==c.opacity?e.animate=!0:a&&t.endTransition(l)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}scheduleExpireCache(t,e){if(e.canExpireCache()){const i=function(t,e,i){const s=(0,d.sq)(t);s in i.usedTiles&&t.expireCache(i.viewState.projection,i.usedTiles[s])}.bind(null,e);t.postRenderFunctions.push(i)}}updateUsedTiles(t,e,i){const s=(0,d.sq)(e);s in t||(t[s]={}),t[s][i.getKey()]=!0}manageTilePyramid(t,e,i,s,n,r,o,h,l){const u=(0,d.sq)(e);u in t.wantedTiles||(t.wantedTiles[u]={});const g=t.wantedTiles[u],m=t.tileQueue,_=i.getMinZoom(),T=t.viewState.rotation,E=T?(0,c.dY)(t.viewState.center,t.viewState.resolution,T,t.size):void 0;let f,x,p,R,Z,I,v=0;for(I=_;I<=o;++I)for(x=i.getTileRangeForExtentAndZ(r,I,x),p=i.getResolution(I),R=x.minX;R<=x.maxX;++R)for(Z=x.minY;Z<=x.maxY;++Z)T&&!i.tileCoordIntersectsViewport([I,R,Z],E)||(o-I<=h?(++v,f=e.getTile(I,R,Z,s,n),f.getState()==a.Z.IDLE&&(g[f.getKey()]=!0,m.isKeyQueued(f.getKey())||m.enqueue([f,u,i.getTileCoordCenter(f.tileCoord),p])),void 0!==l&&l(f)):e.useTile(I,R,Z,n));e.updateCacheSize(v,n)}}const _=m},152209:(t,e,i)=>{"use strict";i.d(e,{rX:()=>h,aA:()=>u,Co:()=>d,sY:()=>g});var s=i(421915),n=i(85386),r=i(218672),o=i(921882);let a;const h=[];function l(t,e,i,s,n){t.beginPath(),t.moveTo(0,0),t.lineTo(e,i),t.lineTo(s,n),t.closePath(),t.save(),t.clip(),t.fillRect(0,0,Math.max(e,s)+1,Math.max(i,n)),t.restore()}function c(t,e){return Math.abs(t[4*e]-210)>2||Math.abs(t[4*e+3]-191.25)>2}function u(t,e,i,n){const o=(0,r.vs)(i,e,t);let a=(0,r._Q)(e,n,i);const h=e.getMetersPerUnit();void 0!==h&&(a*=h);const l=t.getMetersPerUnit();void 0!==l&&(a/=l);const c=t.getExtent();if(!c||(0,s.b8)(c,o)){const e=(0,r._Q)(t,a,o)/a;isFinite(e)&&e>0&&(a/=e)}return a}function d(t,e,i,n){const r=(0,s.qg)(i);let o=u(t,e,r,n);return(!isFinite(o)||o<=0)&&(0,s.H6)(i,(function(i){return o=u(t,e,i,n),isFinite(o)&&o>0})),o}function g(t,e,i,r,u,d,g,m,_,T,E,f){const x=(0,n.E4)(Math.round(i*t),Math.round(i*e),h);if(f||(x.imageSmoothingEnabled=!1),0===_.length)return x.canvas;function p(t){return Math.round(t*i)/i}x.scale(i,i),x.globalCompositeOperation="lighter";const R=(0,s.lJ)();_.forEach((function(t,e,i){(0,s.l7)(R,t.extent)}));const Z=(0,s.dz)(R),I=(0,s.Cr)(R),v=(0,n.E4)(Math.round(i*Z/r),Math.round(i*I/r),h);f||(v.imageSmoothingEnabled=!1);const S=i/r;_.forEach((function(t,e,i){const n=t.extent[0]-R[0],r=-(t.extent[3]-R[3]),o=(0,s.dz)(t.extent),a=(0,s.Cr)(t.extent);t.image.width>0&&t.image.height>0&&v.drawImage(t.image,T,T,t.image.width-2*T,t.image.height-2*T,n*S,r*S,o*S,a*S)}));const C=(0,s.rL)(g);return m.getTriangles().forEach((function(t,e,s){const u=t.source,g=t.target;let m=u[0][0],_=u[0][1],T=u[1][0],E=u[1][1],Z=u[2][0],I=u[2][1];const S=p((g[0][0]-C[0])/d),P=p(-(g[0][1]-C[1])/d),O=p((g[1][0]-C[0])/d),w=p(-(g[1][1]-C[1])/d),Y=p((g[2][0]-C[0])/d),L=p(-(g[2][1]-C[1])/d),D=m,b=_;m=0,_=0,T-=D,E-=b,Z-=D,I-=b;const X=[[T,E,0,0,O-S],[Z,I,0,0,Y-S],[0,0,T,E,w-P],[0,0,Z,I,L-P]],M=(0,o.SV)(X);if(M){if(x.save(),x.beginPath(),function(){if(void 0===a){const t=(0,n.E4)(6,6,h);t.globalCompositeOperation="lighter",t.fillStyle="rgba(210, 0, 0, 0.75)",l(t,4,5,4,0),l(t,4,5,0,5);const e=t.getImageData(0,0,3,3).data;a=c(e,0)||c(e,4)||c(e,8),(0,n.jy)(t),h.push(t.canvas)}return a}()||!f){x.moveTo(O,w);const t=4,e=S-O,i=P-w;for(let s=0;s<t;s++)x.lineTo(O+p((s+1)*e/t),w+p(s*i/(t-1))),s!=t-1&&x.lineTo(O+p((s+1)*e/t),w+p((s+1)*i/(t-1)));x.lineTo(Y,L)}else x.moveTo(O,w),x.lineTo(S,P),x.lineTo(Y,L);x.clip(),x.transform(M[0],M[2],M[1],M[3],S,P),x.translate(R[0]-D,R[3]-b),x.scale(r/i,-r/i),x.drawImage(v.canvas,0,0),x.restore()}})),(0,n.jy)(v),h.push(v.canvas),E&&(x.save(),x.globalCompositeOperation="source-over",x.strokeStyle="black",x.lineWidth=1,m.getTriangles().forEach((function(t,e,i){const s=t.target,n=(s[0][0]-C[0])/d,r=-(s[0][1]-C[1])/d,o=(s[1][0]-C[0])/d,a=-(s[1][1]-C[1])/d,h=(s[2][0]-C[0])/d,l=-(s[2][1]-C[1])/d;x.beginPath(),x.moveTo(o,a),x.lineTo(n,r),x.lineTo(h,l),x.closePath(),x.stroke()})),x.restore()),x.canvas}},707245:(t,e,i)=>{"use strict";i.d(e,{Z:()=>m});var s=i(435211),n=i(173381),r=i(624969),o=i(859900),a=i(856245),h=i(152209),l=i(921882),c=i(421915),u=i(613002),d=i(85386);class g extends r.Z{constructor(t,e,i,n,r,u,d,g,m,_,T,E){super(r,o.Z.IDLE,{interpolate:!!E}),this.renderEdges_=void 0!==T&&T,this.pixelRatio_=d,this.gutter_=g,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=n,this.wrappedTileCoord_=u||r,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const f=n.getTileCoordExtent(this.wrappedTileCoord_),x=this.targetTileGrid_.getExtent();let p=this.sourceTileGrid_.getExtent();const R=x?(0,c.Ed)(f,x):f;if(0===(0,c.bg)(R))return void(this.state=o.Z.EMPTY);const Z=t.getExtent();Z&&(p=p?(0,c.Ed)(p,Z):Z);const I=n.getResolution(this.wrappedTileCoord_[0]),v=(0,h.Co)(t,i,R,I);if(!isFinite(v)||v<=0)return void(this.state=o.Z.EMPTY);const S=void 0!==_?_:s.m;if(this.triangulation_=new a.Z(t,i,R,p,v*S,I),0===this.triangulation_.getTriangles().length)return void(this.state=o.Z.EMPTY);this.sourceZ_=e.getZForResolution(v);let C=this.triangulation_.calculateSourceExtent();if(p&&(t.canWrapX()?(C[1]=(0,l.uZ)(C[1],p[1],p[3]),C[3]=(0,l.uZ)(C[3],p[1],p[3])):C=(0,c.Ed)(C,p)),(0,c.bg)(C)){const t=e.getTileRangeForExtentAndZ(C,this.sourceZ_);for(let e=t.minX;e<=t.maxX;e++)for(let i=t.minY;i<=t.maxY;i++){const t=m(this.sourceZ_,e,i,d);t&&this.sourceTiles_.push(t)}0===this.sourceTiles_.length&&(this.state=o.Z.EMPTY)}else this.state=o.Z.EMPTY}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach((e=>{e&&e.getState()==o.Z.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})})),this.sourceTiles_.length=0,0===t.length)this.state=o.Z.ERROR;else{const e=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(e),s="number"==typeof i?i:i[0],n="number"==typeof i?i:i[1],r=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=(0,h.sY)(s,n,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),r,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=o.Z.LOADED}this.changed()}load(){if(this.state==o.Z.IDLE){this.state=o.Z.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach((e=>{const i=e.getState();if(i==o.Z.IDLE||i==o.Z.LOADING){t++;const i=(0,u.oL)(e,n.Z.CHANGE,(function(s){const n=e.getState();n!=o.Z.LOADED&&n!=o.Z.ERROR&&n!=o.Z.EMPTY||((0,u.bN)(i),t--,0===t&&(this.unlistenSources_(),this.reproject_()))}),this);this.sourcesListenerKeys_.push(i)}})),0===t?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach((function(t,e,i){t.getState()==o.Z.IDLE&&t.load()}))}}unlistenSources_(){this.sourcesListenerKeys_.forEach(u.bN),this.sourcesListenerKeys_=null}release(){this.canvas_&&((0,d.jy)(this.canvas_.getContext("2d")),h.rX.push(this.canvas_),this.canvas_=null),super.release()}}const m=g},856245:(t,e,i)=>{"use strict";i.d(e,{Z:()=>o});var s=i(421915),n=i(218672),r=i(921882);const o=class{constructor(t,e,i,r,o,a){this.sourceProj_=t,this.targetProj_=e;let h={};const l=(0,n.Ck)(this.targetProj_,this.sourceProj_);this.transformInv_=function(t){const e=t[0]+"/"+t[1];return h[e]||(h[e]=l(t)),h[e]},this.maxSourceExtent_=r,this.errorThresholdSquared_=o*o,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&(0,s.dz)(r)>=(0,s.dz)(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?(0,s.dz)(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?(0,s.dz)(this.targetProj_.getExtent()):null;const c=(0,s.rL)(i),u=(0,s.Xv)(i),d=(0,s.w$)(i),g=(0,s.hC)(i),m=this.transformInv_(c),_=this.transformInv_(u),T=this.transformInv_(d),E=this.transformInv_(g),f=10+(a?Math.max(0,Math.ceil(Math.log2((0,s.bg)(i)/(a*a*256*256)))):0);if(this.addQuad_(c,u,d,g,m,_,T,E,f),this.wrapsXInSource_){let t=1/0;this.triangles_.forEach((function(e,i,s){t=Math.min(t,e.source[0][0],e.source[1][0],e.source[2][0])})),this.triangles_.forEach((e=>{if(Math.max(e.source[0][0],e.source[1][0],e.source[2][0])-t>this.sourceWorldWidth_/2){const i=[[e.source[0][0],e.source[0][1]],[e.source[1][0],e.source[1][1]],[e.source[2][0],e.source[2][1]]];i[0][0]-t>this.sourceWorldWidth_/2&&(i[0][0]-=this.sourceWorldWidth_),i[1][0]-t>this.sourceWorldWidth_/2&&(i[1][0]-=this.sourceWorldWidth_),i[2][0]-t>this.sourceWorldWidth_/2&&(i[2][0]-=this.sourceWorldWidth_);const s=Math.min(i[0][0],i[1][0],i[2][0]);Math.max(i[0][0],i[1][0],i[2][0])-s<this.sourceWorldWidth_/2&&(e.source=i)}}))}h={}}addTriangle_(t,e,i,s,n,r){this.triangles_.push({source:[s,n,r],target:[t,e,i]})}addQuad_(t,e,i,n,o,a,h,l,c){const u=(0,s.hI)([o,a,h,l]),d=this.sourceWorldWidth_?(0,s.dz)(u)/this.sourceWorldWidth_:null,g=this.sourceWorldWidth_,m=this.sourceProj_.canWrapX()&&d>.5&&d<1;let _=!1;if(c>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const r=(0,s.hI)([t,e,i,n]);_=(0,s.dz)(r)/this.targetWorldWidth_>.25||_}!m&&this.sourceProj_.isGlobal()&&d&&(_=d>.25||_)}if(!_&&this.maxSourceExtent_&&isFinite(u[0])&&isFinite(u[1])&&isFinite(u[2])&&isFinite(u[3])&&!(0,s.kK)(u,this.maxSourceExtent_))return;let T=0;if(!(_||isFinite(o[0])&&isFinite(o[1])&&isFinite(a[0])&&isFinite(a[1])&&isFinite(h[0])&&isFinite(h[1])&&isFinite(l[0])&&isFinite(l[1])))if(c>0)_=!0;else if(T=(isFinite(o[0])&&isFinite(o[1])?0:8)+(isFinite(a[0])&&isFinite(a[1])?0:4)+(isFinite(h[0])&&isFinite(h[1])?0:2)+(isFinite(l[0])&&isFinite(l[1])?0:1),1!=T&&2!=T&&4!=T&&8!=T)return;if(c>0){if(!_){const e=[(t[0]+i[0])/2,(t[1]+i[1])/2],s=this.transformInv_(e);let n;n=m?((0,r.$W)(o[0],g)+(0,r.$W)(h[0],g))/2-(0,r.$W)(s[0],g):(o[0]+h[0])/2-s[0];const a=(o[1]+h[1])/2-s[1];_=n*n+a*a>this.errorThresholdSquared_}if(_){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){const s=[(e[0]+i[0])/2,(e[1]+i[1])/2],r=this.transformInv_(s),u=[(n[0]+t[0])/2,(n[1]+t[1])/2],d=this.transformInv_(u);this.addQuad_(t,e,s,u,o,a,r,d,c-1),this.addQuad_(u,s,i,n,d,r,h,l,c-1)}else{const s=[(t[0]+e[0])/2,(t[1]+e[1])/2],r=this.transformInv_(s),u=[(i[0]+n[0])/2,(i[1]+n[1])/2],d=this.transformInv_(u);this.addQuad_(t,s,u,n,o,r,d,l,c-1),this.addQuad_(s,e,i,u,r,a,h,d,c-1)}return}}if(m){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}11&T||this.addTriangle_(t,i,n,o,h,l),14&T||this.addTriangle_(t,i,e,o,h,a),T&&(13&T||this.addTriangle_(e,n,t,a,l,o),7&T||this.addTriangle_(e,n,i,a,l,h))}calculateSourceExtent(){const t=(0,s.lJ)();return this.triangles_.forEach((function(e,i,n){const r=e.source;(0,s.Wj)(t,r[0]),(0,s.Wj)(t,r[1]),(0,s.Wj)(t,r[2])})),t}getTriangles(){return this.triangles_}}},435211:(t,e,i)=>{"use strict";i.d(e,{m:()=>s});const s=.5}}]);