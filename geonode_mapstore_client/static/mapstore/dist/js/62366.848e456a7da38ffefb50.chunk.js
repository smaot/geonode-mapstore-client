(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[62366],{798143:function(e,t,i){var r,n;void 0===(n="function"==typeof(r=function(){function e(e,t){return function(i,r,n,s){i[e]?i[e](r,n,s):i[t]&&i[t]("on"+r,n)}}return{add:e("addEventListener","attachEvent"),remove:e("removeEventListener","detachEvent")}})?r.call(t,i,t,e):r)||(e.exports=n)},581399:function(e,t){var i,r,n;!function(s,o){"use strict";"object"==typeof e.exports?e.exports=o():(r=[],void 0===(n="function"==typeof(i=o)?i.apply(t,r):i)||(e.exports=n))}("object"==typeof window&&window,(function(){"use strict";function e(t){if(!(this instanceof e))return new e(t);this._LRUCacheState=new i(t)}var t=e.prototype;function i(e){this.capacity=e>0?+e:Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,this.data=Object.create?Object.create(null):{},this.hash=Object.create?Object.create(null):{},this.linkedList=new r}function r(){this.length=0,this.head=null,this.end=null}function n(e){this.key=e,this.p=null,this.n=null}function s(e,t){t!==e.head&&(e.end?e.end===t&&(e.end=t.n):e.end=t,o(t.n,t.p),o(t,e.head),e.head=t,e.head.n=null)}function o(e,t){e!==t&&(e&&(e.p=t),t&&(t.n=e))}return t.get=function(e){var t=this._LRUCacheState,i=t.hash[e];if(i)return s(t.linkedList,i),t.data[e]},t.set=function(e,t){var i=this._LRUCacheState,r=i.hash[e];return void 0===t||(r||(i.hash[e]=new n(e),i.linkedList.length+=1,r=i.hash[e]),s(i.linkedList,r),i.data[e]=t,i.linkedList.length>i.capacity&&this.remove(i.linkedList.end.key)),this},t.update=function(e,t){return this.has(e)&&this.set(e,t(this.get(e))),this},t.remove=function(e){var t=this._LRUCacheState,i=t.hash[e];return i?(i===t.linkedList.head&&(t.linkedList.head=i.p),i===t.linkedList.end&&(t.linkedList.end=i.n),o(i.n,i.p),delete t.hash[e],delete t.data[e],t.linkedList.length-=1,this):this},t.removeAll=function(){return this._LRUCacheState=new i(this._LRUCacheState.capacity),this},t.info=function(){var e=this._LRUCacheState;return{capacity:e.capacity,length:e.linkedList.length}},t.keys=function(){for(var e=[],t=this._LRUCacheState.linkedList.head;t;)e.push(t.key),t=t.p;return e},t.has=function(e){return!!this._LRUCacheState.hash[e]},t.staleKey=function(){return this._LRUCacheState.linkedList.end&&this._LRUCacheState.linkedList.end.key},t.popStale=function(){var e=this.staleKey();if(!e)return null;var t=[e,this._LRUCacheState.data[e]];return this.remove(e),t},e}))},553980:(e,t,i)=>{"use strict";i.d(t,{G0:()=>o,px:()=>a,qo:()=>h,ZP:()=>d});var r=i(624969),n=i(859900),s=i(85386);function o(e){return e instanceof Image||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?e:null}function a(e){return e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Float32Array||e instanceof DataView?e:null}let l=null;function h(e){l||(l=(0,s.E4)(e.width,e.height,void 0,{willReadFrequently:!0}));const t=l.canvas,i=e.width;t.width!==i&&(t.width=i);const r=e.height;return t.height!==r&&(t.height=r),l.clearRect(0,0,i,r),l.drawImage(e,0,0),l.getImageData(0,0,i,r).data}const u=[256,256];class c extends r.Z{constructor(e){const t=n.Z.IDLE;super(e.tileCoord,t,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null}getSize(){if(this.size_)return this.size_;const e=o(this.data_);return e?[e.width,e.height]:u}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==n.Z.IDLE&&this.state!==n.Z.ERROR)return;this.state=n.Z.LOADING,this.changed();const e=this;this.loader_().then((function(t){e.data_=t,e.state=n.Z.LOADED,e.changed()})).catch((function(t){e.error_=t,e.state=n.Z.ERROR,e.changed()}))}}const d=c},540188:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});const r={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"}},193409:(e,t,i)=>{"use strict";i.d(t,{Z:()=>p});var r=i(558493),n=i(540188),s=i(267644),o=i(421915),a=i(613002),l=i(85386);const h="element",u="map",c="offset",d="position",g="positioning";class f extends r.Z{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=void 0===e.insertFirst||e.insertFirst,this.stopEvent=void 0===e.stopEvent||e.stopEvent,this.element=document.createElement("div"),this.element.className=void 0!==e.className?e.className:"ol-overlay-container "+s.$A,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=!0===e.autoPan?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(h,this.handleElementChanged),this.addChangeListener(u,this.handleMapChanged),this.addChangeListener(c,this.handleOffsetChanged),this.addChangeListener(d,this.handlePositionChanged),this.addChangeListener(g,this.handlePositioningChanged),void 0!==e.element&&this.setElement(e.element),this.setOffset(void 0!==e.offset?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),void 0!==e.position&&this.setPosition(e.position)}getElement(){return this.get(h)}getId(){return this.id}getMap(){return this.get(u)||null}getOffset(){return this.get(c)}getPosition(){return this.get(d)}getPositioning(){return this.get(g)}handleElementChanged(){(0,l.ep)(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&((0,l.ZF)(this.element),(0,a.bN)(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=(0,a.oL)(e,n.Z.POSTRENDER,this.render,this),this.updatePixelPosition();const t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(h,e)}setMap(e){this.set(u,e)}setOffset(e){this.set(c,e)}setPosition(e){this.set(d,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(d))return;const i=this.getRect(t.getTargetElement(),t.getSize()),r=this.getElement(),n=this.getRect(r,[(0,l.iO)(r),(0,l.Pb)(r)]),s=void 0===(e=e||{}).margin?20:e.margin;if(!(0,o.r4)(i,n)){const r=n[0]-i[0],o=i[2]-n[2],a=n[1]-i[1],l=i[3]-n[3],h=[0,0];if(r<0?h[0]=r-s:o<0&&(h[0]=Math.abs(o)+s),a<0?h[1]=a-s:l<0&&(h[1]=Math.abs(l)+s),0!==h[0]||0!==h[1]){const i=t.getView().getCenterInternal(),r=t.getPixelFromCoordinateInternal(i);if(!r)return;const n=[r[0]+h[0],r[1]+h[1]],s=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(n),duration:s.duration,easing:s.easing})}}}getRect(e,t){const i=e.getBoundingClientRect(),r=i.left+window.pageXOffset,n=i.top+window.pageYOffset;return[r,n,r+t[0],n+t[1]]}setPositioning(e){this.set(g,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t)return void this.setVisible(!1);const i=e.getPixelFromCoordinate(t),r=e.getSize();this.updateRenderedPosition(i,r)}updateRenderedPosition(e,t){const i=this.element.style,r=this.getOffset(),n=this.getPositioning();this.setVisible(!0);let s="0%",o="0%";"bottom-right"==n||"center-right"==n||"top-right"==n?s="-100%":"bottom-center"!=n&&"center-center"!=n&&"top-center"!=n||(s="-50%"),"bottom-left"==n||"bottom-center"==n||"bottom-right"==n?o="-100%":"center-left"!=n&&"center-center"!=n&&"center-right"!=n||(o="-50%");const a=`translate(${s}, ${o}) translate(${Math.round(e[0]+r[0])+"px"}, ${Math.round(e[1]+r[1])+"px"})`;this.rendered.transform_!=a&&(this.rendered.transform_=a,i.transform=a)}getOptions(){return this.options}}const p=f},404780:(e,t,i)=>{"use strict";i.d(t,{Z:()=>L});var r=i(518334),n=i(944538),s=i(525642),o=i(552329),a=i(513987),l=i(703614),h=i(752043),u=i(15265),c=i(444183),d=i(782359),g=i(421915),f=i(179682),p=i(538529),_=i(218672),m=i(321422),T=i(192526),E=i(517882);const R=(0,d.Ue)();class y{constructor(e,t,i,r,n){this.styleFunction,this.extent_,this.id_=n,this.type_=e,this.flatCoordinates_=t,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=i,this.properties_=r}get(e){return this.properties_[e]}getExtent(){return this.extent_||(this.extent_="Point"===this.type_?(0,g.HK)(this.flatCoordinates_):(0,g.GN)(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const e=(0,g.qg)(this.getExtent());this.flatInteriorPoints_=(0,p.X)(this.flatCoordinates_,0,this.ends_,2,e,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const e=(0,T.E)(this.flatCoordinates_,0,this.ends_,2);this.flatInteriorPoints_=(0,p.U)(this.flatCoordinates_,0,this.ends_,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=(0,m.WW)(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const e=this.flatCoordinates_;let t=0;const i=this.ends_;for(let r=0,n=i.length;r<n;++r){const n=i[r],s=(0,m.WW)(e,t,n,2,.5);(0,f.l7)(this.flatMidpoints_,s),t=n}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(e){return this}simplifyTransformed(e,t){return this}getProperties(){return this.properties_}getStride(){return 2}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(e){const t=(e=(0,_.U2)(e)).getExtent(),i=e.getWorldExtent();if(t&&i){const e=(0,g.Cr)(i)/(0,g.Cr)(t);(0,d.qC)(R,i[0],i[3],e,-e,0,0,0),(0,E.vT)(this.flatCoordinates_,0,this.flatCoordinates_.length,2,R,this.flatCoordinates_)}}getEnds(){return this.ends_}}y.prototype.getEndss=y.prototype.getEnds,y.prototype.getFlatCoordinates=y.prototype.getOrientedFlatCoordinates;const v=y;var x=i(438906),S=i(680793);class w extends r.ZP{constructor(e){super(),e=e||{},this.dataProjection=new c.Z({code:"",units:"tile-pixels"}),this.featureClass_=e.featureClass?e.featureClass:v,this.geometryName_=e.geometryName,this.layerName_=e.layerName?e.layerName:"layer",this.layers_=e.layers?e.layers:null,this.idProperty_=e.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(e,t,i,r){e.pos=t.geometry;const n=e.readVarint()+e.pos;let s=1,o=0,a=0,l=0,h=0,u=0;for(;e.pos<n;){if(!o){const t=e.readVarint();s=7&t,o=t>>3}o--,1===s||2===s?(a+=e.readSVarint(),l+=e.readSVarint(),1===s&&h>u&&(r.push(h),u=h),i.push(a,l),h+=2):7===s?h>u&&(i.push(i[u],i[u+1]),h+=2):(0,x.h)(!1,59)}h>u&&(r.push(h),u=h)}createFeature_(e,t,i){const l=t.type;if(0===l)return null;let c;const d=t.properties;let g;this.idProperty_?(g=d[this.idProperty_],delete d[this.idProperty_]):g=t.id,d[this.layerName_]=t.layer.name;const f=[],p=[];this.readRawGeometry_(e,t,f,p);const _=function(e,t){let i;return 1===e?i=1===t?"Point":"MultiPoint":2===e?i=1===t?"LineString":"MultiLineString":3===e&&(i="Polygon"),i}(l,p.length);if(this.featureClass_===v)c=new this.featureClass_(_,f,p,d,g),c.transform(i.dataProjection);else{let e;if("Polygon"==_){const t=(0,S.Q3)(f,p);e=t.length>1?new a.Z(f,"XY",t):new u.ZP(f,"XY",p)}else e="Point"===_?new h.Z(f,"XY"):"LineString"===_?new n.Z(f,"XY"):"MultiPoint"===_?new o.Z(f,"XY"):"MultiLineString"===_?new s.Z(f,"XY",p):null;c=new(0,this.featureClass_),this.geometryName_&&c.setGeometryName(this.geometryName_);const t=(0,r.fI)(e,!1,i);c.setGeometry(t),void 0!==g&&c.setId(g),c.setProperties(d,!0)}return c}getType(){return"arraybuffer"}readFeatures(e,t){const i=this.layers_;t=this.adaptOptions(t);const r=(0,_.U2)(t.dataProjection);r.setWorldExtent(t.extent),t.dataProjection=r;const n=new l(e),s=n.readFields(b,{}),o=[];for(const e in s){if(i&&!i.includes(e))continue;const a=s[e],l=a?[0,0,a.extent,a.extent]:null;r.setExtent(l);for(let e=0,i=a.length;e<i;++e){const i=A(n,a,e),r=this.createFeature_(n,i,t);null!==r&&o.push(r)}}return o}readProjection(e){return this.dataProjection}setLayers(e){this.layers_=e}}function b(e,t,i){if(3===e){const e={keys:[],values:[],features:[]},r=i.readVarint()+i.pos;i.readFields(C,e,r),e.length=e.features.length,e.length&&(t[e.name]=e)}}function C(e,t,i){if(15===e)t.version=i.readVarint();else if(1===e)t.name=i.readString();else if(5===e)t.extent=i.readVarint();else if(2===e)t.features.push(i.pos);else if(3===e)t.keys.push(i.readString());else if(4===e){let r=null;const n=i.readVarint()+i.pos;for(;i.pos<n;)r=1==(e=i.readVarint()>>3)?i.readString():2===e?i.readFloat():3===e?i.readDouble():4===e?i.readVarint64():5===e?i.readVarint():6===e?i.readSVarint():7===e?i.readBoolean():null;t.values.push(r)}}function P(e,t,i){if(1==e)t.id=i.readVarint();else if(2==e){const e=i.readVarint()+i.pos;for(;i.pos<e;){const e=t.layer.keys[i.readVarint()],r=t.layer.values[i.readVarint()];t.properties[e]=r}}else 3==e?t.type=i.readVarint():4==e&&(t.geometry=i.pos)}function A(e,t,i){e.pos=t.features[i];const r=e.readVarint()+e.pos,n={layer:t,type:0,properties:{}};return e.readFields(P,n,r),n}const L=w},496476:(e,t,i)=>{"use strict";i.d(t,{Z:()=>R});var r=i(623068),n=i(598968),s=i(944538),o=i(525642),a=i(552329),l=i(513987),h=i(752043),u=i(15265),c=i(218672),d=i(518334);class g extends n.Z{constructor(e){super(),e=e||{},this.layerName_=e.layerName,this.layers_=e.layers?e.layers:null,this.dataProjection=(0,c.U2)(e.dataProjection?e.dataProjection:"EPSG:4326")}readFeaturesFromObject(e,t){if("Topology"==e.type){const i=e;let r,n=null,s=null;i.transform&&(r=i.transform,n=r.scale,s=r.translate);const o=i.arcs;r&&function(e,t,i){for(let r=0,n=e.length;r<n;++r)T(e[r],t,i)}(o,n,s);const a=[],l=i.objects,h=this.layerName_;let u;for(const e in l)this.layers_&&!this.layers_.includes(e)||("GeometryCollection"===l[e].type?(u=l[e],a.push.apply(a,_(u,o,n,s,h,e,t))):(u=l[e],a.push(m(u,o,n,s,h,e,t))));return a}return[]}readProjectionFromObject(e){return this.dataProjection}}const f={Point:function(e,t,i){const r=e.coordinates;return t&&i&&E(r,t,i),new h.Z(r)},LineString:function(e,t){const i=p(e.arcs,t);return new s.Z(i)},Polygon:function(e,t){const i=[];for(let r=0,n=e.arcs.length;r<n;++r)i[r]=p(e.arcs[r],t);return new u.ZP(i)},MultiPoint:function(e,t,i){const r=e.coordinates;if(t&&i)for(let e=0,n=r.length;e<n;++e)E(r[e],t,i);return new a.Z(r)},MultiLineString:function(e,t){const i=[];for(let r=0,n=e.arcs.length;r<n;++r)i[r]=p(e.arcs[r],t);return new o.Z(i)},MultiPolygon:function(e,t){const i=[];for(let r=0,n=e.arcs.length;r<n;++r){const n=e.arcs[r],s=[];for(let e=0,i=n.length;e<i;++e)s[e]=p(n[e],t);i[r]=s}return new l.Z(i)}};function p(e,t){const i=[];let r;for(let n=0,s=e.length;n<s;++n)if(r=e[n],n>0&&i.pop(),r>=0){const e=t[r];for(let t=0,r=e.length;t<r;++t)i.push(e[t].slice(0))}else{const e=t[~r];for(let t=e.length-1;t>=0;--t)i.push(e[t].slice(0))}return i}function _(e,t,i,r,n,s,o){const a=e.geometries,l=[];for(let e=0,h=a.length;e<h;++e)l[e]=m(a[e],t,i,r,n,s,o);return l}function m(e,t,i,n,s,o,a){let l=null;const h=e.type;if(h){const r=f[h];l="Point"===h||"MultiPoint"===h?r(e,i,n):r(e,t),l=(0,d.fI)(l,!1,a)}const u=new r.Z({geometry:l});void 0!==e.id&&u.setId(e.id);let c=e.properties;return s&&(c||(c={}),c[s]=o),c&&u.setProperties(c,!0),u}function T(e,t,i){let r=0,n=0;for(let s=0,o=e.length;s<o;++s){const o=e[s];r+=o[0],n+=o[1],o[0]=r,o[1]=n,E(o,t,i)}}function E(e,t,i){e[0]=e[0]*t[0]+i[0],e[1]=e[1]*t[1]+i[1]}const R=g},949110:(e,t,i)=>{"use strict";i.d(t,{Z:()=>x});var r=i(384385),n=i(95965),s=i(983183),o=i(283637),a=i(859900),l=i(706908),h=i(617356),u=i(782359),c=i(421915),d=i(243631),g=i(949179),f=i(450596),p=i(690728);const _={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},m={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class T extends o.Z{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.tmpTransform_=(0,u.Ue)()}prepareTile(e,t,i){let r;const n=e.getState();return n!==a.Z.LOADED&&n!==a.Z.ERROR||(this.updateExecutorGroup_(e,t,i),this.tileImageNeedsRender_(e)&&(r=!0)),r}getTile(e,t,i,r){const n=r.pixelRatio,s=r.viewState,o=s.resolution,a=s.projection,h=this.getLayer(),u=h.getSource().getTile(e,t,i,n,a),c=r.viewHints,d=!(c[l.Z.ANIMATING]||c[l.Z.INTERACTING]);return!d&&u.wantedResolution||(u.wantedResolution=o),this.prepareTile(u,n,a)&&(d||Date.now()-r.time<8)&&"vector"!==h.getRenderMode()&&this.renderTileImage_(u,r),super.getTile(e,t,i,r)}isDrawableTile(e){const t=this.getLayer();return super.isDrawableTile(e)&&("vector"===t.getRenderMode()?(0,g.sq)(t)in e.executorGroups:e.hasContext(t))}getTileImage(e){return e.getImage(this.getLayer())}prepareFrame(e){const t=this.getLayer().getRevision();return this.renderedLayerRevision_!==t&&(this.renderedLayerRevision_=t,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,t,i){const r=this.getLayer(),o=r.getRevision(),l=r.getRenderOrder()||null,h=e.wantedResolution,u=e.getReplayState(r);if(!u.dirty&&u.renderedResolution===h&&u.renderedRevision==o&&u.renderedRenderOrder==l)return;const f=r.getSource(),p=r.getDeclutter(),_=f.getTileGrid(),m=f.getTileGridForProjection(i).getTileCoordExtent(e.wrappedTileCoord),T=f.getSourceTiles(t,i,e),E=(0,g.sq)(r);delete e.hitDetectionImageData[E],e.executorGroups[E]=[],p&&(e.declutterExecutorGroups[E]=[]),u.dirty=!1;for(let i=0,o=T.length;i<o;++i){const o=T[i];if(o.getState()!=a.Z.LOADED)continue;const g=o.tileCoord,R=_.getTileCoordExtent(g),y=(0,c.Ed)(m,R),v=(0,c.f3)(y,r.getRenderBuffer()*h,this.tmpExtent),x=(0,c.fS)(R,y)?null:v,S=new n.Z(0,v,h,t),w=p?new n.Z(0,y,h,t):void 0,b=(0,d.se)(h,t),C=function(e){let t;const i=e.getStyleFunction()||r.getStyleFunction();if(i&&(t=i(e,h)),t){const i=this.renderFeature(e,b,t,S,w);u.dirty=u.dirty||i}},P=o.getFeatures();l&&l!==u.renderedRenderOrder&&P.sort(l);for(let e=0,t=P.length;e<t;++e){const t=P[e];x&&!(0,c.kK)(x,t.getGeometry().getExtent())||C.call(this,t)}const A=S.finish(),L="vector"!==r.getRenderMode()&&p&&1===T.length?null:y,F=new s.Z(L,h,t,f.getOverlaps(),A,r.getRenderBuffer());if(e.executorGroups[E].push(F),w){const i=new s.Z(null,h,t,f.getOverlaps(),w.finish(),r.getRenderBuffer());e.declutterExecutorGroups[E].push(i)}}u.renderedRevision=o,u.renderedRenderOrder=l,u.renderedResolution=h}forEachFeatureAtCoordinate(e,t,i,r,n){const s=t.viewState.resolution,o=t.viewState.rotation;i=null==i?0:i;const a=this.getLayer(),l=a.getSource().getTileGridForProjection(t.viewState.projection),h=(0,c.hI)([e]);(0,c.f3)(h,s*i,h);const u={},d=function(e,t,i){let s=e.getId();void 0===s&&(s=(0,g.sq)(e));const o=u[s];if(o){if(!0!==o&&i<o.distanceSq){if(0===i)return u[s]=!0,n.splice(n.lastIndexOf(o),1),r(e,a,t);o.geometry=t,o.distanceSq=i}}else{if(0===i)return u[s]=!0,r(e,a,t);n.push(u[s]={feature:e,layer:a,geometry:t,distanceSq:i,callback:r})}},f=this.renderedTiles;let p;for(let r=0,n=f.length;!p&&r<n;++r){const n=f[r],u=l.getTileCoordExtent(n.wrappedTileCoord);if(!(0,c.kK)(u,h))continue;const _=(0,g.sq)(a),m=[n.executorGroups[_]],T=n.declutterExecutorGroups[_];T&&m.push(T),m.some((r=>{const n=r===T?t.declutterTree.all().map((e=>e.value)):null;for(let t=0,a=r.length;t<a;++t){const a=r[t];if(p=a.forEachFeatureAtCoordinate(e,s,o,i,d,n),p)return!0}}))}return p}getFeatures(e){return new Promise(((t,i)=>{const r=this.getLayer(),n=(0,g.sq)(r),s=r.getSource(),o=this.renderedProjection,l=o.getExtent(),d=this.renderedResolution,_=s.getTileGridForProjection(o),m=(0,u.nn)(this.renderedPixelToCoordinateTransform_,e.slice()),T=_.getTileCoordForCoordAndResolution(m,d);let E;for(let e=0,t=this.renderedTiles.length;e<t;++e)if(T.toString()===this.renderedTiles[e].tileCoord.toString()){if(E=this.renderedTiles[e],E.getState()===a.Z.LOADED){const e=_.getTileCoordExtent(E.tileCoord);s.getWrapX()&&o.canWrapX()&&!(0,c.r4)(l,e)&&(0,p.Cf)(m,o);break}E=void 0}if(!E||E.loadingSourceTiles>0)return void t([]);const R=_.getTileCoordExtent(E.wrappedTileCoord),y=(0,c.rL)(R),v=[(m[0]-y[0])/d,(y[1]-m[1])/d],x=E.getSourceTiles().reduce((function(e,t){return e.concat(t.getFeatures())}),[]);let S=E.hitDetectionImageData[n];if(!S){const e=(0,f.Pq)(_.getTileSize(_.getZForResolution(d,s.zDirection))),t=this.renderedRotation_,i=[this.getRenderTransform(_.getTileCoordCenter(E.wrappedTileCoord),d,0,h.UN,e[0]*h.UN,e[1]*h.UN,0)];S=(0,h.TU)(e,i,x,r.getStyleFunction(),_.getTileCoordExtent(E.wrappedTileCoord),E.getReplayState(r).renderedResolution,t),E.hitDetectionImageData[n]=S}t((0,h.ix)(v,x,S))}))}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&void 0!==this.renderedLayerRevision_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}renderDeclutter(e){const t=this.context,i=t.globalAlpha;t.globalAlpha=this.getLayer().getOpacity();const r=e.viewHints,n=!(r[l.Z.ANIMATING]||r[l.Z.INTERACTING]),s=this.renderedTiles;for(let t=0,i=s.length;t<i;++t){const i=s[t],r=i.declutterExecutorGroups[(0,g.sq)(this.getLayer())];if(r)for(let t=r.length-1;t>=0;--t)r[t].execute(this.context,1,this.getTileRenderTransform(i,e),e.viewState.rotation,n,void 0,e.declutterTree)}t.globalAlpha=i}getTileRenderTransform(e,t){const i=t.pixelRatio,r=t.viewState,n=r.center,s=r.resolution,o=r.rotation,a=t.size,l=Math.round(a[0]*i),h=Math.round(a[1]*i),c=this.getLayer().getSource().getTileGridForProjection(t.viewState.projection),d=e.tileCoord,g=c.getTileCoordExtent(e.wrappedTileCoord),f=c.getTileCoordExtent(d,this.tmpExtent)[0]-g[0];return(0,u.Jp)((0,u.bA)(this.inversePixelTransform.slice(),1/i,1/i),this.getRenderTransform(n,s,o,i,l,h,f))}postRender(e,t){const i=t.viewHints,r=!(i[l.Z.ANIMATING]||i[l.Z.INTERACTING]);this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice(),this.renderedRotation_=t.viewState.rotation;const n=this.getLayer(),s=n.getRenderMode(),o=e.globalAlpha;e.globalAlpha=n.getOpacity();const a=m[s],h=t.viewState,u=h.rotation,d=n.getSource(),f=d.getTileGridForProjection(h.projection).getZForResolution(h.resolution,d.zDirection),p=this.renderedTiles,_=[],T=[];let E=!0;for(let i=p.length-1;i>=0;--i){const s=p[i];E=E&&!s.getReplayState(n).dirty;const o=s.executorGroups[(0,g.sq)(n)].filter((e=>e.hasExecutors(a)));if(0===o.length)continue;const l=this.getTileRenderTransform(s,t),h=s.tileCoord[0];let d=!1;const m=o[0].getClipCoords(l);if(m){for(let t=0,i=_.length;t<i;++t)if(f!==h&&h<T[t]){const i=_[t];(0,c.kK)([m[0],m[3],m[4],m[7]],[i[0],i[3],i[4],i[7]])&&(d||(e.save(),d=!0),e.beginPath(),e.moveTo(m[0],m[1]),e.lineTo(m[2],m[3]),e.lineTo(m[4],m[5]),e.lineTo(m[6],m[7]),e.moveTo(i[6],i[7]),e.lineTo(i[4],i[5]),e.lineTo(i[2],i[3]),e.lineTo(i[0],i[1]),e.clip())}_.push(m),T.push(h)}for(let t=0,i=o.length;t<i;++t)o[t].execute(e,1,l,u,r,a);d&&e.restore()}e.globalAlpha=o,this.ready=E,super.postRender(e,t)}renderFeature(e,t,i,r,n){if(!i)return!1;let s=!1;if(Array.isArray(i))for(let o=0,a=i.length;o<a;++o)s=(0,d.Pn)(r,e,i[o],t,this.boundHandleStyleImageChange_,void 0,n)||s;else s=(0,d.Pn)(r,e,i,t,this.boundHandleStyleImageChange_,void 0,n);return s}tileImageNeedsRender_(e){const t=this.getLayer();if("vector"===t.getRenderMode())return!1;const i=e.getReplayState(t),r=t.getRevision(),n=e.wantedResolution;return i.renderedTileResolution!==n||i.renderedTileRevision!==r}renderTileImage_(e,t){const i=this.getLayer(),r=e.getReplayState(i),n=i.getRevision(),s=e.executorGroups[(0,g.sq)(i)];r.renderedTileRevision=n;const o=e.wrappedTileCoord,a=o[0],l=i.getSource();let h=t.pixelRatio;const c=t.viewState.projection,d=l.getTileGridForProjection(c),f=d.getResolution(e.tileCoord[0]),p=t.pixelRatio/e.wantedResolution*f,m=d.getResolution(a),T=e.getContext(i);h=Math.round(Math.max(h,p/h));const E=l.getTilePixelSize(a,h,c);T.canvas.width=E[0],T.canvas.height=E[1];const R=h/p;if(1!==R){const e=(0,u.mc)(this.tmpTransform_);(0,u.bA)(e,R,R),T.setTransform.apply(T,e)}const y=d.getTileCoordExtent(o,this.tmpExtent),v=p/m,x=(0,u.mc)(this.tmpTransform_);(0,u.bA)(x,v,-v),(0,u.Iu)(x,-y[0],-y[3]);for(let e=0,t=s.length;e<t;++e)s[e].execute(T,R,x,0,!0,_[i.getRenderMode()]);r.renderedTileResolution=e.wantedResolution}}const E=T;var R=i(71534),y=i(438906);class v extends r.Z{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un;const i=e.renderMode||"hybrid";(0,y.h)("hybrid"==i||"vector"==i,28),this.renderMode_=i,this.setPreload(e.preload?e.preload:0),this.setUseInterimTilesOnError(void 0===e.useInterimTilesOnError||e.useInterimTilesOnError),this.getBackground,this.setBackground}createRenderer(){return new E(this)}getFeatures(e){return super.getFeatures(e)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(R.Z.PRELOAD)}getUseInterimTilesOnError(){return this.get(R.Z.USE_INTERIM_TILES_ON_ERROR)}setPreload(e){this.set(R.Z.PRELOAD,e)}setUseInterimTilesOnError(e){this.set(R.Z.USE_INTERIM_TILES_ON_ERROR,e)}}const x=v},9602:(e,t,i)=>{"use strict";i.d(t,{Z:()=>et});var r=i(935594),n=i(428192),s=i(115712),o=i(707245),a=i(859900),l=i(66575),h=i(173381),u=i(415107),c=i(949179);class d extends l.Z{constructor(e){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter_=e.gutter||0,this.helper_=e.helper,this.loaded=!1,this.ready=!1}setTile(e){if(e!==this.tile)if(this.tile&&this.tile.removeEventListener(h.Z.CHANGE,this.handleTileChange_),this.tile=e,this.loaded=e.getState()===a.Z.LOADED,this.loaded)this.uploadTile();else{if(e instanceof u.Z){const t=e.getImage();t instanceof Image&&!t.crossOrigin&&(t.crossOrigin="anonymous")}e.addEventListener(h.Z.CHANGE,this.handleTileChange_)}}uploadTile(){(0,c.O3)()}setReady(){this.ready=!0,this.dispatchEvent(h.Z.CHANGE)}handleTileChange_(){this.tile.getState()===a.Z.LOADED&&(this.loaded=!0,this.uploadTile())}disposeInternal(){this.tile.removeEventListener(h.Z.CHANGE,this.handleTileChange_)}}const g=d;var f=i(553980),p=i(591358);const _=34962,m=34963,T=35044,E=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function R(e,t){t=Object.assign({preserveDrawingBuffer:!0,antialias:!p.ME},t);const i=E.length;for(let r=0;r<i;++r)try{const i=e.getContext(E[r],t);if(i)return i}catch(e){}return null}var y=i(438906);function v(e){switch(e){case _:return Float32Array;case m:return Uint32Array;default:return Float32Array}}const x=class{constructor(e,t){this.array=null,this.type=e,(0,y.h)(e===_||e===m,62),this.usage=void 0!==t?t:35044}ofSize(e){return this.array=new(v(this.type))(e),this}fromArray(e){return this.array=v(this.type).from(e),this}fromArrayBuffer(e){return this.array=new(v(this.type))(e),this}getType(){return this.type}getArray(){return this.array}getUsage(){return this.usage}getSize(){return this.array?this.array.length:0}};var S=i(85386),w=i(450596);function b(e,t,i){const r=i?e.LINEAR:e.NEAREST;e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,r)}function C(e,t,i,r,n,s){const o=e.getGL();let a,l;i instanceof Float32Array?(a=o.FLOAT,e.getExtension("OES_texture_float"),l=null!==e.getExtension("OES_texture_float_linear")):(a=o.UNSIGNED_BYTE,l=!0),b(o,t,s&&l);const h=i.byteLength/r[1];let u,c=1;switch(h%8==0?c=8:h%4==0?c=4:h%2==0&&(c=2),n){case 1:u=o.LUMINANCE;break;case 2:u=o.LUMINANCE_ALPHA;break;case 3:u=o.RGB;break;case 4:u=o.RGBA;break;default:throw new Error(`Unsupported number of bands: ${n}`)}const d=o.getParameter(o.UNPACK_ALIGNMENT);o.pixelStorei(o.UNPACK_ALIGNMENT,c),o.texImage2D(o.TEXTURE_2D,0,u,r[0],r[1],0,u,a,i),o.pixelStorei(o.UNPACK_ALIGNMENT,d)}let P=null;const A=class extends g{constructor(e){super(e),this.textures=[],this.renderSize_=(0,w.Pq)(e.grid.getTileSize(e.tile.tileCoord[0])),this.bandCount=NaN;const t=new x(_,T);t.fromArray([0,1,1,1,1,0,0,0]),this.helper_.flushBufferData(t),this.coords=t,this.setTile(e.tile)}uploadTile(){const e=this.helper_,t=e.getGL(),i=this.tile;let r;this.textures.length=0,r=i instanceof u.Z||i instanceof o.Z?i.getImage():i.getData();const n=(0,f.G0)(r);if(n){const e=t.createTexture();return this.textures.push(e),this.bandCount=4,function(e,t,i,r){b(e,t,r),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i)}(t,e,n,i.interpolate),void this.setReady()}r=(0,f.px)(r);const s=i.getSize(),a=[s[0]+2*this.gutter_,s[1]+2*this.gutter_],l=r instanceof Float32Array,h=a[0]*a[1],c=l?Float32Array:Uint8Array,d=c.BYTES_PER_ELEMENT,g=r.byteLength/a[1];this.bandCount=Math.floor(g/d/a[0]);const p=Math.ceil(this.bandCount/4);if(1===p){const n=t.createTexture();return this.textures.push(n),C(e,n,r,a,this.bandCount,i.interpolate),void this.setReady()}const _=new Array(p);for(let e=0;e<p;++e){const i=t.createTexture();this.textures.push(i);const r=e<p-1?4:(this.bandCount-1)%4+1;_[e]=new c(h*r)}let m=0,T=0;const E=a[0]*this.bandCount;for(let e=0;e<a[1];++e){for(let e=0;e<E;++e){const t=r[T+e],i=Math.floor(m/this.bandCount),n=e%this.bandCount,s=_[Math.floor(n/4)];s[i*(s.length/h)+n%4]=t,++m}T+=g/d}for(let t=0;t<p;++t){const r=this.textures[t],n=_[t];C(e,r,n,a,n.length/h,i.interpolate)}this.setReady()}disposeInternal(){const e=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(let t=0;t<this.textures.length;++t)e.deleteTexture(this.textures[t]);this.tile.removeEventListener(h.Z.CHANGE,this.handleTileChange_)}getImagePixelData_(e,t,i){const r=this.gutter_,n=this.renderSize_[0],s=this.renderSize_[1];P||(P=(0,S.E4)(1,1,void 0,{willReadFrequently:!0})),P.clearRect(0,0,1,1);const o=e.width-2*r,a=e.height-2*r,l=r+Math.floor(o*(t/n)),h=r+Math.floor(a*(i/s));let u;try{P.drawImage(e,l,h,1,1,0,0,1,1),u=P.getImageData(0,0,1,1).data}catch(e){return P=null,null}return u}getArrayPixelData_(e,t,i,r){const n=this.gutter_,s=this.renderSize_[0],o=this.renderSize_[1],a=t[0],l=t[1],h=a+2*n,u=l+2*n,c=n+Math.floor(a*(i/s)),d=n+Math.floor(l*(r/o));if(e instanceof DataView){const t=e.byteLength/(h*u),i=t*(d*h+c),r=e.buffer.slice(i,i+t);return new DataView(r)}const g=this.bandCount*(d*h+c);return e.slice(g,g+this.bandCount)}getPixelData(e,t){if(!this.loaded)return null;if(this.tile instanceof f.ZP){const i=this.tile.getData(),r=(0,f.px)(i);if(r){const i=this.tile.getSize();return this.getArrayPixelData_(r,i,e,t)}return this.getImagePixelData_((0,f.G0)(i),e,t)}return this.getImagePixelData_(this.tile.getImage(),e,t)}};var L=i(83482),F=i(19473),O=i(302396),I=i(941173),M=i(397208);const U="webglcontextlost",G="webglcontextrestored";var N=i(580967);const D=class{constructor(e){this.gl_=e.webGlContext;const t=this.gl_;this.scaleRatio_=e.scaleRatio||1,this.renderTargetTexture_=t.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=t.createFramebuffer();const i=t.createShader(t.VERTEX_SHADER);t.shaderSource(i,e.vertexShader||"\n  precision mediump float;\n  \n  attribute vec2 a_position;\n  varying vec2 v_texCoord;\n  varying vec2 v_screenCoord;\n  \n  uniform vec2 u_screenSize;\n   \n  void main() {\n    v_texCoord = a_position * 0.5 + 0.5;\n    v_screenCoord = v_texCoord * u_screenSize;\n    gl_Position = vec4(a_position, 0.0, 1.0);\n  }\n"),t.compileShader(i);const r=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(r,e.fragmentShader||"\n  precision mediump float;\n   \n  uniform sampler2D u_image;\n  uniform float u_opacity;\n   \n  varying vec2 v_texCoord;\n   \n  void main() {\n    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;\n  }\n"),t.compileShader(r),this.renderTargetProgram_=t.createProgram(),t.attachShader(this.renderTargetProgram_,i),t.attachShader(this.renderTargetProgram_,r),t.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,-1,1,1,-1,1]),t.STATIC_DRAW),this.renderTargetAttribLocation_=t.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],e.uniforms&&Object.keys(e.uniforms).forEach((i=>{this.uniforms_.push({value:e.uniforms[i],location:t.getUniformLocation(this.renderTargetProgram_,i)})}))}getGL(){return this.gl_}init(e){const t=this.getGL(),i=[t.drawingBufferWidth*this.scaleRatio_,t.drawingBufferHeight*this.scaleRatio_];if(t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer()),t.viewport(0,0,i[0],i[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==i[0]||this.renderTargetTextureSize_[1]!==i[1]){this.renderTargetTextureSize_=i;const e=0,r=t.RGBA,n=0,s=t.RGBA,o=t.UNSIGNED_BYTE,a=null;t.bindTexture(t.TEXTURE_2D,this.renderTargetTexture_),t.texImage2D(t.TEXTURE_2D,e,r,i[0],i[1],n,s,o,a),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.renderTargetTexture_,0)}}apply(e,t,i,r){const n=this.getGL(),s=e.size;if(n.bindFramebuffer(n.FRAMEBUFFER,t?t.getFrameBuffer():null),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,this.renderTargetTexture_),!t){const t=(0,c.sq)(n.canvas);if(!e.renderTargets[t]){const i=n.getContextAttributes();i&&i.preserveDrawingBuffer&&(n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT)),e.renderTargets[t]=!0}}n.enable(n.BLEND),n.blendFunc(n.ONE,n.ONE_MINUS_SRC_ALPHA),n.viewport(0,0,n.drawingBufferWidth,n.drawingBufferHeight),n.bindBuffer(n.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),n.useProgram(this.renderTargetProgram_),n.enableVertexAttribArray(this.renderTargetAttribLocation_),n.vertexAttribPointer(this.renderTargetAttribLocation_,2,n.FLOAT,!1,0,0),n.uniform2f(this.renderTargetUniformLocation_,s[0],s[1]),n.uniform1i(this.renderTargetTextureLocation_,0);const o=e.layerStatesArray[e.layerIndex].opacity;n.uniform1f(this.renderTargetOpacityLocation_,o),this.applyUniforms(e),i&&i(n,e),n.drawArrays(n.TRIANGLES,0,6),r&&r(n,e)}getFrameBuffer(){return this.frameBuffer_}applyUniforms(e){const t=this.getGL();let i,r=1;this.uniforms_.forEach((function(n){if(i="function"==typeof n.value?n.value(e):n.value,i instanceof HTMLCanvasElement||i instanceof ImageData)n.texture||(n.texture=t.createTexture()),t.activeTexture(t[`TEXTURE${r}`]),t.bindTexture(t.TEXTURE_2D,n.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),i instanceof ImageData?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,i.width,i.height,0,t.UNSIGNED_BYTE,new Uint8Array(i.data)):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i),t.uniform1i(n.location,r++);else if(Array.isArray(i))switch(i.length){case 2:return void t.uniform2f(n.location,i[0],i[1]);case 3:return void t.uniform3f(n.location,i[0],i[1],i[2]);case 4:return void t.uniform4f(n.location,i[0],i[1],i[2],i[3]);default:return}else"number"==typeof i&&t.uniform1f(n.location,i)}))}};var Z=i(913580),j=i(782359);function B(e,t){return e[0]=t[0],e[1]=t[1],e[4]=t[2],e[5]=t[3],e[12]=t[4],e[13]=t[5],e}const $=5121,z=5123,V=5125,k=5126,X={};function K(e){return"shared/"+e}let q=0;class Y extends N.Z{constructor(e){super(),e=e||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=e.canvasCacheKey?K(e.canvasCacheKey):function(){const e="unique/"+q;return q+=1,e}(),this.canvas_=function(e){let t=X[e];if(!t){const i=document.createElement("canvas");i.style.position="absolute",i.style.left="0",t={users:0,canvas:i},X[e]=t}return t.users+=1,t.canvas}(this.canvasCacheKey_),this.gl_=R(this.canvas_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.canvas_.addEventListener(U,this.boundHandleWebGLContextLost_),this.canvas_.addEventListener(G,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=(0,j.Ue)(),this.offsetScaleMatrix_=(0,j.Ue)(),this.tmpMat4_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],e.uniforms&&this.setUniforms(e.uniforms),this.postProcessPasses_=e.postProcesses?e.postProcesses.map((e=>new D({webGlContext:this.gl_,scaleRatio:e.scaleRatio,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms}))):[new D({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(e){this.uniforms_=[];for(const t in e)this.uniforms_.push({name:t,value:e[t]})}canvasCacheKeyMatches(e){return this.canvasCacheKey_===K(e)}getExtension(e){if(e in this.extensionCache_)return this.extensionCache_[e];const t=this.gl_.getExtension(e);return this.extensionCache_[e]=t,t}bindBuffer(e){const t=this.gl_,i=(0,c.sq)(e);let r=this.bufferCache_[i];r||(r={buffer:e,webGlBuffer:t.createBuffer()},this.bufferCache_[i]=r),t.bindBuffer(e.getType(),r.webGlBuffer)}flushBufferData(e){const t=this.gl_;this.bindBuffer(e),t.bufferData(e.getType(),e.getArray(),e.getUsage())}deleteBuffer(e){const t=this.gl_,i=(0,c.sq)(e),r=this.bufferCache_[i];r&&!t.isContextLost()&&t.deleteBuffer(r.webGlBuffer),delete this.bufferCache_[i]}disposeInternal(){this.canvas_.removeEventListener(U,this.boundHandleWebGLContextLost_),this.canvas_.removeEventListener(G,this.boundHandleWebGLContextRestored_),function(e){const t=X[e];if(!t)return;if(t.users-=1,t.users>0)return;const i=R(t.canvas).getExtension("WEBGL_lose_context");i&&i.loseContext(),delete X[e]}(this.canvasCacheKey_),delete this.gl_,delete this.canvas_}prepareDraw(e,t){const i=this.gl_,r=this.getCanvas(),n=e.size,s=e.pixelRatio;r.width===n[0]*s&&r.height===n[1]*s||(r.width=n[0]*s,r.height=n[1]*s,r.style.width=n[0]+"px",r.style.height=n[1]+"px");for(let t=this.postProcessPasses_.length-1;t>=0;t--)this.postProcessPasses_[t].init(e);i.bindTexture(i.TEXTURE_2D,null),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),i.enable(i.BLEND),i.blendFunc(i.ONE,t?i.ZERO:i.ONE_MINUS_SRC_ALPHA)}bindTexture(e,t,i){const r=this.gl_;r.activeTexture(r.TEXTURE0+t),r.bindTexture(r.TEXTURE_2D,e),r.uniform1i(this.getUniformLocation(i),t)}prepareDrawToRenderTarget(e,t,i){const r=this.gl_,n=t.getSize();r.bindFramebuffer(r.FRAMEBUFFER,t.getFramebuffer()),r.viewport(0,0,n[0],n[1]),r.bindTexture(r.TEXTURE_2D,t.getTexture()),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),r.enable(r.BLEND),r.blendFunc(r.ONE,i?r.ZERO:r.ONE_MINUS_SRC_ALPHA)}drawElements(e,t){const i=this.gl_;this.getExtension("OES_element_index_uint");const r=i.UNSIGNED_INT,n=t-e,s=4*e;i.drawElements(i.TRIANGLES,n,r,s)}finalizeDraw(e,t,i){for(let r=0,n=this.postProcessPasses_.length;r<n;r++)r===n-1?this.postProcessPasses_[r].apply(e,null,t,i):this.postProcessPasses_[r].apply(e,this.postProcessPasses_[r+1])}getCanvas(){return this.canvas_}getGL(){return this.gl_}applyFrameState(e){const t=e.size,i=e.viewState.rotation,r=e.pixelRatio,n=(0,j.mc)(this.offsetScaleMatrix_);(0,j.bA)(n,2/t[0],2/t[1]);const s=(0,j.mc)(this.offsetRotateMatrix_);0!==i&&(0,j.U1)(s,-i),this.setUniformMatrixValue("u_offsetScaleMatrix",B(this.tmpMat4_,n)),this.setUniformMatrixValue("u_offsetRotateMatrix",B(this.tmpMat4_,s)),this.setUniformFloatValue("u_time",.001*(Date.now()-this.startTime_)),this.setUniformFloatValue("u_zoom",e.viewState.zoom),this.setUniformFloatValue("u_resolution",e.viewState.resolution),this.setUniformFloatValue("u_pixelRatio",r),this.setUniformFloatVec2("u_viewportSizePx",[t[0],t[1]])}applyUniforms(e){const t=this.gl_;let i,r=0;this.uniforms_.forEach((n=>{if(i="function"==typeof n.value?n.value(e):n.value,i instanceof HTMLCanvasElement||i instanceof HTMLImageElement||i instanceof ImageData)n.texture||(n.prevValue=void 0,n.texture=t.createTexture()),t.activeTexture(t[`TEXTURE${r}`]),t.bindTexture(t.TEXTURE_2D,n.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),(!(i instanceof HTMLImageElement)||i.complete)&&n.prevValue!==i&&(n.prevValue=i,t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i)),t.uniform1i(this.getUniformLocation(n.name),r++);else if(Array.isArray(i)&&6===i.length)this.setUniformMatrixValue(n.name,B(this.tmpMat4_,i));else if(Array.isArray(i)&&i.length<=4)switch(i.length){case 2:return void t.uniform2f(this.getUniformLocation(n.name),i[0],i[1]);case 3:return void t.uniform3f(this.getUniformLocation(n.name),i[0],i[1],i[2]);case 4:return void t.uniform4f(this.getUniformLocation(n.name),i[0],i[1],i[2],i[3]);default:return}else"number"==typeof i&&t.uniform1f(this.getUniformLocation(n.name),i)}))}useProgram(e,t){this.gl_.useProgram(e),this.currentProgram_=e,this.applyFrameState(t),this.applyUniforms(t)}compileShader(e,t){const i=this.gl_,r=i.createShader(t);return i.shaderSource(r,e),i.compileShader(r),r}getProgram(e,t){const i=this.gl_,r=this.compileShader(e,i.FRAGMENT_SHADER),n=this.compileShader(t,i.VERTEX_SHADER),s=i.createProgram();if(i.attachShader(s,r),i.attachShader(s,n),i.linkProgram(s),!i.getShaderParameter(r,i.COMPILE_STATUS)){const e=`Fragment shader compilation failed: ${i.getShaderInfoLog(r)}`;throw new Error(e)}if(i.deleteShader(r),!i.getShaderParameter(n,i.COMPILE_STATUS)){const e=`Vertex shader compilation failed: ${i.getShaderInfoLog(n)}`;throw new Error(e)}if(i.deleteShader(n),!i.getProgramParameter(s,i.LINK_STATUS)){const e=`GL program linking failed: ${i.getProgramInfoLog(s)}`;throw new Error(e)}return s}getUniformLocation(e){const t=(0,c.sq)(this.currentProgram_);return void 0===this.uniformLocationsByProgram_[t]&&(this.uniformLocationsByProgram_[t]={}),void 0===this.uniformLocationsByProgram_[t][e]&&(this.uniformLocationsByProgram_[t][e]=this.gl_.getUniformLocation(this.currentProgram_,e)),this.uniformLocationsByProgram_[t][e]}getAttributeLocation(e){const t=(0,c.sq)(this.currentProgram_);return void 0===this.attribLocationsByProgram_[t]&&(this.attribLocationsByProgram_[t]={}),void 0===this.attribLocationsByProgram_[t][e]&&(this.attribLocationsByProgram_[t][e]=this.gl_.getAttribLocation(this.currentProgram_,e)),this.attribLocationsByProgram_[t][e]}makeProjectionTransform(e,t){const i=e.size,r=e.viewState.rotation,n=e.viewState.resolution,s=e.viewState.center;return(0,j.qC)(t,0,0,2/(n*i[0]),2/(n*i[1]),-r,-s[0],-s[1]),t}setUniformFloatValue(e,t){this.gl_.uniform1f(this.getUniformLocation(e),t)}setUniformFloatVec2(e,t){this.gl_.uniform2fv(this.getUniformLocation(e),t)}setUniformFloatVec4(e,t){this.gl_.uniform4fv(this.getUniformLocation(e),t)}setUniformMatrixValue(e,t){this.gl_.uniformMatrix4fv(this.getUniformLocation(e),!1,t)}enableAttributeArray_(e,t,i,r,n){const s=this.getAttributeLocation(e);s<0||(this.gl_.enableVertexAttribArray(s),this.gl_.vertexAttribPointer(s,t,i,!1,r,n))}enableAttributes(e){const t=function(e){let t=0;for(let i=0;i<e.length;i++){const r=e[i];t+=r.size*W(r.type)}return t}(e);let i=0;for(let r=0;r<e.length;r++){const n=e[r];this.enableAttributeArray_(n.name,n.size,n.type||5126,t,i),i+=n.size*W(n.type)}}handleWebGLContextLost(){(0,Z.Z)(this.bufferCache_),this.currentProgram_=null}handleWebGLContextRestored(){}createTexture(e,t,i){const r=this.gl_;i=i||r.createTexture();const n=r.RGBA,s=r.RGBA,o=r.UNSIGNED_BYTE;return r.bindTexture(r.TEXTURE_2D,i),t?r.texImage2D(r.TEXTURE_2D,0,n,s,o,t):r.texImage2D(r.TEXTURE_2D,0,n,e[0],e[1],0,s,o,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),i}}function W(e){switch(e){case $:return Uint8Array.BYTES_PER_ELEMENT;case z:return Uint16Array.BYTES_PER_ELEMENT;case V:return Uint32Array.BYTES_PER_ELEMENT;default:return Float32Array.BYTES_PER_ELEMENT}}const H=Y;class J extends O.Z{constructor(e,t){super(e),t=t||{},this.inversePixelTransform_=(0,j.Ue)(),this.pixelContext_=null,this.postProcesses_=t.postProcesses,this.uniforms_=t.uniforms,this.helper,e.addChangeListener(n.Z.MAP,this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(e,t){const i=this.getLayer();if(i.hasListener(M.Z.PRECOMPOSE)){const r=new I.Z(M.Z.PRECOMPOSE,void 0,t,e);i.dispatchEvent(r)}}dispatchPostComposeEvent(e,t){const i=this.getLayer();if(i.hasListener(M.Z.POSTCOMPOSE)){const r=new I.Z(M.Z.POSTCOMPOSE,void 0,t,e);i.dispatchEvent(r)}}reset(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(e){if(this.getLayer().getRenderSource()){let t,i=!0,r=-1;for(let n=0,s=e.layerStatesArray.length;n<s;n++){const s=e.layerStatesArray[n].layer,o=s.getRenderer();if(!(o instanceof J)){i=!0;continue}const a=s.getClassName();if((i||a!==t)&&(r+=1,i=!1),t=a,o===this)break}const n="map/"+e.mapId+"/group/"+r;this.helper&&this.helper.canvasCacheKeyMatches(n)||(this.removeHelper(),this.helper=new H({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:n}),t&&(this.helper.getCanvas().className=t),this.afterHelperCreated())}return this.prepareFrameInternal(e)}afterHelperCreated(){}prepareFrameInternal(e){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(e,t,i){const r=this.getLayer();if(r.hasListener(e)){(0,j.qC)(this.inversePixelTransform_,0,0,i.pixelRatio,-i.pixelRatio,0,0,-i.size[1]);const n=new I.Z(e,this.inversePixelTransform_,i,t);r.dispatchEvent(n)}}preRender(e,t){this.dispatchRenderEvent_(M.Z.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(M.Z.POSTRENDER,e,t)}}const Q=J;var ee=i(179682),te=i(570701),ie=i(218672),re=i(421915);const ne={};function se(e){return 2*(1-1/(e+1))-1}function oe(e,t){return e.tileIds.has((0,c.sq)(t))}function ae(e,t,i){const r=e.representationsByZ;i in r||(r[i]=new Set),r[i].add(t),e.tileIds.add((0,c.sq)(t.tile))}function le(e,t){const i=e.layerStatesArray[e.layerIndex];i.extent&&(t=(0,re.Ed)(t,(0,ie.dY)(i.extent,e.viewState.projection)));const r=i.layer.getRenderSource();if(!r.getWrapX()){const i=r.getTileGridForProjection(e.viewState.projection).getExtent();i&&(t=(0,re.Ed)(t,i))}return t}function he(e,t){return`${e.getKey()},${(0,te.km)(t)}`}const ue=class extends Q{constructor(e,t){super(e,{uniforms:t.uniforms,postProcesses:t.postProcesses}),this.renderComplete=!1,this.tileTransform_=(0,j.Ue)(),this.tempMat4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.tempTileRange_=new F.Z(0,0,0,0),this.tempTileCoord_=(0,te.T9)(0,0,0),this.tempSize_=[0,0];const i=void 0!==t.cacheSize?t.cacheSize:512;this.tileRepresentationCache=new L.Z(i),this.frameState=null,this.projection_=void 0}reset(e){super.reset({uniforms:e.uniforms})}isDrawableTile_(e){const t=this.getLayer(),i=e.getState(),r=t.getUseInterimTilesOnError();return i==a.Z.LOADED||i==a.Z.EMPTY||i==a.Z.ERROR&&!r}prepareFrameInternal(e){this.projection_?e.viewState.projection!==this.projection_&&(this.clearCache(),this.projection_=e.viewState.projection):this.projection_=e.viewState.projection;const t=this.getLayer().getRenderSource();return!!t&&!(0,re.xb)(le(e,e.extent))&&"ready"===t.getState()}createTileRepresentation(e){return(0,c.O3)()}enqueueTiles(e,t,i,r,n){const s=e.viewState,o=this.getLayer(),l=o.getRenderSource(),h=l.getTileGridForProjection(s.projection),u=l.getGutterForProjection(s.projection),d=(0,c.sq)(l);d in e.wantedTiles||(e.wantedTiles[d]={});const g=e.wantedTiles[d],f=this.tileRepresentationCache,p=o.getMapInternal(),_=Math.max(i-n,h.getMinZoom(),h.getZForResolution(Math.min(o.getMaxResolution(),p?p.getView().getResolutionForZoom(Math.max(o.getMinZoom(),0)):h.getResolution(0)),l.zDirection));for(let n=i;n>=_;--n){const i=h.getTileRangeForExtentAndZ(t,n,this.tempTileRange_),o=h.getResolution(n);for(let t=i.minX;t<=i.maxX;++t)for(let c=i.minY;c<=i.maxY;++c){const i=(0,te.T9)(n,t,c,this.tempTileCoord_),p=he(l,i);let _,m;if(f.containsKey(p)&&(_=f.get(p),m=_.tile),_&&_.tile.key===l.getKey()||(m=l.getTile(n,t,c,e.pixelRatio,s.projection)),oe(r,m))continue;if(_)if(this.isDrawableTile_(m))_.setTile(m);else{const e=m.getInterimTile();_.setTile(e)}else _=this.createTileRepresentation({tile:m,grid:h,helper:this.helper,gutter:u}),f.set(p,_);ae(r,_,n);const T=m.getKey();g[T]=!0,m.getState()===a.Z.IDLE&&(e.tileQueue.isKeyQueued(T)||e.tileQueue.enqueue([m,d,h.getTileCoordCenter(i),o]))}}}beforeTilesRender(e,t){this.helper.prepareDraw(this.frameState,!t)}renderTile(e,t,i,r,n,s,o,a,l,h,u){}renderFrame(e){this.frameState=e,this.renderComplete=!0;const t=this.helper.getGL();this.preRender(t,e);const i=e.viewState,r=this.getLayer(),n=r.getRenderSource(),l=n.getTileGridForProjection(i.projection),h=n.getGutterForProjection(i.projection),u=le(e,e.extent),d=l.getZForResolution(i.resolution,n.zDirection),g={tileIds:new Set,representationsByZ:{}},f=r.getPreload();if(e.nextExtent){const t=l.getZForResolution(i.nextResolution,n.zDirection),r=le(e,e.nextExtent);this.enqueueTiles(e,r,t,g,f)}this.enqueueTiles(e,u,d,g,0),f>0&&setTimeout((()=>{this.enqueueTiles(e,u,d-1,g,f-1)}),0);const p={},_=(0,c.sq)(this),m=e.time;let T=!1;for(const e of g.representationsByZ[d]){const t=e.tile;if((t instanceof o.Z||t instanceof s.Z)&&t.getState()===a.Z.EMPTY)continue;const i=t.tileCoord;if(e.loaded){const e=t.getAlpha(_,m);if(1===e){t.endTransition(_);continue}T=!0,p[(0,te.km)(i)]=e}if(this.renderComplete=!1,this.findAltTiles_(l,i,d+1,g))continue;const r=l.getMinZoom();for(let e=d-1;e>=r&&!this.findAltTiles_(l,i,e,g);--e);}this.beforeTilesRender(e,T);const E=g.representationsByZ,R=Object.keys(E).map(Number).sort(ee.j2);for(let t=0,i=R.length;t<i;++t){const i=R[t];for(const t of E[i]){if(!t.loaded)continue;const r=t.tile.tileCoord,n=(0,te.km)(r),s=n in p?p[n]:1;s<1&&(e.animate=!0);const o=l.getResolution(i),a=(0,w.Pq)(l.getTileSize(i),this.tempSize_),c=l.getOrigin(i),d=l.getTileCoordExtent(r),g=se(i),f=e.viewState,_=f.center[0],m=f.center[1],T=a[0]+2*h,E=a[1]+2*h,R=T/E,y=(_-c[0])/(a[0]*o),v=(c[1]-m)/(a[1]*o),x=f.resolution/o,S=r[1],b=r[2];(0,j.mc)(this.tileTransform_),(0,j.bA)(this.tileTransform_,2/(e.size[0]*x/T),-2/(e.size[1]*x/T)),(0,j.U1)(this.tileTransform_,f.rotation),(0,j.bA)(this.tileTransform_,1,1/R),(0,j.Iu)(this.tileTransform_,(a[0]*(S-y)-h)/T,(a[1]*(b-v)-h)/E),this.renderTile(t,this.tileTransform_,e,u,o,a,c,d,g,h,s)}}this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const y=this.helper.getCanvas(),v=this.tileRepresentationCache;for(;v.canExpireCache();)v.pop().dispose();return e.postRenderFunctions.push((function(e,t){n.updateCacheSize(.1,t.viewState.projection),n.expireCache(t.viewState.projection,ne)})),this.postRender(t,e),y}findAltTiles_(e,t,i,r){const n=e.getTileRangeForTileCoordAndZ(t,i,this.tempTileRange_);if(!n)return!1;let s=!0;const o=this.tileRepresentationCache,a=this.getLayer().getRenderSource();for(let e=n.minX;e<=n.maxX;++e)for(let t=n.minY;t<=n.maxY;++t){const n=he(a,[i,e,t]);let l=!1;if(o.containsKey(n)){const e=o.get(n);e.loaded&&!oe(r,e.tile)&&(ae(r,e,i),l=!0)}l||(s=!1)}return s}clearCache(){const e=this.tileRepresentationCache;e.forEach((e=>e.dispose())),e.clear()}removeHelper(){this.helper&&this.clearCache(),super.removeHelper()}disposeInternal(){super.disposeInternal(),delete this.frameState}},ce="u_tileTransform",de="u_transitionAlpha",ge="u_depth",fe="u_renderExtent",pe="u_resolution",_e="u_zoom",me="u_tileTextures",Te="u_texturePixelWidth",Ee="u_texturePixelHeight",Re="u_textureResolution",ye="u_textureOriginX",ve="u_textureOriginY",xe="a_textureCoord",Se=[{name:xe,size:2,type:k}],we=class extends ue{constructor(e,t){super(e,t),this.program_,this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.indices_=new x(m,T),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=t.paletteTextures||[]}reset(e){super.reset(e),this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}createTileRepresentation(e){return new A(e)}beforeTilesRender(e,t){super.beforeTilesRender(e,t),this.helper.useProgram(this.program_,e)}renderTile(e,t,i,r,n,s,o,a,l,h,u){const c=this.helper.getGL();this.helper.bindBuffer(e.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(Se);let d=0;for(;d<e.textures.length;){const t=`${me}[${d}]`;this.helper.bindTexture(e.textures[d],d,t),++d}for(let e=0;e<this.paletteTextures_.length;++e){const t=this.paletteTextures_[e],i=t.getTexture(c);this.helper.bindTexture(i,d,t.name),++d}const g=i.viewState,f=s[0]+2*h,p=s[1]+2*h,_=e.tile.tileCoord,m=_[1],T=_[2];this.helper.setUniformMatrixValue(ce,B(this.tempMat4,t)),this.helper.setUniformFloatValue(de,u),this.helper.setUniformFloatValue(ge,l);let E=r;h>0&&(E=a,(0,re.Ed)(E,r,E)),this.helper.setUniformFloatVec4(fe,E),this.helper.setUniformFloatValue(pe,g.resolution),this.helper.setUniformFloatValue(_e,g.zoom),this.helper.setUniformFloatValue(Te,f),this.helper.setUniformFloatValue(Ee,p),this.helper.setUniformFloatValue(Re,n),this.helper.setUniformFloatValue(ye,o[0]+m*s[0]*n-h*n),this.helper.setUniformFloatValue(ve,o[1]-T*s[1]*n+h*n),this.helper.drawElements(0,this.indices_.getSize())}getData(e){if(!this.helper.getGL())return null;const t=this.frameState;if(!t)return null;const i=this.getLayer(),r=(0,j.nn)(t.pixelToCoordinateTransform,e.slice()),n=t.viewState,l=i.getExtent();if(l&&!(0,re.b8)((0,ie.dY)(l,n.projection),r))return null;const h=i.getSources((0,re.hI)([r]),n.resolution);let u,c,d;for(u=h.length-1;u>=0;--u)if(c=h[u],"ready"===c.getState()){if(d=c.getTileGridForProjection(n.projection),c.getWrapX())break;const e=d.getExtent();if(!e||(0,re.b8)(e,r))break}if(u<0)return null;const g=this.tileRepresentationCache;for(let e=d.getZForResolution(n.resolution);e>=d.getMinZoom();--e){const t=d.getTileCoordForCoordAndZ(r,e),i=he(c,t);if(!g.containsKey(i))continue;const n=g.get(i),l=n.tile;if((l instanceof o.Z||l instanceof s.Z)&&l.getState()===a.Z.EMPTY)return null;if(!n.loaded)continue;const h=d.getOrigin(e),u=(0,w.Pq)(d.getTileSize(e)),f=d.getResolution(e),p=(r[0]-h[0])/f-t[1]*u[0],_=(h[1]-r[1])/f-t[2]*u[1];return n.getPixelData(p,_)}return null}disposeInternal(){const e=this.helper;e&&(e.getGL().deleteProgram(this.program_),delete this.program_,e.deleteBuffer(this.indices_)),super.disposeInternal(),delete this.indices_}},be=class{constructor(e,t){this.name=e,this.data=t,this.texture_=null}getTexture(e){if(!this.texture_){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.data.length/4,1,0,e.RGBA,e.UNSIGNED_BYTE,this.data),this.texture_=t}return this.texture_}};var Ce=i(208913);const Pe={NUMBER:1,STRING:2,COLOR:4,BOOLEAN:8,NUMBER_ARRAY:16,ANY:31,NONE:0},Ae={};function Le(e){if("number"==typeof e)return Pe.NUMBER;if("boolean"==typeof e)return Pe.BOOLEAN;if("string"==typeof e)return(0,Ce.e1)(e)?Pe.COLOR|Pe.STRING:Pe.STRING;if(!Array.isArray(e))throw new Error(`Unhandled value type: ${JSON.stringify(e)}`);const t=e;if(t.every((function(e){return"number"==typeof e})))return 3===t.length||4===t.length?Pe.COLOR|Pe.NUMBER_ARRAY:Pe.NUMBER_ARRAY;if("string"!=typeof t[0])throw new Error(`Expected an expression operator but received: ${JSON.stringify(t)}`);const i=Ae[t[0]];if(void 0===i)throw new Error(`Unrecognized expression operator: ${JSON.stringify(t)}`);return i.getReturnType(t.slice(1))}function Fe(e){const t=[];return(e&Pe.NUMBER)>0&&t.push("number"),(e&Pe.COLOR)>0&&t.push("color"),(e&Pe.BOOLEAN)>0&&t.push("boolean"),(e&Pe.NUMBER_ARRAY)>0&&t.push("number[]"),(e&Pe.STRING)>0&&t.push("string"),t.length>0?t.join(", "):"(no type)"}function Oe(e){const t=e.toString();return t.includes(".")?t:t+".0"}function Ie(e){if(e.length<2||e.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${e.length}(${e.map(Oe).join(", ")})`}function Me(e,t){return void 0===e.stringLiteralsMap[t]&&(e.stringLiteralsMap[t]=Object.keys(e.stringLiteralsMap).length),e.stringLiteralsMap[t]}function Ue(e,t,i){const r=void 0!==i?i:Pe.NUMBER;if(Array.isArray(t)&&"string"==typeof t[0]){const i=Ae[t[0]];if(void 0===i)throw new Error(`Unrecognized expression operator: ${JSON.stringify(t)}`);return i.toGlsl(e,t.slice(1),r)}const n=Le(t)&r;if(Ve(t,n,""),(n&Pe.NUMBER)>0)return Oe(t);if((n&Pe.BOOLEAN)>0)return t.toString();if((n&Pe.STRING)>0)return function(e,t){return Oe(Me(e,t))}(e,t.toString());if((n&Pe.COLOR)>0)return function(e){const t=(0,Ce._2)(e),i=t.length>3?t[3]:1;return Ie([t[0]/255*i,t[1]/255*i,t[2]/255*i,i])}(t);if((n&Pe.NUMBER_ARRAY)>0)return Ie(t);throw new Error(`Unexpected expression ${t} (expected type ${Fe(r)})`)}function Ge(e){if(!(Le(e)&Pe.NUMBER))throw new Error(`A numeric value was expected, got ${JSON.stringify(e)} instead`)}function Ne(e){for(let t=0;t<e.length;t++)Ge(e[t])}function De(e){if(!(Le(e)&Pe.STRING))throw new Error(`A string value was expected, got ${JSON.stringify(e)} instead`)}function Ze(e){if(!(Le(e)&Pe.BOOLEAN))throw new Error(`A boolean value was expected, got ${JSON.stringify(e)} instead`)}function je(e,t){if(e.length!==t)throw new Error(`Exactly ${t} arguments were expected, got ${e.length} instead`)}function Be(e,t){if(e.length<t)throw new Error(`At least ${t} arguments were expected, got ${e.length} instead`)}function $e(e,t){if(e.length>t)throw new Error(`At most ${t} arguments were expected, got ${e.length} instead`)}function ze(e){if(e.length%2!=0)throw new Error(`An even amount of arguments was expected, got ${JSON.stringify(e)} instead`)}function Ve(e,t,i){if(t===Pe.NONE)throw new Error(`No matching type was found for the following expression ${i}: ${JSON.stringify(e)}`)}function ke(e,t,i){if(Ve(e,t,i),r=t,Math.log2(r)%1!=0)throw new Error(`Expected to have a unique type for the following expression ${i}: ${JSON.stringify(e)}\nGot the following types instead: ${Fe(t)}`);var r}function Xe(e,t,i,r){if((t&i)===Pe.NONE)throw new Error(`Expected the ${r} type of the following expression: ${JSON.stringify(e)} to be of the following types: ${Fe(i)}\nGot these types instead: ${Fe(t)}`)}function Ke(e){return"u_var_"+e}Ae.get={getReturnType:function(e){return 2===e.length?function(e){switch(e){case"string":return Pe.STRING;case"color":return Pe.COLOR;case"number":return Pe.NUMBER;case"boolean":return Pe.BOOLEAN;case"number[]":return Pe.NUMBER_ARRAY;default:throw new Error(`Unrecognized type hint: ${e}`)}}(e[1]):Pe.ANY},toGlsl:function(e,t,i){Be(t,1),$e(t,2),De(t[0]);const r=i&Ae.get.getReturnType(t);ke(["get",...t],r,"");const n=t[0].toString(),s=e.attributes.find((e=>e.name===n));if(s){if(r!==s.type)throw new Error(`The following attribute was used in different places with incompatible types: ${n}\nTypes were: ${Fe(s.type)} and ${Fe(r)}`)}else e.attributes.push({name:n,type:r});return(e.inFragmentShader?"v_":"a_")+n}},Ae.var={getReturnType:function(){return Pe.ANY},toGlsl:function(e,t,i){je(t,1),De(t[0]);const r=t[0].toString();if(!e.style.variables||void 0===e.style.variables[r])throw new Error(`The following variable is missing from the style: ${r}`);const n=i&Le(e.style.variables[r]);ke(["var",...t],n,"");const s=e.variables.find((e=>e.name===r));if(s){if(n!==s.type)throw new Error(`The following variable was used in different places with incompatible types: ${r}\nTypes were: ${Fe(s.type)} and ${Fe(n)}`)}else e.variables.push({name:r,type:n});return Ke(r)}};const qe="u_paletteTextures";Ae.palette={getReturnType:function(){return Pe.COLOR},toGlsl:function(e,t){je(t,2),Ge(t[0]);const i=Ue(e,t[0]),r=t[1];if(!Array.isArray(r))throw new Error("The second argument of palette must be an array");const n=r.length,s=new Uint8Array(4*n);for(let e=0;e<n;e++){const t=r[e];let i;if("string"==typeof t)i=(0,Ce.mL)(t);else{if(!Array.isArray(t))throw new Error("The second argument of palette must be an array of strings or colors");const e=t.length;if(4===e)i=t;else{if(3!==e)throw new Error(`Expected palette color to have 3 or 4 values, got ${e}`);i=[t[0],t[1],t[2],1]}}const n=4*e;s[n]=i[0],s[n+1]=i[1],s[n+2]=i[2],s[n+3]=255*i[3]}e.paletteTextures||(e.paletteTextures=[]);const o=`${qe}[${e.paletteTextures.length}]`,a=new be(o,s);return e.paletteTextures.push(a),`texture2D(${o}, vec2((${i} + 0.5) / ${n}.0, 0.5))`}};const Ye="getBandValue";function We(e){return{getReturnType:function(){return Pe.BOOLEAN},toGlsl:function(t,i){je(i,2);let r=Pe.ANY;for(let e=0;e<i.length;e++)r&=Le(i[e]);if(r===Pe.NONE)throw new Error(`All arguments should be of compatible type, got ${JSON.stringify(i)} instead`);return r&=~Pe.COLOR,`(${Ue(t,i[0],r)} ${e} ${Ue(t,i[1],r)})`}}}function He(e){return{getReturnType:function(){return Pe.BOOLEAN},toGlsl:function(t,i){Be(i,2);for(let e=0;e<i.length;e++)Ze(i[e]);let r=i.map((e=>Ue(t,e,Pe.BOOLEAN))).join(` ${e} `);return r=`(${r})`,r}}}function Je(e,t){const i=`\n    attribute vec2 ${xe};\n    uniform mat4 ${ce};\n    uniform float ${Te};\n    uniform float ${Ee};\n    uniform float ${Re};\n    uniform float ${ye};\n    uniform float ${ve};\n    uniform float ${ge};\n\n    varying vec2 v_textureCoord;\n    varying vec2 v_mapCoord;\n\n    void main() {\n      v_textureCoord = ${xe};\n      v_mapCoord = vec2(\n        ${ye} + ${Re} * ${Te} * v_textureCoord[0],\n        ${ve} - ${Re} * ${Ee} * v_textureCoord[1]\n      );\n      gl_Position = ${ce} * vec4(${xe}, ${ge}, 1.0);\n    }\n  `,r={inFragmentShader:!0,variables:[],attributes:[],stringLiteralsMap:{},functions:{},bandCount:t,style:e},n=[];if(void 0!==e.color){const t=Ue(r,e.color,Pe.COLOR);n.push(`color = ${t};`)}if(void 0!==e.contrast){const t=Ue(r,e.contrast,Pe.NUMBER);n.push(`color.rgb = clamp((${t} + 1.0) * color.rgb - (${t} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(void 0!==e.exposure){const t=Ue(r,e.exposure,Pe.NUMBER);n.push(`color.rgb = clamp((${t} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(void 0!==e.saturation){const t=Ue(r,e.saturation,Pe.NUMBER);n.push(`\n      float saturation = ${t} + 1.0;\n      float sr = (1.0 - saturation) * 0.2126;\n      float sg = (1.0 - saturation) * 0.7152;\n      float sb = (1.0 - saturation) * 0.0722;\n      mat3 saturationMatrix = mat3(\n        sr + saturation, sr, sr,\n        sg, sg + saturation, sg,\n        sb, sb, sb + saturation\n      );\n      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));\n    `)}if(void 0!==e.gamma){const t=Ue(r,e.gamma,Pe.NUMBER);n.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${t}));`)}if(void 0!==e.brightness){const t=Ue(r,e.brightness,Pe.NUMBER);n.push(`color.rgb = clamp(color.rgb + ${t}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const s={},o=r.variables.length;if(o>1&&!e.variables)throw new Error(`Missing variables in style (expected ${r.variables})`);for(let t=0;t<o;++t){const i=r.variables[t];if(!(i.name in e.variables))throw new Error(`Missing '${i.name}' in style variables`);s[Ke(i.name)]=function(){let t=e.variables[i.name];return"string"==typeof t&&(t=Me(r,t)),void 0!==t?t:-9999999}}const a=Object.keys(s).map((function(e){return`uniform float ${e};`})),l=Math.ceil(t/4);a.push(`uniform sampler2D ${me}[${l}];`),r.paletteTextures&&a.push(`uniform sampler2D ${qe}[${r.paletteTextures.length}];`);const h=Object.keys(r.functions).map((function(e){return r.functions[e]}));return{vertexShader:i,fragmentShader:`\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    #else\n    precision mediump float;\n    #endif\n\n    varying vec2 v_textureCoord;\n    varying vec2 v_mapCoord;\n    uniform vec4 ${fe};\n    uniform float ${de};\n    uniform float ${Te};\n    uniform float ${Ee};\n    uniform float ${pe};\n    uniform float ${_e};\n\n    ${a.join("\n")}\n\n    ${h.join("\n")}\n\n    void main() {\n      if (\n        v_mapCoord[0] < ${fe}[0] ||\n        v_mapCoord[1] < ${fe}[1] ||\n        v_mapCoord[0] > ${fe}[2] ||\n        v_mapCoord[1] > ${fe}[3]\n      ) {\n        discard;\n      }\n\n      vec4 color = texture2D(${me}[0],  v_textureCoord);\n\n      ${n.join("\n")}\n\n      if (color.a == 0.0) {\n        discard;\n      }\n\n      gl_FragColor = color;\n      gl_FragColor.rgb *= gl_FragColor.a;\n      gl_FragColor *= ${de};\n    }`,uniforms:s,paletteTextures:r.paletteTextures}}Ae.band={getReturnType:function(){return Pe.NUMBER},toGlsl:function(e,t){Be(t,1),$e(t,3);const i=t[0];if(!(Ye in e.functions)){let t="";const i=e.bandCount||1;for(let e=0;e<i;e++){const r=Math.floor(e/4);let n=e%4;e===i-1&&1===n&&(n=3),t+=`\n          if (band == ${e+1}.0) {\n            return texture2D(${me}[${r}], v_textureCoord + vec2(dx, dy))[${n}];\n          }\n        `}e.functions[Ye]=`\n        float getBandValue(float band, float xOffset, float yOffset) {\n          float dx = xOffset / ${Te};\n          float dy = yOffset / ${Ee};\n          ${t}\n        }\n      `}const r=Ue(e,i),n=Ue(e,t[1]||0),s=Ue(e,t[2]||0);return`${Ye}(${r}, ${n}, ${s})`}},Ae.time={getReturnType:function(){return Pe.NUMBER},toGlsl:function(e,t){return je(t,0),"u_time"}},Ae.zoom={getReturnType:function(){return Pe.NUMBER},toGlsl:function(e,t){return je(t,0),"u_zoom"}},Ae.resolution={getReturnType:function(){return Pe.NUMBER},toGlsl:function(e,t){return je(t,0),"u_resolution"}},Ae["*"]={getReturnType:function(e){let t=Pe.NUMBER|Pe.COLOR;for(let i=0;i<e.length;i++)t&=Le(e[i]);return t},toGlsl:function(e,t,i){Be(t,2);let r=i;for(let e=0;e<t.length;e++)r&=Le(t[e]);return Xe(t,r,Pe.NUMBER|Pe.COLOR,"output"),`(${t.map((t=>Ue(e,t,r))).join(" * ")})`}},Ae["/"]={getReturnType:function(){return Pe.NUMBER},toGlsl:function(e,t){return je(t,2),Ne(t),`(${Ue(e,t[0])} / ${Ue(e,t[1])})`}},Ae["+"]={getReturnType:function(){return Pe.NUMBER},toGlsl:function(e,t){return Be(t,2),Ne(t),`(${t.map((t=>Ue(e,t))).join(" + ")})`}},Ae["-"]={getReturnType:function(){return Pe.NUMBER},toGlsl:function(e,t){return je(t,2),Ne(t),`(${Ue(e,t[0])} - ${Ue(e,t[1])})`}},Ae.clamp={getReturnType:function(){return Pe.NUMBER},toGlsl:function(e,t){je(t,3),Ne(t);const i=Ue(e,t[1]),r=Ue(e,t[2]);return`clamp(${Ue(e,t[0])}, ${i}, ${r})`}},Ae["%"]={getReturnType:function(){return Pe.NUMBER},toGlsl:function(e,t){return je(t,2),Ne(t),`mod(${Ue(e,t[0])}, ${Ue(e,t[1])})`}},Ae["^"]={getReturnType:function(){return Pe.NUMBER},toGlsl:function(e,t){return je(t,2),Ne(t),`pow(${Ue(e,t[0])}, ${Ue(e,t[1])})`}},Ae.abs={getReturnType:function(){return Pe.NUMBER},toGlsl:function(e,t){return je(t,1),Ne(t),`abs(${Ue(e,t[0])})`}},Ae.floor={getReturnType:function(){return Pe.NUMBER},toGlsl:function(e,t){return je(t,1),Ne(t),`floor(${Ue(e,t[0])})`}},Ae.round={getReturnType:function(){return Pe.NUMBER},toGlsl:function(e,t){return je(t,1),Ne(t),`floor(${Ue(e,t[0])} + 0.5)`}},Ae.ceil={getReturnType:function(){return Pe.NUMBER},toGlsl:function(e,t){return je(t,1),Ne(t),`ceil(${Ue(e,t[0])})`}},Ae.sin={getReturnType:function(){return Pe.NUMBER},toGlsl:function(e,t){return je(t,1),Ne(t),`sin(${Ue(e,t[0])})`}},Ae.cos={getReturnType:function(){return Pe.NUMBER},toGlsl:function(e,t){return je(t,1),Ne(t),`cos(${Ue(e,t[0])})`}},Ae.atan={getReturnType:function(){return Pe.NUMBER},toGlsl:function(e,t){return Be(t,1),$e(t,2),Ne(t),2===t.length?`atan(${Ue(e,t[0])}, ${Ue(e,t[1])})`:`atan(${Ue(e,t[0])})`}},Ae[">"]={getReturnType:function(){return Pe.BOOLEAN},toGlsl:function(e,t){return je(t,2),Ne(t),`(${Ue(e,t[0])} > ${Ue(e,t[1])})`}},Ae[">="]={getReturnType:function(){return Pe.BOOLEAN},toGlsl:function(e,t){return je(t,2),Ne(t),`(${Ue(e,t[0])} >= ${Ue(e,t[1])})`}},Ae["<"]={getReturnType:function(){return Pe.BOOLEAN},toGlsl:function(e,t){return je(t,2),Ne(t),`(${Ue(e,t[0])} < ${Ue(e,t[1])})`}},Ae["<="]={getReturnType:function(){return Pe.BOOLEAN},toGlsl:function(e,t){return je(t,2),Ne(t),`(${Ue(e,t[0])} <= ${Ue(e,t[1])})`}},Ae["=="]=We("=="),Ae["!="]=We("!="),Ae["!"]={getReturnType:function(){return Pe.BOOLEAN},toGlsl:function(e,t){return je(t,1),Ze(t[0]),`(!${Ue(e,t[0],Pe.BOOLEAN)})`}},Ae.all=He("&&"),Ae.any=He("||"),Ae.between={getReturnType:function(){return Pe.BOOLEAN},toGlsl:function(e,t){je(t,3),Ne(t);const i=Ue(e,t[1]),r=Ue(e,t[2]),n=Ue(e,t[0]);return`(${n} >= ${i} && ${n} <= ${r})`}},Ae.array={getReturnType:function(){return Pe.NUMBER_ARRAY},toGlsl:function(e,t){Be(t,2),$e(t,4),Ne(t);const i=t.map((function(t){return Ue(e,t)}));return`vec${t.length}(${i.join(", ")})`}},Ae.color={getReturnType:function(){return Pe.COLOR},toGlsl:function(e,t){Be(t,3),$e(t,4),Ne(t);const i=t.slice(0,3).map((t=>`${Ue(e,t)} / 255.0`));return 3===t.length?`vec4(${i.join(", ")}, 1.0)`:`(${Ue(e,t[3])} * vec4(${i.join(", ")}, 1.0))`}},Ae.interpolate={getReturnType:function(e){let t=Pe.COLOR|Pe.NUMBER;for(let i=3;i<e.length;i+=2)t&=Le(e[i]);return t},toGlsl:function(e,t,i){ze(t),Be(t,6);const r=t[0];let n;switch(r[0]){case"linear":n=1;break;case"exponential":n=r[1];break;default:n=null}if(!n)throw new Error(`Invalid interpolation type for "interpolate" operator, received: ${JSON.stringify(r)}`);const s=Pe.NUMBER,o=Ae.interpolate.getReturnType(t)&i;ke(["interpolate",...t],o,"output");const a=Ue(e,t[1],s),l=Oe(n);let h="";for(let i=2;i<t.length-2;i+=2){const r=Ue(e,t[i],s),n=h||Ue(e,t[i+1],o),u=Ue(e,t[i+2],s);h=`mix(${n}, ${Ue(e,t[i+3],o)}, pow(clamp((${a} - ${r}) / (${u} - ${r}), 0.0, 1.0), ${l}))`}return h}},Ae.match={getReturnType:function(e){let t=Pe.ANY;for(let i=2;i<e.length;i+=2)t&=Le(e[i]);return t&=Le(e[e.length-1]),t},toGlsl:function(e,t,i){ze(t),Be(t,4);let r=Le(t[0]);for(let e=1;e<t.length-1;e+=2)r&=Le(t[e]);Xe(["match",...t],r,Pe.STRING|Pe.NUMBER|Pe.BOOLEAN,"input"),r=(Pe.STRING|Pe.NUMBER|Pe.BOOLEAN)&r;const n=Ae.match.getReturnType(t)&i;ke(["match",...t],n,"output");const s=Ue(e,t[0],r),o=Ue(e,t[t.length-1],n);let a=null;for(let i=t.length-3;i>=1;i-=2)a=`(${s} == ${Ue(e,t[i],r)} ? ${Ue(e,t[i+1],n)} : ${a||o})`;return a}},Ae.case={getReturnType:function(e){let t=Pe.ANY;for(let i=1;i<e.length;i+=2)t&=Le(e[i]);return t&=Le(e[e.length-1]),t},toGlsl:function(e,t,i){!function(e){if(e.length%2==0)throw new Error(`An odd amount of arguments was expected, got ${JSON.stringify(e)} instead`)}(t),Be(t,3);const r=Ae.case.getReturnType(t)&i;ke(["case",...t],r,"output");for(let e=0;e<t.length-1;e+=2)Ze(t[e]);const n=Ue(e,t[t.length-1],r);let s=null;for(let i=t.length-3;i>=0;i-=2)s=`(${Ue(e,t[i],Pe.BOOLEAN)} ? ${Ue(e,t[i+1],r)} : ${s||n})`;return s}};class Qe extends r.Z{constructor(e){const t=(e=e?Object.assign({},e):{}).style||{};delete e.style;const i=e.cacheSize;delete e.cacheSize,super(e),this.sources_=e.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=t,this.cacheSize_=i,this.styleVariables_=this.style_.variables||{},this.addChangeListener(n.Z.SOURCE,this.handleSourceUpdate_)}getSources(e,t){const i=this.getSource();return this.sources_?"function"==typeof this.sources_?this.sources_(e,t):this.sources_:i?[i]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const e=this.getRenderSource();return e?e.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache(),this.getSource()&&this.setStyle(this.style_)}getSourceBandCount_(){const e=Number.MAX_SAFE_INTEGER,t=this.getSources([-e,-e,e,e],e);return t&&t.length&&"bandCount"in t[0]?t[0].bandCount:4}createRenderer(){const e=Je(this.style_,this.getSourceBandCount_());return new we(this,{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,cacheSize:this.cacheSize_,paletteTextures:e.paletteTextures})}renderSources(e,t){const i=this.getRenderer();let r;for(let n=0,s=t.length;n<s;++n)this.renderedSource_=t[n],i.prepareFrame(e)&&(r=i.renderFrame(e));return r}render(e,t){this.rendered=!0;const i=e.viewState,r=this.getSources(e.extent,i.resolution);let n=!0;for(let e=0,t=r.length;e<t;++e){const t=r[e],i=t.getState();if("loading"==i){const e=()=>{"ready"==t.getState()&&(t.removeEventListener("change",e),this.changed())};t.addEventListener("change",e)}n=n&&"ready"==i}const s=this.renderSources(e,r);if(this.getRenderer().renderComplete&&n)return this.renderedResolution_=i.resolution,s;if(this.renderedResolution_>.5*i.resolution){const t=this.getSources(e.extent,this.renderedResolution_).filter((e=>!r.includes(e)));if(t.length>0)return this.renderSources(e,t)}return s}setStyle(e){this.styleVariables_=e.variables||{},this.style_=e;const t=Je(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms}),this.changed()}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}Qe.prototype.dispose;const et=Qe},435415:(e,t,i)=>{"use strict";i.d(t,{Pt:()=>l,u3:()=>h});var r=i(576798),n=i(591358),s=i(782359),o=i(243631),a=i(218672);function l(e,t){const i=e.canvas,o=(t=t||{}).pixelRatio||n.MP,a=t.size;a&&(i.width=a[0]*o,i.height=a[1]*o,i.style.width=a[0]+"px",i.style.height=a[1]+"px");const l=[0,0,i.width,i.height],h=(0,s.bA)((0,s.Ue)(),o,o);return new r.Z(e,o,l,h,0)}function h(e){if(!(e.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");const t=e.inversePixelTransform[0],i=e.inversePixelTransform[1],n=Math.sqrt(t*t+i*i),l=e.frameState,h=(0,s.Jp)(e.inversePixelTransform.slice(),l.coordinateToPixelTransform),u=(0,o.se)(l.viewState.resolution,n);let c;const d=(0,a.Cs)();return d&&(c=(0,a.WO)(d,l.viewState.projection)),new r.Z(e.context,n,l.extent,h,l.viewState.rotation,u,c)}},115712:(e,t,i)=>{"use strict";i.d(t,{Z:()=>f});var r=i(435211),n=i(553980),s=i(173381),o=i(859900),a=i(856245),l=i(152209),h=i(921882),u=i(85386),c=i(421915),d=i(613002);class g extends n.ZP{constructor(e){super({tileCoord:e.tileCoord,loader:()=>Promise.resolve(new Uint8Array(4)),interpolate:e.interpolate,transition:e.transition}),this.pixelRatio_=e.pixelRatio,this.gutter_=e.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=e.sourceTileGrid,this.targetTileGrid_=e.targetTileGrid,this.wrappedTileCoord_=e.wrappedTileCoord||e.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const t=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),i=this.targetTileGrid_.getExtent();let n=this.sourceTileGrid_.getExtent();const s=i?(0,c.Ed)(t,i):t;if(0===(0,c.bg)(s))return void(this.state=o.Z.EMPTY);const u=e.sourceProj,d=u.getExtent();d&&(n=n?(0,c.Ed)(n,d):d);const g=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),f=e.targetProj,p=(0,l.Co)(u,f,s,g);if(!isFinite(p)||p<=0)return void(this.state=o.Z.EMPTY);const _=void 0!==e.errorThreshold?e.errorThreshold:r.m;if(this.triangulation_=new a.Z(u,f,s,n,p*_,g),0===this.triangulation_.getTriangles().length)return void(this.state=o.Z.EMPTY);this.sourceZ_=this.sourceTileGrid_.getZForResolution(p);let m=this.triangulation_.calculateSourceExtent();if(n&&(u.canWrapX()?(m[1]=(0,h.uZ)(m[1],n[1],n[3]),m[3]=(0,h.uZ)(m[3],n[1],n[3])):m=(0,c.Ed)(m,n)),(0,c.bg)(m)){const t=this.sourceTileGrid_.getTileRangeForExtentAndZ(m,this.sourceZ_),i=e.getTileFunction;for(let e=t.minX;e<=t.maxX;e++)for(let r=t.minY;r<=t.maxY;r++){const t=i(this.sourceZ_,e,r,this.pixelRatio_);t&&this.sourceTiles_.push(t)}0===this.sourceTiles_.length&&(this.state=o.Z.EMPTY)}else this.state=o.Z.EMPTY}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const e=[];if(this.sourceTiles_.forEach((t=>{if(!t||t.getState()!==o.Z.LOADED)return;const i=t.getSize(),r=this.gutter_;let s;s=(0,n.px)(t.getData())||(0,n.qo)((0,n.G0)(t.getData()));const a=[i[0]+2*r,i[1]+2*r],l=s instanceof Float32Array,h=a[0]*a[1],u=l?Float32Array:Uint8Array,c=new u(s.buffer),d=u.BYTES_PER_ELEMENT,g=d*c.length/h,f=c.byteLength/a[1],p=Math.floor(f/d/a[0]),_=h*p;let m=c;if(c.length!==_){m=new u(_);let e=0,t=0;const i=a[0]*p;for(let r=0;r<a[1];++r){for(let r=0;r<i;++r)m[e++]=c[t+r];t+=f/d}}e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),data:new Uint8Array(m.buffer),dataType:u,bytesPerPixel:g,pixelSize:a})})),this.sourceTiles_.length=0,0===e.length)this.state=o.Z.ERROR;else{const t=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(t),r="number"==typeof i?i:i[0],n="number"==typeof i?i:i[1],s=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),h=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);let c,d;const g=e[0].bytesPerPixel;for(let t=Math.ceil(g/3)-1;t>=0;--t){const i=[];for(let r=0,n=e.length;r<n;++r){const n=e[r],s=n.data,o=n.pixelSize,a=o[0],h=o[1],c=(0,u.E4)(a,h,l.rX),d=c.createImageData(a,h),f=d.data;let p=3*t;for(let e=0,t=f.length;e<t;e+=4)f[e]=s[p],f[e+1]=s[p+1],f[e+2]=s[p+2],f[e+3]=255,p+=g;c.putImageData(d,0,0),i.push({extent:n.extent,image:c.canvas})}const o=(0,l.sY)(r,n,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),s,h,this.triangulation_,i,this.gutter_,!1,!1);for(let e=0,t=i.length;e<t;++e){const t=i[e].image.getContext("2d");(0,u.jy)(t),l.rX.push(t.canvas)}const f=o.getContext("2d"),p=f.getImageData(0,0,o.width,o.height);(0,u.jy)(f),l.rX.push(o),c||(d=new Uint8Array(g*p.width*p.height),c=new e[0].dataType(d.buffer));const _=p.data;let m=3*t;for(let e=0,t=_.length;e<t;e+=4)255===_[e+3]?(d[m]=_[e],d[m+1]=_[e+1],d[m+2]=_[e+2]):(d[m]=0,d[m+1]=0,d[m+2]=0),m+=g}this.reprojData_=c,this.reprojSize_=[Math.round(r*this.pixelRatio_),Math.round(n*this.pixelRatio_)],this.state=o.Z.LOADED}this.changed()}load(){if(this.state!==o.Z.IDLE&&this.state!==o.Z.ERROR)return;this.state=o.Z.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach((t=>{const i=t.getState();if(i!==o.Z.IDLE&&i!==o.Z.LOADING)return;e++;const r=(0,d.oL)(t,s.Z.CHANGE,(function(){const i=t.getState();i!=o.Z.LOADED&&i!=o.Z.ERROR&&i!=o.Z.EMPTY||((0,d.bN)(r),e--,0===e&&(this.unlistenSources_(),this.reproject_()))}),this);this.sourcesListenerKeys_.push(r)})),0===e?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach((function(e){e.getState()==o.Z.IDLE&&e.load()}))}unlistenSources_(){this.sourcesListenerKeys_.forEach(d.bN),this.sourcesListenerKeys_=null}}const f=g},683622:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var r=i(365952),n=i(421915),s=i(989434),o=i(570701),a=i(386018),l=i(218672);class h extends r.Z{constructor(e){const t=void 0!==e.hidpi&&e.hidpi;super({cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,opaque:!0,projection:(0,l.U2)("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,tilePixelRatio:t?2:1,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition,zDirection:e.zDirection}),this.hidpi_=t,this.culture_=void 0!==e.culture?e.culture:"en-us",this.maxZoom_=void 0!==e.maxZoom?e.maxZoom:-1,this.apiKey_=e.key,this.imagerySet_=e.imagerySet;const i="https://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.imagerySet_+"?uriScheme=https&include=ImageryProviders&key="+this.apiKey_+"&c="+this.culture_;fetch(i).then((e=>e.json())).then((e=>this.handleImageryMetadataResponse(e)))}getApiKey(){return this.apiKey_}getImagerySet(){return this.imagerySet_}handleImageryMetadataResponse(e){if(200!=e.statusCode||"OK"!=e.statusDescription||"ValidCredentials"!=e.authenticationResultCode||1!=e.resourceSets.length||1!=e.resourceSets[0].resources.length)return void this.setState("error");const t=e.resourceSets[0].resources[0],i=-1==this.maxZoom_?t.zoomMax:this.maxZoom_,r=this.getProjection(),h=(0,a.Tl)(r),u=this.hidpi_?2:1,c=t.imageWidth==t.imageHeight?t.imageWidth/u:[t.imageWidth/u,t.imageHeight/u],d=(0,a.dl)({extent:h,minZoom:t.zoomMin,maxZoom:i,tileSize:c});this.tileGrid=d;const g=this.culture_,f=this.hidpi_;if(this.tileUrlFunction=(0,s.Un)(t.imageUrlSubdomains.map((function(e){const i=[0,0,0],r=t.imageUrl.replace("{subdomain}",e).replace("{culture}",g);return function(e,t,n){if(!e)return;(0,o.T9)(e[0],e[1],e[2],i);let s=r;return f&&(s+="&dpi=d1&device=mobile"),s.replace("{quadkey}",function(e){const t=e[0],i=new Array(t);let r,n,s=1<<t-1;for(r=0;r<t;++r)n=48,e[1]&s&&(n+=1),e[2]&s&&(n+=2),i[r]=String.fromCharCode(n),s>>=1;return i.join("")}(i))}}))),t.imageryProviders){const e=(0,l.WO)((0,l.U2)("EPSG:4326"),this.getProjection());this.setAttributions((i=>{const r=[],s=i.viewState,o=this.getTileGrid(),a=o.getZForResolution(s.resolution,this.zDirection),l=o.getTileCoordForCoordAndZ(s.center,a)[0];return t.imageryProviders.map((function(t){let s=!1;const o=t.coverageAreas;for(let t=0,r=o.length;t<r;++t){const r=o[t];if(l>=r.zoomMin&&l<=r.zoomMax){const t=r.bbox,o=[t[1],t[0],t[3],t[2]],a=(0,n.Ne)(o,e);if((0,n.kK)(a,i.extent)){s=!0;break}}}s&&r.push(t.attribution)})),r.push('<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html" target="_blank">Terms of Use</a>'),r}))}this.setState("ready")}}const u=h},307454:(e,t,i)=>{"use strict";i.d(t,{Z:()=>$});var r=i(553980),n=i(173381),s=i(115712),o=i(593888),a=i(184548),l=i(51626),h=i(859900),u=i(386018),c=i(218672),d=i(570701),g=i(949179),f=i(864011),p=i(450596);class _ extends l.Z{constructor(e){const t=void 0===e.projection?"EPSG:3857":e.projection;let i=e.tileGrid;void 0===i&&t&&(i=(0,u.dl)({extent:(0,u.Tl)(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize})),super({cacheSize:.1,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:t,tileGrid:i,opaque:e.opaque,state:e.state,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate}),this.gutter_=void 0!==e.gutter?e.gutter:0,this.tileSize_=e.tileSize?(0,p.Pq)(e.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=e.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=void 0===e.bandCount?4:e.bandCount,this.tileGridForProjection_={},this.tileCacheForProjection_={}}setTileSizes(e){this.tileSizes_=e}getTileSize(e){if(this.tileSizes_)return this.tileSizes_[e];if(this.tileSize_)return this.tileSize_;const t=this.getTileGrid();return t?(0,p.Pq)(t.getTileSize(e)):[256,256]}getGutterForProjection(e){const t=this.getProjection();return!t||(0,c.OP)(t,e)?this.gutter_:0}setLoader(e){this.loader_=e}getReprojTile_(e,t,i,r,n){const o=this.getTileCacheForProjection(r),a=(0,d.lg)(e,t,i);if(o.containsKey(a)){const e=o.get(a);if(e&&e.key==this.getKey())return e}const l=this.getTileGrid(),h=Math.max.apply(null,l.getResolutions().map(((e,t)=>{const i=(0,p.Pq)(l.getTileSize(t)),r=this.getTileSize(t);return Math.max(r[0]/i[0],r[1]/i[1])}))),u=this.getTileGridForProjection(n),c=this.getTileGridForProjection(r),g=[e,t,i],f=this.getTileCoordForTileUrlFunction(g,r),_=Object.assign({sourceProj:n,sourceTileGrid:u,targetProj:r,targetTileGrid:c,tileCoord:g,wrappedTileCoord:f,pixelRatio:h,gutter:this.getGutterForProjection(n),getTileFunction:(e,t,i,r)=>this.getTile(e,t,i,r,n)},this.tileOptions),m=new s.Z(_);return m.key=this.getKey(),m}getTile(e,t,i,s,o){const a=this.getProjection();if(a&&o&&!(0,c.OP)(a,o))return this.getReprojTile_(e,t,i,o,a);const l=this.getTileSize(e),h=(0,d.lg)(e,t,i);if(this.tileCache.containsKey(h))return this.tileCache.get(h);const u=this.loader_,g=Object.assign({tileCoord:[e,t,i],loader:function(){return(0,f.Vi)((function(){return u(e,t,i)}))},size:l},this.tileOptions),p=new r.ZP(g);return p.key=this.getKey(),p.addEventListener(n.Z.CHANGE,this.handleTileChange_),this.tileCache.set(h,p),p}handleTileChange_(e){const t=e.target,i=(0,g.sq)(t),r=t.getState();let n;r==h.Z.LOADING?(this.tileLoadingKeys_[i]=!0,n=a.Z.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],n=r==h.Z.ERROR?a.Z.TILELOADERROR:r==h.Z.LOADED?a.Z.TILELOADEND:void 0),n&&this.dispatchEvent(new l.s(n,t))}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||(0,c.OP)(t,e)))return this.tileGrid;const i=(0,g.sq)(e);return i in this.tileGridForProjection_||(this.tileGridForProjection_[i]=(0,u.X$)(e)),this.tileGridForProjection_[i]}setTileGridForProjection(e,t){const i=(0,c.U2)(e);if(i){const e=(0,g.sq)(i);e in this.tileGridForProjection_||(this.tileGridForProjection_[e]=t)}}getTileCacheForProjection(e){const t=this.getProjection();if(!t||(0,c.OP)(t,e))return this.tileCache;const i=(0,g.sq)(e);return i in this.tileCacheForProjection_||(this.tileCacheForProjection_[i]=new o.Z(.1)),this.tileCacheForProjection_[i]}expireCache(e,t){const i=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==i?t:{});for(const e in this.tileCacheForProjection_){const r=this.tileCacheForProjection_[e];r.expireCache(r==i?t:{})}}clear(){super.clear();for(const e in this.tileCacheForProjection_)this.tileCacheForProjection_[e].clear()}}const m=_;var T=i(408930),E=i(563883);const R="undefined"!=typeof navigator&&navigator.hardwareConcurrency||2,y=class{constructor(e=R,t){this.workers=null,this._awaitingDecoder=null,this.size=e,this.messageId=0,e&&(this._awaitingDecoder=t?Promise.resolve(t):new Promise((e=>{i.e(95587).then(i.bind(i,995587)).then((t=>{e(t.create)}))})),this._awaitingDecoder.then((t=>{this._awaitingDecoder=null,this.workers=[];for(let i=0;i<e;i++)this.workers.push({worker:t(),idle:!0})})))}async decode(e,t){return this._awaitingDecoder&&await this._awaitingDecoder,0===this.size?(0,E.X)(e).then((i=>i.decode(e,t))):new Promise((i=>{const r=this.workers.find((e=>e.idle))||this.workers[Math.floor(Math.random()*this.size)];r.idle=!1;const n=this.messageId++,s=e=>{e.data.id===n&&(r.idle=!0,i(e.data.decoded),r.worker.removeEventListener("message",s))};r.worker.addEventListener("message",s),r.worker.postMessage({fileDirectory:e,buffer:t,id:n},[t])}))}destroy(){this.workers&&(this.workers.forEach((e=>{e.worker.terminate()})),this.workers=null)}};var v=i(274698),x=i(791530),S=i(921882),w=i(421915),b=i(995607),C=i(440868);function P(e,t){if(!e)return!1;if(!0===e)return!0;if(3!==t.getSamplesPerPixel())return!1;const i=t.fileDirectory.PhotometricInterpretation,r=x.Ie;return i===r.CMYK||i===r.YCbCr||i===r.CIELab||i===r.ICCLab}const A="STATISTICS_MAXIMUM",L="STATISTICS_MINIMUM";let F;function O(){return F||(F=new y),F}function I(e){try{return e.getBoundingBox()}catch(t){return[0,0,e.getWidth(),e.getHeight()]}}function M(e){try{return e.getOrigin().slice(0,2)}catch(t){return[0,e.getHeight()]}}function U(e,t){try{return e.getResolution(t)}catch(i){return[t.getWidth()/e.getWidth(),t.getHeight()/e.getHeight()]}}function G(e){const t=e.geoKeys;if(!t)return null;if(t.ProjectedCSTypeGeoKey&&32767!==t.ProjectedCSTypeGeoKey){const e="EPSG:"+t.ProjectedCSTypeGeoKey;let i=(0,c.U2)(e);if(!i){const r=(0,C.N)(t.ProjLinearUnitsGeoKey);r&&(i=new c.kv({code:e,units:r}))}return i}if(t.GeographicTypeGeoKey&&32767!==t.GeographicTypeGeoKey){const e="EPSG:"+t.GeographicTypeGeoKey;let i=(0,c.U2)(e);if(!i){const r=(0,C.N)(t.GeogAngularUnitsGeoKey);r&&(i=new c.kv({code:e,units:r}))}return i}return null}function N(e){return e.getImageCount().then((function(t){const i=new Array(t);for(let r=0;r<t;++r)i[r]=e.getImage(r);return Promise.all(i)}))}function D(e,t){let i;return i=e.blob?(0,v.mK)(e.blob):e.overviews?(0,v.MS)(e.url,e.overviews,t):(0,v.W0)(e.url,t),i.then(N)}function Z(e,t,i,r,n){if(Array.isArray(e)){const s=e.length;if(!Array.isArray(t)||s!=t.length){const e=new Error(r);throw n(e),e}for(let o=0;o<s;++o)Z(e[o],t[o],i,r,n)}else if(Math.abs(e-t)>i*e)throw new Error(r)}function j(e){return e instanceof Int8Array?127:e instanceof Uint8Array||e instanceof Uint8ClampedArray?255:e instanceof Int16Array?32767:e instanceof Uint16Array?65535:e instanceof Int32Array?2147483647:e instanceof Uint32Array?4294967295:e instanceof Float32Array?34e37:255}class B extends m{constructor(e){super({state:"loading",tileGrid:null,projection:null,opaque:e.opaque,transition:e.transition,interpolate:!1!==e.interpolate,wrapX:e.wrapX}),this.sourceInfo_=e.sources;const t=this.sourceInfo_.length;this.sourceOptions_=e.sourceOptions,this.sourceImagery_=new Array(t),this.sourceMasks_=new Array(t),this.resolutionFactors_=new Array(t),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=!1!==e.normalize,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=e.convertToRGB||!1,this.setKey(this.sourceInfo_.map((e=>e.url)).join(","));const i=this,r=new Array(t);for(let e=0;e<t;++e)r[e]=D(this.sourceInfo_[e],this.sourceOptions_);Promise.all(r).then((function(e){i.configure_(e)})).catch((function(e){(0,b.vU)(e),i.error_=e,i.setState("error")}))}getError(){return this.error_}determineProjection(e){const t=e[0];for(let e=t.length-1;e>=0;--e){const i=G(t[e]);if(i){this.projection=i;break}}}configure_(e){let t,i,r,n,s;const o=new Array(e.length),a=new Array(e.length),l=new Array(e.length);let h=0;const u=e.length;for(let c=0;c<u;++c){const u=[],d=[];e[c].forEach((e=>{4&~(e.fileDirectory.NewSubfileType||0)?u.push(e):d.push(e)}));const g=u.length;if(d.length>0&&d.length!==g)throw new Error(`Expected one mask per image found ${d.length} masks and ${g} images`);let f,p;const _=new Array(g),m=new Array(g),T=new Array(g);a[c]=new Array(g),l[c]=new Array(g);for(let e=0;e<g;++e){const t=u[e],i=t.getGDALNoData();l[c][e]=t.getGDALMetadata(0),a[c][e]=i;const r=this.sourceInfo_[c].bands;o[c]=r?r.length:t.getSamplesPerPixel();const n=g-(e+1);f||(f=I(t)),p||(p=M(t));const s=U(t,u[0]);T[n]=s[0];const h=[t.getTileWidth(),t.getTileHeight()];h[0]!==h[1]&&h[1]<256&&(h[0]=256,h[1]=256),_[n]=h;const d=s[0]/Math.abs(s[1]);m[n]=[h[0],h[1]/d]}if(t?(0,w.Ed)(t,f,t):t=f,i?Z(i,p,0,`Origin mismatch for source ${c}, got [${p}] but expected [${i}]`,this.viewRejector):i=p,s){s.length-h>T.length&&(h=s.length-T.length);const e=s[s.length-1]/T[T.length-1];this.resolutionFactors_[c]=e;const t=T.map((t=>t*e)),i=`Resolution mismatch for source ${c}, got [${t}] but expected [${s}]`;Z(s.slice(h,s.length),t,.02,i,this.viewRejector)}else s=T,this.resolutionFactors_[c]=1;r?Z(r.slice(h,r.length),m,.01,`Tile size mismatch for source ${c}`,this.viewRejector):r=m,n?Z(n.slice(h,n.length),_,0,`Tile size mismatch for source ${c}`,this.viewRejector):n=_,this.sourceImagery_[c]=u.reverse(),this.sourceMasks_[c]=d.reverse()}for(let e=0,t=this.sourceImagery_.length;e<t;++e){const t=this.sourceImagery_[e];for(;t.length<s.length;)t.unshift(void 0)}this.getProjection()||this.determineProjection(e),this.samplesPerPixel_=o,this.nodataValues_=a,this.metadata_=l;e:for(let e=0;e<u;++e){if(void 0!==this.sourceInfo_[e].nodata){this.addAlpha_=!0;break}if(this.sourceMasks_[e].length){this.addAlpha_=!0;break}const t=a[e],i=this.sourceInfo_[e].bands;if(i){for(let e=0;e<i.length;++e)if(null!==t[i[e]-1]){this.addAlpha_=!0;break e}}else for(let e=0;e<t.length;++e)if(null!==t[e]){this.addAlpha_=!0;break e}}let d=this.addAlpha_?1:0;for(let e=0;e<u;++e)d+=o[e];this.bandCount=d;const g=new T.Z({extent:t,minZoom:h,origin:i,resolutions:s,tileSizes:r});this.tileGrid=g,this.setTileSizes(n),this.setLoader(this.loadTile_.bind(this)),this.setState("ready"),2===s.length?s=[s[0],s[1],s[1]/2]:1===s.length&&(s=[2*s[0],s[0],s[0]/2]),this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:s,center:(0,c.lO)((0,w.qg)(t),this.projection),extent:(0,c.Fj)(t,this.projection),zoom:1})}loadTile_(e,t,i){const r=this.getTileSize(e),n=this.sourceImagery_.length,s=new Array(2*n),o=this.nodataValues_,a=this.sourceInfo_,l=O();for(let h=0;h<n;++h){const u=a[h],c=this.resolutionFactors_[h],d=[Math.round(t*(r[0]*c)),Math.round(i*(r[1]*c)),Math.round((t+1)*(r[0]*c)),Math.round((i+1)*(r[1]*c))],g=this.sourceImagery_[h][e];let f,p;u.bands&&(f=u.bands.map((function(e){return e-1}))),p="nodata"in u&&null!==u.nodata?u.nodata:f?f.map((function(e){return o[h][e]})):o[h];const _={window:d,width:r[0],height:r[1],samples:f,fillValue:p,pool:l,interleave:!1};P(this.convertToRGB_,g)?s[h]=g.readRGB(_):s[h]=g.readRasters(_);const m=n+h,T=this.sourceMasks_[h][e];s[m]=T?T.readRasters({window:d,width:r[0],height:r[1],samples:[0],pool:l,interleave:!1}):Promise.resolve(null)}return Promise.all(s).then(this.composeTile_.bind(this,r)).catch((function(e){throw(0,b.vU)(e),e}))}composeTile_(e,t){const i=this.metadata_,r=this.sourceInfo_,n=this.sourceImagery_.length,s=this.bandCount,o=this.samplesPerPixel_,a=this.nodataValues_,l=this.normalize_,h=this.addAlpha_,u=e[0]*e[1],c=u*s;let d;d=l?new Uint8Array(c):new Float32Array(c);let g=0;for(let e=0;e<u;++e){let s=h;for(let u=0;u<n;++u){const c=r[u];let p,_,m=c.min,T=c.max;if(l){const e=i[u][0];void 0===m&&(m=e&&L in e?parseFloat(e[L]):(f=t[u][0])instanceof Int8Array?-128:f instanceof Int16Array?-32768:f instanceof Int32Array?-2147483648:f instanceof Float32Array?12e-39:0),void 0===T&&(T=e&&A in e?parseFloat(e[A]):j(t[u][0])),p=255/(T-m),_=-m*p}for(let i=0;i<o[u];++i){const r=t[u][i][e];let n;if(n=l?(0,S.uZ)(p*r+_,0,255):r,h){let e=c.nodata;if(void 0===e){let t;t=c.bands?c.bands[i]-1:i,e=a[u][t]}const t=isNaN(e);(!t&&r!==e||t&&!isNaN(r))&&(s=!1,d[g]=n)}else d[g]=n;g++}if(!s){const i=t[n+u];i&&!i[0][e]&&(s=!0)}}h&&(s||(d[g]=255),g++)}var f;return d}}B.prototype.getView;const $=B},125869:(e,t,i)=>{"use strict";i.d(t,{Z:()=>L});var r=i(173381),n=i(9520),s=i(611256),o=i(435211),a=i(29217),l=i(856245),h=i(152209),u=i(421915),c=i(613002);class d extends a.Z{constructor(e,t,i,r,n,a,c){let d=e.getExtent();d&&e.canWrapX()&&(d=d.slice(),d[0]=-1/0,d[2]=1/0);let g=t.getExtent();g&&t.canWrapX()&&(g=g.slice(),g[0]=-1/0,g[2]=1/0);const f=g?(0,u.Ed)(i,g):i,p=(0,u.qg)(f),_=(0,h.aA)(e,t,p,r),m=o.m,T=new l.Z(e,t,f,d,_*m,r),E=T.calculateSourceExtent(),R=(0,u.xb)(E)?null:a(E,_,n),y=R?s.Z.IDLE:s.Z.EMPTY,v=R?R.getPixelRatio():1;super(i,r,v,y),this.targetProj_=t,this.maxSourceExtent_=d,this.triangulation_=T,this.targetResolution_=r,this.targetExtent_=i,this.sourceImage_=R,this.sourcePixelRatio_=v,this.interpolate_=c,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==s.Z.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(e==s.Z.LOADED){const e=(0,u.dz)(this.targetExtent_)/this.targetResolution_,t=(0,u.Cr)(this.targetExtent_)/this.targetResolution_;this.canvas_=(0,h.sY)(e,t,this.sourcePixelRatio_,this.sourceImage_.getResolution(),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_)}this.state=e,this.changed()}load(){if(this.state==s.Z.IDLE){this.state=s.Z.LOADING,this.changed();const e=this.sourceImage_.getState();e==s.Z.LOADED||e==s.Z.ERROR?this.reproject_():(this.sourceListenerKey_=(0,c.oL)(this.sourceImage_,r.Z.CHANGE,(function(e){const t=this.sourceImage_.getState();t!=s.Z.LOADED&&t!=s.Z.ERROR||(this.unlistenSource_(),this.reproject_())}),this),this.sourceImage_.load())}}unlistenSource_(){(0,c.bN)(this.sourceListenerKey_),this.sourceListenerKey_=null}}const g=d;var f=i(771405),p=i(949179),_=i(218672),m=i(179682);class T extends n.ZP{constructor(e,t){super(e),this.image=t}}class E extends f.Z{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:void 0===e.interpolate||e.interpolate}),this.on,this.once,this.un,this.resolutions_=void 0!==e.resolutions?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const t=this.getResolutions();return t&&(e=t[(0,m.h7)(t,e,0)]),e}getImage(e,t,i,r){const n=this.getProjection();if(!n||!r||(0,_.OP)(n,r))return n&&(r=n),this.getImageInternal(e,t,i,r);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&(0,_.OP)(this.reprojectedImage_.getProjection(),r)&&this.reprojectedImage_.getResolution()==t&&(0,u.fS)(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new g(n,r,e,t,i,((e,t,i)=>this.getImageInternal(e,t,i,n)),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,t,i,r){return(0,p.O3)()}handleImageChange(e){const t=e.target;let i;switch(t.getState()){case s.Z.LOADING:this.loading=!0,i="imageloadstart";break;case s.Z.LOADED:this.loading=!1,i="imageloadend";break;case s.Z.ERROR:this.loading=!1,i="imageloaderror";break;default:return}this.hasListener(i)&&this.dispatchEvent(new T(i,t))}}function R(e,t){e.getImage().src=t}const y=E;var v=i(102022),x=i(149081),S=i(578487),w=i(438906),b=i(921882),C=i(579313),P=i(85386);const A=[101,101],L=class extends y{constructor(e){super({attributions:(e=e||{}).attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.context_=(0,P.E4)(1,1),this.crossOrigin_=void 0!==e.crossOrigin?e.crossOrigin:null,this.url_=e.url,this.imageLoadFunction_=void 0!==e.imageLoadFunction?e.imageLoadFunction:R,this.params_=Object.assign({},e.params),this.v13_=!0,this.updateV13_(),this.serverType_=e.serverType,this.hidpi_=void 0===e.hidpi||e.hidpi,this.image_=null,this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=void 0!==e.ratio?e.ratio:1.5}getFeatureInfoUrl(e,t,i,r){if(void 0===this.url_)return;const n=(0,_.U2)(i),s=this.getProjection();s&&s!==n&&(t=(0,h.aA)(s,n,e,t),e=(0,_.vs)(e,n,s));const o=(0,u.p8)(e,t,0,A),a={SERVICE:"WMS",VERSION:x.e,REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};Object.assign(a,this.params_,r);const l=(0,b.GW)((e[0]-o[0])/t,4),c=(0,b.GW)((o[3]-e[1])/t,4);return a[this.v13_?"I":"X"]=l,a[this.v13_?"J":"Y"]=c,this.getRequestUrl_(o,A,1,s||n,a)}getLegendUrl(e,t){if(void 0===this.url_)return;const i={SERVICE:"WMS",VERSION:x.e,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(void 0===t||void 0===t.LAYER){const e=this.params_.LAYERS;if(Array.isArray(e)&&1!==e.length)return;i.LAYER=e}if(void 0!==e){const t=this.getProjection()?this.getProjection().getMetersPerUnit():1,r=28e-5;i.SCALE=e*t/r}return Object.assign(i,t),(0,S.B)(this.url_,i)}getParams(){return this.params_}getImageInternal(e,t,i,n){if(void 0===this.url_)return null;t=this.findNearestResolution(t),1==i||this.hidpi_&&void 0!==this.serverType_||(i=1);const s=t/i,o=(0,u.qg)(e),a=(0,b.mD)((0,u.dz)(e)/s,4),l=(0,b.mD)((0,u.Cr)(e)/s,4),h=(0,u.p8)(o,s,0,[a,l]),c=(0,b.mD)(this.ratio_*(0,u.dz)(e)/s,4),d=(0,b.mD)(this.ratio_*(0,u.Cr)(e)/s,4),g=(0,u.p8)(o,s,0,[c,d]),f=this.image_;if(f&&this.renderedRevision_==this.getRevision()&&f.getResolution()==t&&f.getPixelRatio()==i&&(0,u.r4)(f.getExtent(),h))return f;const p={SERVICE:"WMS",VERSION:x.e,REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};Object.assign(p,this.params_),this.imageSize_[0]=(0,b.NM)((0,u.dz)(g)/s,4),this.imageSize_[1]=(0,b.NM)((0,u.Cr)(g)/s,4);const _=this.getRequestUrl_(g,this.imageSize_,i,n,p);return this.image_=new v.Z(g,t,i,_,this.crossOrigin_,this.imageLoadFunction_,this.context_),this.renderedRevision_=this.getRevision(),this.image_.addEventListener(r.Z.CHANGE,this.handleImageChange.bind(this)),this.image_}getImageLoadFunction(){return this.imageLoadFunction_}getRequestUrl_(e,t,i,r,n){if((0,w.h)(void 0!==this.url_,9),n[this.v13_?"CRS":"SRS"]=r.getCode(),"STYLES"in this.params_||(n.STYLES=""),1!=i)switch(this.serverType_){case"geoserver":const e=90*i+.5|0;"FORMAT_OPTIONS"in n?n.FORMAT_OPTIONS+=";dpi:"+e:n.FORMAT_OPTIONS="dpi:"+e;break;case"mapserver":n.MAP_RESOLUTION=90*i;break;case"carmentaserver":case"qgis":n.DPI=90*i;break;default:(0,w.h)(!1,8)}n.WIDTH=t[0],n.HEIGHT=t[1];const s=r.getAxisOrientation();let o;return o=this.v13_&&"ne"==s.substr(0,2)?[e[1],e[0],e[3],e[2]]:e,n.BBOX=o.join(","),(0,S.B)(this.url_,n)}getUrl(){return this.url_}setImageLoadFunction(e){this.image_=null,this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.image_=null,this.changed())}updateParams(e){Object.assign(this.params_,e),this.updateV13_(),this.image_=null,this.changed()}updateV13_(){const e=this.params_.VERSION||x.e;this.v13_=(0,C.n)(e,"1.3")>=0}}},751635:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var r=i(836365);class n extends r.Z{constructor(e){let t;t=void 0!==(e=e||{}).attributions?e.attributions:['&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.'];const i=void 0!==e.crossOrigin?e.crossOrigin:"anonymous",r=void 0!==e.url?e.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:t,attributionsCollapsible:!1,cacheSize:e.cacheSize,crossOrigin:i,interpolate:e.interpolate,maxZoom:void 0!==e.maxZoom?e.maxZoom:19,opaque:void 0===e.opaque||e.opaque,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:r,wrapX:e.wrapX,zDirection:e.zDirection})}}const s=n},991587:(e,t,i)=>{"use strict";i.d(t,{Z:()=>p});var r=i(365952),n=i(149081),s=i(578487),o=i(438906),a=i(421915),l=i(450596),h=i(152209),u=i(579313),c=i(218672),d=i(921882),g=i(570701);class f extends r.Z{constructor(e){e=e||{};const t=Object.assign({},e.params),i=!("TRANSPARENT"in t)||t.TRANSPARENT;super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,opaque:!i,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition,zDirection:e.zDirection}),this.gutter_=void 0!==e.gutter?e.gutter:0,this.params_=t,this.v13_=!0,this.serverType_=e.serverType,this.hidpi_=void 0===e.hidpi||e.hidpi,this.tmpExtent_=(0,a.lJ)(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(e,t,i,r){const s=(0,c.U2)(i),o=this.getProjection();let u=this.getTileGrid();u||(u=this.getTileGridForProjection(s));const d=u.getZForResolution(t,this.zDirection),g=u.getTileCoordForCoordAndZ(e,d);if(u.getResolutions().length<=g[0])return;let f=u.getResolution(g[0]),p=u.getTileCoordExtent(g,this.tmpExtent_),_=(0,l.Pq)(u.getTileSize(g[0]),this.tmpSize);const m=this.gutter_;0!==m&&(_=(0,l.f3)(_,m,this.tmpSize),p=(0,a.f3)(p,f*m,p)),o&&o!==s&&(f=(0,h.aA)(o,s,e,f),p=(0,c.$A)(p,s,o),e=(0,c.vs)(e,s,o));const T={SERVICE:"WMS",VERSION:n.e,REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};Object.assign(T,this.params_,r);const E=Math.floor((e[0]-p[0])/f),R=Math.floor((p[3]-e[1])/f);return T[this.v13_?"I":"X"]=E,T[this.v13_?"J":"Y"]=R,this.getRequestUrl_(g,_,p,1,o||s,T)}getLegendUrl(e,t){if(void 0===this.urls[0])return;const i={SERVICE:"WMS",VERSION:n.e,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(void 0===t||void 0===t.LAYER){const e=this.params_.LAYERS;if(Array.isArray(e)&&1!==e.length)return;i.LAYER=e}if(void 0!==e){const t=this.getProjection()?this.getProjection().getMetersPerUnit():1,r=28e-5;i.SCALE=e*t/r}return Object.assign(i,t),(0,s.B)(this.urls[0],i)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(e,t,i,r,n,a){const l=this.urls;if(!l)return;if(a.WIDTH=t[0],a.HEIGHT=t[1],a[this.v13_?"CRS":"SRS"]=n.getCode(),"STYLES"in this.params_||(a.STYLES=""),1!=r)switch(this.serverType_){case"geoserver":const e=90*r+.5|0;"FORMAT_OPTIONS"in a?a.FORMAT_OPTIONS+=";dpi:"+e:a.FORMAT_OPTIONS="dpi:"+e;break;case"mapserver":a.MAP_RESOLUTION=90*r;break;case"carmentaserver":case"qgis":a.DPI=90*r;break;default:(0,o.h)(!1,52)}const h=n.getAxisOrientation(),u=i;if(this.v13_&&"ne"==h.substr(0,2)){let e;e=i[0],u[0]=i[1],u[1]=e,e=i[2],u[2]=i[3],u[3]=e}let c;return a.BBOX=u.join(","),c=1==l.length?l[0]:l[(0,d.$W)((0,g.vp)(e),l.length)],(0,s.B)(c,a)}getTilePixelRatio(e){return this.hidpi_&&void 0!==this.serverType_?e:1}getKeyForParams_(){let e=0;const t=[];for(const i in this.params_)t[e++]=i+"-"+this.params_[i];return t.join("/")}updateParams(e){Object.assign(this.params_,e),this.updateV13_(),this.setKey(this.getKeyForParams_())}updateV13_(){const e=this.params_.VERSION||n.e;this.v13_=(0,u.n)(e,"1.3")>=0}tileUrlFunction(e,t,i){let r=this.getTileGrid();if(r||(r=this.getTileGridForProjection(i)),r.getResolutions().length<=e[0])return;1==t||this.hidpi_&&void 0!==this.serverType_||(t=1);const s=r.getResolution(e[0]);let o=r.getTileCoordExtent(e,this.tmpExtent_),h=(0,l.Pq)(r.getTileSize(e[0]),this.tmpSize);const u=this.gutter_;0!==u&&(h=(0,l.f3)(h,u,this.tmpSize),o=(0,a.f3)(o,s*u,o)),1!=t&&(h=(0,l.bA)(h,t,this.tmpSize));const c={SERVICE:"WMS",VERSION:n.e,REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};return Object.assign(c,this.params_),this.getRequestUrl_(e,h,o,t,i,c)}}const p=f},216969:(e,t,i)=>{"use strict";i.d(t,{Z:()=>S});var r=i(173381),n=i(624969),s=i(859900);class o extends n.Z{constructor(e,t,i,r,n,s){super(e,t,s),this.extent=null,this.format_=r,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=n,this.url_=i,this.key=i}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==s.Z.IDLE&&(this.setState(s.Z.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(e,t){this.setFeatures(e)}onError(){this.setState(s.Z.ERROR)}setFeatures(e){this.features_=e,this.setState(s.Z.LOADED)}setLoader(e){this.loader_=e}}const a=o;var l=i(593888),h=i(408930),u=i(327457),c=i(85386),d=i(949179);const g=[];class f extends n.Z{constructor(e,t,i,r){super(e,t,{transition:0}),this.context_={},this.executorGroups={},this.declutterExecutorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=r.bind(void 0,this),this.wrappedTileCoord=i}getContext(e){const t=(0,d.sq)(e);return t in this.context_||(this.context_[t]=(0,c.E4)(1,1,g)),this.context_[t]}hasContext(e){return(0,d.sq)(e)in this.context_}getImage(e){return this.hasContext(e)?this.getContext(e).canvas:null}getReplayState(e){const t=(0,d.sq)(e);return t in this.replayState_||(this.replayState_[t]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[t]}load(){this.getSourceTiles()}release(){for(const e in this.context_){const t=this.context_[e];(0,c.jy)(t),g.push(t.canvas),delete this.context_[e]}super.release()}}const p=f;var _=i(810508),m=i(421915),T=i(386018),E=i(570701),R=i(913580),y=i(280800),v=i(450596);class x extends u.Z{constructor(e){const t=e.projection||"EPSG:3857",i=e.extent||(0,T.Tl)(t),r=e.tileGrid||(0,T.dl)({extent:i,maxResolution:e.maxResolution,maxZoom:void 0!==e.maxZoom?e.maxZoom:22,minZoom:e.minZoom,tileSize:e.tileSize||512});super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,interpolate:!0,opaque:!1,projection:t,state:e.state,tileGrid:r,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:w,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition,zDirection:void 0===e.zDirection?1:e.zDirection}),this.format_=e.format?e.format:null,this.sourceTileCache=new l.Z(this.tileCache.highWaterMark),this.overlaps_=null==e.overlaps||e.overlaps,this.tileClass=e.tileClass?e.tileClass:a,this.tileGrids_={}}getFeaturesInExtent(e){const t=[],i=this.tileCache;if(0===i.getCount())return t;const r=(0,E.Ul)(i.peekFirstKey())[0],n=this.tileGrid;return i.forEach((function(i){if(i.tileCoord[0]!==r||i.getState()!==s.Z.LOADED)return;const o=i.getSourceTiles();for(let i=0,r=o.length;i<r;++i){const r=o[i],s=r.tileCoord;if((0,m.kK)(e,n.getTileCoordExtent(s))){const i=r.getFeatures();if(i)for(let r=0,n=i.length;r<n;++r){const n=i[r],s=n.getGeometry();(0,m.kK)(e,s.getExtent())&&t.push(n)}}}})),t}getOverlaps(){return this.overlaps_}clear(){this.tileCache.clear(),this.sourceTileCache.clear()}expireCache(e,t){const i=this.getTileCacheForProjection(e),r=Object.keys(t).reduce(((e,t)=>{const r=(0,E.MY)(t),n=i.peek(r);if(n){const t=n.sourceTiles;for(let i=0,r=t.length;i<r;++i)e[t[i].getKey()]=!0}return e}),{});super.expireCache(e,t),this.sourceTileCache.expireCache(r)}getSourceTiles(e,t,i){if(i.getState()===s.Z.IDLE){i.setState(s.Z.LOADING);const n=i.wrappedTileCoord,o=this.getTileGridForProjection(t),a=o.getTileCoordExtent(n),l=n[0],h=o.getResolution(l);(0,m.f3)(a,-h,a);const u=this.tileGrid,c=u.getExtent();c&&(0,m.Ed)(a,c,a);const d=u.getZForResolution(h,this.zDirection);u.forEachTileCoord(a,d,(n=>{const o=this.tileUrlFunction(n,e,t),a=this.sourceTileCache.containsKey(o)?this.sourceTileCache.get(o):new this.tileClass(n,o?s.Z.IDLE:s.Z.EMPTY,o,this.format_,this.tileLoadFunction);i.sourceTiles.push(a);const l=a.getState();if(l<s.Z.LOADED){const e=t=>{this.handleTileChange(t);const n=a.getState();if(n===s.Z.LOADED||n===s.Z.ERROR){const t=a.getKey();t in i.errorTileKeys?a.getState()===s.Z.LOADED&&delete i.errorTileKeys[t]:i.loadingSourceTiles--,n===s.Z.ERROR?i.errorTileKeys[t]=!0:a.removeEventListener(r.Z.CHANGE,e),0===i.loadingSourceTiles&&i.setState((0,R.x)(i.errorTileKeys)?s.Z.LOADED:s.Z.ERROR)}};a.addEventListener(r.Z.CHANGE,e),i.loadingSourceTiles++}l===s.Z.IDLE&&(a.extent=u.getTileCoordExtent(n),a.projection=t,a.resolution=u.getResolution(n[0]),this.sourceTileCache.set(o,a),a.load())})),i.loadingSourceTiles||i.setState(i.sourceTiles.some((e=>e.getState()===s.Z.ERROR))?s.Z.ERROR:s.Z.LOADED)}return i.sourceTiles}getTile(e,t,i,r,n){const o=(0,E.lg)(e,t,i),a=this.getKey();let l;if(this.tileCache.containsKey(o)&&(l=this.tileCache.get(o),l.key===a))return l;const h=[e,t,i];let u=this.getTileCoordForTileUrlFunction(h,n);const c=this.getTileGrid().getExtent(),d=this.getTileGridForProjection(n);if(u&&c){const t=d.getTileCoordExtent(u);(0,m.f3)(t,-d.getResolution(e),t),(0,m.kK)(c,t)||(u=null)}let g=!0;if(null!==u){const t=this.tileGrid,i=d.getResolution(e),s=t.getZForResolution(i,1),o=d.getTileCoordExtent(u);(0,m.f3)(o,-i,o),t.forEachTileCoord(o,s,(e=>{g=g&&!this.tileUrlFunction(e,r,n)}))}const f=new p(h,g?s.Z.EMPTY:s.Z.IDLE,u,this.getSourceTiles.bind(this,r,n));return f.key=a,l?(f.interimTile=l,f.refreshInterimChain(),this.tileCache.replace(o,f)):this.tileCache.set(o,f),f}getTileGridForProjection(e){const t=e.getCode();let i=this.tileGrids_[t];if(!i){const e=this.tileGrid,r=e.getResolutions().slice(),n=r.map((function(t,i){return e.getOrigin(i)})),s=r.map((function(t,i){return e.getTileSize(i)})),o=_.e+1;for(let e=r.length;e<o;++e)r.push(r[e-1]/2),n.push(n[e-1]),s.push(s[e-1]);i=new h.Z({extent:e.getExtent(),origins:n,resolutions:r,tileSizes:s}),this.tileGrids_[t]=i}return i}getTilePixelRatio(e){return e}getTilePixelSize(e,t,i){const r=this.getTileGridForProjection(i),n=(0,v.Pq)(r.getTileSize(e),this.tmpSize);return[Math.round(n[0]*t),Math.round(n[1]*t)]}updateCacheSize(e,t){super.updateCacheSize(2*e,t),this.sourceTileCache.highWaterMark=this.getTileCacheForProjection(t).highWaterMark}}const S=x;function w(e,t){e.setLoader((function(i,r,n){(0,y.ov)(t,e.getFormat(),i,r,n,e.onLoad.bind(e),e.onError.bind(e))}))}},162953:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var r=i(365952),n=i(578487),s=i(989434);i(218672);class o extends r.Z{constructor(e){const t=void 0!==e.requestEncoding?e.requestEncoding:"KVP",i=e.tileGrid;let r=e.urls;void 0===r&&void 0!==e.url&&(r=(0,s.Gk)(e.url)),super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,urls:r,wrapX:void 0!==e.wrapX&&e.wrapX,transition:e.transition,zDirection:e.zDirection}),this.version_=void 0!==e.version?e.version:"1.0.0",this.format_=void 0!==e.format?e.format:"image/jpeg",this.dimensions_=void 0!==e.dimensions?e.dimensions:{},this.layer_=e.layer,this.matrixSet_=e.matrixSet,this.style_=e.style,this.requestEncoding_=t,this.setKey(this.getKeyForDimensions_()),r&&r.length>0&&(this.tileUrlFunction=(0,s.Un)(r.map(this.createFromWMTSTemplate.bind(this))))}setUrls(e){this.urls=e;const t=e.join("\n");this.setTileUrlFunction((0,s.Un)(e.map(this.createFromWMTSTemplate.bind(this))),t)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const e=this.urls?this.urls.slice(0):[];for(const t in this.dimensions_)e.push(t+"-"+this.dimensions_[t]);return e.join("/")}updateDimensions(e){Object.assign(this.dimensions_,e),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(e){const t=this.requestEncoding_,i={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};"KVP"==t&&Object.assign(i,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e="KVP"==t?(0,n.B)(e,i):e.replace(/\{(\w+?)\}/g,(function(e,t){return t.toLowerCase()in i?i[t.toLowerCase()]:e}));const r=this.tileGrid,s=this.dimensions_;return function(i,o,a){if(!i)return;const l={TileMatrix:r.getMatrixId(i[0]),TileCol:i[1],TileRow:i[2]};Object.assign(l,s);let h=e;return h="KVP"==t?(0,n.B)(h,l):h.replace(/\{(\w+?)\}/g,(function(e,t){return l[t]})),h}}}const a=o},836365:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var r=i(365952),n=i(386018);class s extends r.Z{constructor(e){const t=void 0!==(e=e||{}).projection?e.projection:"EPSG:3857",i=void 0!==e.tileGrid?e.tileGrid:(0,n.dl)({extent:(0,n.Tl)(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,opaque:e.opaque,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=void 0!==e.gutter?e.gutter:0}getGutter(){return this.gutter_}}const o=s},149081:(e,t,i)=>{"use strict";i.d(t,{e:()=>r});const r="1.3.0"},579313:(e,t,i)=>{"use strict";function r(e,t){const i=(""+e).split("."),r=(""+t).split(".");for(let e=0;e<Math.max(i.length,r.length);e++){const t=parseInt(i[e]||"0",10),n=parseInt(r[e]||"0",10);if(t>n)return 1;if(n>t)return-1}return 0}i.d(t,{n:()=>r})},923241:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var r=i(408930);i(218672);class n extends r.Z{constructor(e){super({extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes}),this.matrixIds_=e.matrixIds}getMatrixId(e){return this.matrixIds_[e]}getMatrixIds(){return this.matrixIds_}}const s=n},703614:(e,t,i)=>{"use strict";e.exports=n;var r=i(680645);function n(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}n.Varint=0,n.Fixed64=1,n.Bytes=2,n.Fixed32=5;var s=4294967296,o=1/s,a="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function l(e){return e.type===n.Bytes?e.readVarint()+e.pos:e.pos+1}function h(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function u(e,t,i){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(r);for(var n=i.pos-1;n>=e;n--)i.buf[n+r]=i.buf[n]}function c(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function d(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function g(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function f(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function p(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function _(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function m(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function T(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function E(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function R(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function y(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function v(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}n.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,s=this.pos;this.type=7&r,e(n,t,this),this.pos===s&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=R(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=v(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=R(this.buf,this.pos)+R(this.buf,this.pos+4)*s;return this.pos+=8,e},readSFixed64:function(){var e=R(this.buf,this.pos)+v(this.buf,this.pos+4)*s;return this.pos+=8,e},readFloat:function(){var e=r.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=r.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,i,r=this.buf;return t=127&(i=r[this.pos++]),i<128?t:(t|=(127&(i=r[this.pos++]))<<7,i<128?t:(t|=(127&(i=r[this.pos++]))<<14,i<128?t:(t|=(127&(i=r[this.pos++]))<<21,i<128?t:function(e,t,i){var r,n,s=i.buf;if(r=(112&(n=s[i.pos++]))>>4,n<128)return h(e,r,t);if(r|=(127&(n=s[i.pos++]))<<3,n<128)return h(e,r,t);if(r|=(127&(n=s[i.pos++]))<<10,n<128)return h(e,r,t);if(r|=(127&(n=s[i.pos++]))<<17,n<128)return h(e,r,t);if(r|=(127&(n=s[i.pos++]))<<24,n<128)return h(e,r,t);if(r|=(1&(n=s[i.pos++]))<<31,n<128)return h(e,r,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=r[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&a?function(e,t,i){return a.decode(e.subarray(t,i))}(this.buf,t,e):function(e,t,i){for(var r="",n=t;n<i;){var s,o,a,l=e[n],h=null,u=l>239?4:l>223?3:l>191?2:1;if(n+u>i)break;1===u?l<128&&(h=l):2===u?128==(192&(s=e[n+1]))&&(h=(31&l)<<6|63&s)<=127&&(h=null):3===u?(s=e[n+1],o=e[n+2],128==(192&s)&&128==(192&o)&&((h=(15&l)<<12|(63&s)<<6|63&o)<=2047||h>=55296&&h<=57343)&&(h=null)):4===u&&(s=e[n+1],o=e[n+2],a=e[n+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&((h=(15&l)<<18|(63&s)<<12|(63&o)<<6|63&a)<=65535||h>=1114112)&&(h=null)),null===h?(h=65533,u=1):h>65535&&(h-=65536,r+=String.fromCharCode(h>>>10&1023|55296),h=56320|1023&h),r+=String.fromCharCode(h),n+=u}return r}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==n.Bytes)return e.push(this.readVarint(t));var i=l(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==n.Bytes)return e.push(this.readSVarint());var t=l(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==n.Bytes)return e.push(this.readBoolean());var t=l(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==n.Bytes)return e.push(this.readFloat());var t=l(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==n.Bytes)return e.push(this.readDouble());var t=l(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==n.Bytes)return e.push(this.readFixed32());var t=l(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==n.Bytes)return e.push(this.readSFixed32());var t=l(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==n.Bytes)return e.push(this.readFixed64());var t=l(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==n.Bytes)return e.push(this.readSFixed64());var t=l(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===n.Varint)for(;this.buf[this.pos++]>127;);else if(t===n.Bytes)this.pos=this.readVarint()+this.pos;else if(t===n.Fixed32)this.pos+=4;else{if(t!==n.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),y(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),y(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),y(this.buf,-1&e,this.pos),y(this.buf,Math.floor(e*o),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),y(this.buf,-1&e,this.pos),y(this.buf,Math.floor(e*o),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var i,r;if(e>=0?(i=e%4294967296|0,r=e/4294967296|0):(r=~(-e/4294967296),4294967295^(i=~(-e%4294967296))?i=i+1|0:(i=0,r=r+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,i){i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos]=127&e}(i,0,t),function(e,t){var i=(7&e)<<4;t.buf[t.pos++]|=i|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(r,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,i){for(var r,n,s=0;s<t.length;s++){if((r=t.charCodeAt(s))>55295&&r<57344){if(!n){r>56319||s+1===t.length?(e[i++]=239,e[i++]=191,e[i++]=189):n=r;continue}if(r<56320){e[i++]=239,e[i++]=191,e[i++]=189,n=r;continue}r=n-55296<<10|r-56320|65536,n=null}else n&&(e[i++]=239,e[i++]=191,e[i++]=189,n=null);r<128?e[i++]=r:(r<2048?e[i++]=r>>6|192:(r<65536?e[i++]=r>>12|224:(e[i++]=r>>18|240,e[i++]=r>>12&63|128),e[i++]=r>>6&63|128),e[i++]=63&r|128)}return i}(this.buf,e,this.pos);var i=this.pos-t;i>=128&&u(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),r.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),r.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var r=this.pos-i;r>=128&&u(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,i){this.writeTag(e,n.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,c,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,d,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,p,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,g,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,f,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,_,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,m,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,T,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,E,t)},writeBytesField:function(e,t){this.writeTag(e,n.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,n.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,n.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,n.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,n.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,n.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,n.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,n.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,n.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,n.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}}}}]);