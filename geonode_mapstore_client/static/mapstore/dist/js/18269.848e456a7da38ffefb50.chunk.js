(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[18269,82582,65417],{23279:(t,e,i)=>{var n=i(513218),s=i(707771),r=i(14841),o=Math.max,h=Math.min;t.exports=function(t,e,i){var a,l,c,d,u,g,m=0,f=!1,p=!1,y=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function v(e){var i=a,n=l;return a=l=void 0,m=e,d=t.apply(n,i)}function _(t){var i=t-g;return void 0===g||i>=e||i<0||p&&t-m>=c}function x(){var t=s();if(_(t))return C(t);u=setTimeout(x,function(t){var i=e-(t-g);return p?h(i,c-(t-m)):i}(t))}function C(t){return u=void 0,y&&a?v(t):(a=l=void 0,d)}function M(){var t=s(),i=_(t);if(a=arguments,l=this,g=t,i){if(void 0===u)return function(t){return m=t,u=setTimeout(x,e),f?v(t):d}(g);if(p)return clearTimeout(u),u=setTimeout(x,e),v(g)}return void 0===u&&(u=setTimeout(x,e)),d}return e=r(e)||0,n(i)&&(f=!!i.leading,c=(p="maxWait"in i)?o(r(i.maxWait)||0,e):c,y="trailing"in i?!!i.trailing:y),M.cancel=function(){void 0!==u&&clearTimeout(u),m=0,a=g=l=u=void 0},M.flush=function(){return void 0===u?d:C(s())},M}},707771:(t,e,i)=>{var n=i(555639);t.exports=function(){return n.Date.now()}},823493:(t,e,i)=>{var n=i(23279),s=i(513218);t.exports=function(t,e,i){var r=!0,o=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return s(i)&&(r="leading"in i?!!i.leading:r,o="trailing"in i?!!i.trailing:o),n(t,e,{leading:r,maxWait:e,trailing:o})}},623068:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var n=i(558493),s=i(173381),r=i(438906),o=i(613002);class h extends n.Z{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if("function"==typeof t.getSimplifiedGeometry){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new h(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const i=this.getStyle();return i&&t.setStyle(i),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&((0,o.bN)(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=(0,o.oL)(t,s.Z.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?function(t){if("function"==typeof t)return t;let e;return Array.isArray(t)?e=t:((0,r.h)("function"==typeof t.getZIndex,41),e=[t]),function(){return e}}(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}const a=h},116892:(t,e,i)=>{"use strict";i.d(e,{Z:()=>x});var n=i(9520),s=i(558493),r=i(15265),o=i(218672),h=i(921882);const a="accuracy",l="accuracyGeometry",c="altitude",d="altitudeAccuracy",u="heading",g="position",m="projection",f="speed",p="tracking",y="trackingOptions";class v extends n.ZP{constructor(t){super("error"),this.code=t.code,this.message=t.message}}class _ extends s.Z{constructor(t){super(),this.on,this.once,this.un,t=t||{},this.position_=null,this.transform_=o.gD,this.watchId_=void 0,this.addChangeListener(m,this.handleProjectionChanged_),this.addChangeListener(p,this.handleTrackingChanged_),void 0!==t.projection&&this.setProjection(t.projection),void 0!==t.trackingOptions&&this.setTrackingOptions(t.trackingOptions),this.setTracking(void 0!==t.tracking&&t.tracking)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const t=this.getProjection();t&&(this.transform_=(0,o.WO)((0,o.U2)("EPSG:4326"),t),this.position_&&this.set(g,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const t=this.getTracking();t&&void 0===this.watchId_?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):t||void 0===this.watchId_||(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(t){const e=t.coords;this.set(a,e.accuracy),this.set(c,null===e.altitude?void 0:e.altitude),this.set(d,null===e.altitudeAccuracy?void 0:e.altitudeAccuracy),this.set(u,null===e.heading?void 0:(0,h.Yr)(e.heading)),this.position_?(this.position_[0]=e.longitude,this.position_[1]=e.latitude):this.position_=[e.longitude,e.latitude];const i=this.transform_(this.position_);this.set(g,i.slice()),this.set(f,null===e.speed?void 0:e.speed);const n=(0,r.iu)(this.position_,e.accuracy);n.applyTransform(this.transform_),this.set(l,n),this.changed()}positionError_(t){this.dispatchEvent(new v(t))}getAccuracy(){return this.get(a)}getAccuracyGeometry(){return this.get(l)||null}getAltitude(){return this.get(c)}getAltitudeAccuracy(){return this.get(d)}getHeading(){return this.get(u)}getPosition(){return this.get(g)}getProjection(){return this.get(m)}getSpeed(){return this.get(f)}getTracking(){return this.get(p)}getTrackingOptions(){return this.get(y)}setProjection(t){this.set(m,(0,o.U2)(t))}setTracking(t){this.set(p,t)}setTrackingOptions(t){this.set(y,t)}}const x=_},540188:(t,e,i)=>{"use strict";i.d(e,{Z:()=>n});const n={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"}},193409:(t,e,i)=>{"use strict";i.d(e,{Z:()=>f});var n=i(558493),s=i(540188),r=i(267644),o=i(421915),h=i(613002),a=i(85386);const l="element",c="map",d="offset",u="position",g="positioning";class m extends n.Z{constructor(t){super(),this.on,this.once,this.un,this.options=t,this.id=t.id,this.insertFirst=void 0===t.insertFirst||t.insertFirst,this.stopEvent=void 0===t.stopEvent||t.stopEvent,this.element=document.createElement("div"),this.element.className=void 0!==t.className?t.className:"ol-overlay-container "+r.$A,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=!0===t.autoPan?{}:t.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(l,this.handleElementChanged),this.addChangeListener(c,this.handleMapChanged),this.addChangeListener(d,this.handleOffsetChanged),this.addChangeListener(u,this.handlePositionChanged),this.addChangeListener(g,this.handlePositioningChanged),void 0!==t.element&&this.setElement(t.element),this.setOffset(void 0!==t.offset?t.offset:[0,0]),this.setPositioning(t.positioning||"top-left"),void 0!==t.position&&this.setPosition(t.position)}getElement(){return this.get(l)}getId(){return this.id}getMap(){return this.get(c)||null}getOffset(){return this.get(d)}getPosition(){return this.get(u)}getPositioning(){return this.get(g)}handleElementChanged(){(0,a.ep)(this.element);const t=this.getElement();t&&this.element.appendChild(t)}handleMapChanged(){this.mapPostrenderListenerKey&&((0,a.ZF)(this.element),(0,h.bN)(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const t=this.getMap();if(t){this.mapPostrenderListenerKey=(0,h.oL)(t,s.Z.POSTRENDER,this.render,this),this.updatePixelPosition();const e=this.stopEvent?t.getOverlayContainerStopEvent():t.getOverlayContainer();this.insertFirst?e.insertBefore(this.element,e.childNodes[0]||null):e.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(t){this.set(l,t)}setMap(t){this.set(c,t)}setOffset(t){this.set(d,t)}setPosition(t){this.set(u,t)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(t){const e=this.getMap();if(!e||!e.getTargetElement()||!this.get(u))return;const i=this.getRect(e.getTargetElement(),e.getSize()),n=this.getElement(),s=this.getRect(n,[(0,a.iO)(n),(0,a.Pb)(n)]),r=void 0===(t=t||{}).margin?20:t.margin;if(!(0,o.r4)(i,s)){const n=s[0]-i[0],o=i[2]-s[2],h=s[1]-i[1],a=i[3]-s[3],l=[0,0];if(n<0?l[0]=n-r:o<0&&(l[0]=Math.abs(o)+r),h<0?l[1]=h-r:a<0&&(l[1]=Math.abs(a)+r),0!==l[0]||0!==l[1]){const i=e.getView().getCenterInternal(),n=e.getPixelFromCoordinateInternal(i);if(!n)return;const s=[n[0]+l[0],n[1]+l[1]],r=t.animation||{};e.getView().animateInternal({center:e.getCoordinateFromPixelInternal(s),duration:r.duration,easing:r.easing})}}}getRect(t,e){const i=t.getBoundingClientRect(),n=i.left+window.pageXOffset,s=i.top+window.pageYOffset;return[n,s,n+e[0],s+e[1]]}setPositioning(t){this.set(g,t)}setVisible(t){this.rendered.visible!==t&&(this.element.style.display=t?"":"none",this.rendered.visible=t)}updatePixelPosition(){const t=this.getMap(),e=this.getPosition();if(!t||!t.isRendered()||!e)return void this.setVisible(!1);const i=t.getPixelFromCoordinate(e),n=t.getSize();this.updateRenderedPosition(i,n)}updateRenderedPosition(t,e){const i=this.element.style,n=this.getOffset(),s=this.getPositioning();this.setVisible(!0);let r="0%",o="0%";"bottom-right"==s||"center-right"==s||"top-right"==s?r="-100%":"bottom-center"!=s&&"center-center"!=s&&"top-center"!=s||(r="-50%"),"bottom-left"==s||"bottom-center"==s||"bottom-right"==s?o="-100%":"center-left"!=s&&"center-center"!=s&&"center-right"!=s||(o="-50%");const h=`translate(${r}, ${o}) translate(${Math.round(t[0]+n[0])+"px"}, ${Math.round(t[1]+n[1])+"px"})`;this.rendered.transform_!=h&&(this.rendered.transform_=h,i.transform=h)}getOptions(){return this.options}}const f=m},286320:(t,e,i)=>{"use strict";function n(t){return Math.pow(t,3)}function s(t){return 1-n(1-t)}function r(t){return 3*t*t-2*t*t*t}function o(t){return t}i.d(e,{YQ:()=>n,Vv:()=>s,rd:()=>r,GE:()=>o})},869669:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var n=i(432538),s=i(421915),r=i(438667),o=i(517882);class h extends n.ZP{constructor(t,e,i){super(),void 0!==i&&void 0===e?this.setFlatCoordinates(i,t):(e=e||0,this.setCenterAndRadius(t,e,i))}clone(){const t=new h(this.flatCoordinates.slice(),void 0,this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,n){const s=this.flatCoordinates,r=t-s[0],o=e-s[1],h=r*r+o*o;if(h<n){if(0===h)for(let t=0;t<this.stride;++t)i[t]=s[t];else{const t=this.getRadius()/Math.sqrt(h);i[0]=s[0]+t*r,i[1]=s[1]+t*o;for(let t=2;t<this.stride;++t)i[t]=s[t]}return i.length=this.stride,h}return n}containsXY(t,e){const i=this.flatCoordinates,n=t-i[0],s=e-i[1];return n*n+s*s<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(t){const e=this.flatCoordinates,i=e[this.stride]-e[0];return(0,s.T9)(e[0]-i,e[1]-i,e[0]+i,e[1]+i,t)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const t=this.flatCoordinates[this.stride]-this.flatCoordinates[0],e=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return t*t+e*e}getType(){return"Circle"}intersectsExtent(t){const e=this.getExtent();if((0,s.kK)(t,e)){const e=this.getCenter();return t[0]<=e[0]&&t[2]>=e[0]||t[1]<=e[1]&&t[3]>=e[1]||(0,s.H6)(t,this.intersectsCoordinate.bind(this))}return!1}setCenter(t){const e=this.stride,i=this.flatCoordinates[e]-this.flatCoordinates[0],n=t.slice();n[e]=n[0]+i;for(let i=1;i<e;++i)n[e+i]=t[i];this.setFlatCoordinates(this.layout,n),this.changed()}setCenterAndRadius(t,e,i){this.setLayout(i,t,0),this.flatCoordinates||(this.flatCoordinates=[]);const n=this.flatCoordinates;let s=(0,r.IG)(n,0,t,this.stride);n[s++]=n[0]+e;for(let t=1,e=this.stride;t<e;++t)n[s++]=n[t];n.length=s,this.changed()}getCoordinates(){return null}setCoordinates(t,e){}setRadius(t){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+t,this.changed()}rotate(t,e){const i=this.getCenter(),n=this.getStride();this.setCenter((0,o.U1)(i,0,i.length,n,t,e,i)),this.changed()}}h.prototype.transform;const a=h},798090:(t,e,i)=>{"use strict";i.d(e,{Z:()=>l});var n=i(173381),s=i(208204),r=i(421915),o=i(613002);class h extends s.Z{constructor(t){super(),this.geometries_=t||null,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(o.bN),this.changeEventsKeys_.length=0}listenGeometriesChange_(){if(this.geometries_)for(let t=0,e=this.geometries_.length;t<e;++t)this.changeEventsKeys_.push((0,o.oL)(this.geometries_[t],n.Z.CHANGE,this.changed,this))}clone(){const t=new h(null);return t.setGeometries(this.geometries_),t.applyProperties(this),t}closestPointXY(t,e,i,n){if(n<(0,r.qf)(this.getExtent(),t,e))return n;const s=this.geometries_;for(let r=0,o=s.length;r<o;++r)n=s[r].closestPointXY(t,e,i,n);return n}containsXY(t,e){const i=this.geometries_;for(let n=0,s=i.length;n<s;++n)if(i[n].containsXY(t,e))return!0;return!1}computeExtent(t){(0,r.YN)(t);const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)(0,r.l7)(t,e[i].getExtent());return t}getGeometries(){return a(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)e[i].getType()===this.getType()?t=t.concat(e[i].getGeometriesArrayRecursive()):t.push(e[i]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],i=this.geometries_;let n=!1;for(let s=0,r=i.length;s<r;++s){const r=i[s],o=r.getSimplifiedGeometry(t);e.push(o),o!==r&&(n=!0)}if(n){const t=new h(null);return t.setGeometriesArray(e),t}return this.simplifiedGeometryMaxMinSquaredTolerance=t,this}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)if(e[i].intersectsExtent(t))return!0;return!1}isEmpty(){return 0===this.geometries_.length}rotate(t,e){const i=this.geometries_;for(let n=0,s=i.length;n<s;++n)i[n].rotate(t,e);this.changed()}scale(t,e,i){i||(i=(0,r.qg)(this.getExtent()));const n=this.geometries_;for(let s=0,r=n.length;s<r;++s)n[s].scale(t,e,i);this.changed()}setGeometries(t){this.setGeometriesArray(a(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)e[i].applyTransform(t);this.changed()}translate(t,e){const i=this.geometries_;for(let n=0,s=i.length;n<s;++n)i[n].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function a(t){const e=[];for(let i=0,n=t.length;i<n;++i)e.push(t[i].clone());return e}const l=h},804027:(t,e,i)=>{"use strict";function n(t,e,i,n){let s=t[e],r=t[e+1],o=0;for(let h=e+n;h<i;h+=n){const e=t[h],i=t[h+1];o+=Math.sqrt((e-s)*(e-s)+(i-r)*(i-r)),s=e,r=i}return o}i.d(e,{W:()=>n})},938642:(t,e,i)=>{"use strict";i.d(e,{h$:()=>s,YP:()=>r,gE:()=>o,Gw:()=>h});var n=i(921882);function s(t){if(void 0!==t)return 0}function r(t){if(void 0!==t)return t}function o(t){const e=2*Math.PI/t;return function(t,i){return i?t:void 0!==t?t=Math.floor(t/e+.5)*e:void 0}}function h(t){return t=t||(0,n.Yr)(5),function(e,i){return i?e:void 0!==e?Math.abs(e)<=t?0:e:void 0}}},382582:function(t){t.exports=function(){"use strict";function t(t,n,s,r,o){!function t(i,n,s,r,o){for(;r>s;){if(r-s>600){var h=r-s+1,a=n-s+1,l=Math.log(h),c=.5*Math.exp(2*l/3),d=.5*Math.sqrt(l*c*(h-c)/h)*(a-h/2<0?-1:1);t(i,n,Math.max(s,Math.floor(n-a*c/h+d)),Math.min(r,Math.floor(n+(h-a)*c/h+d)),o)}var u=i[n],g=s,m=r;for(e(i,s,n),o(i[r],u)>0&&e(i,s,r);g<m;){for(e(i,g,m),g++,m--;o(i[g],u)<0;)g++;for(;o(i[m],u)>0;)m--}0===o(i[s],u)?e(i,s,m):e(i,++m,r),m<=n&&(s=m+1),n<=m&&(r=m-1)}}(t,n,s||0,r||t.length-1,o||i)}function e(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function i(t,e){return t<e?-1:t>e?1:0}var n=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(t,e,i){if(!i)return e.indexOf(t);for(var n=0;n<e.length;n++)if(i(t,e[n]))return n;return-1}function r(t,e){o(t,0,t.children.length,e,t)}function o(t,e,i,n,s){s||(s=m(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(var r=e;r<i;r++){var o=t.children[r];h(s,t.leaf?n(o):o)}return s}function h(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function a(t,e){return t.minX-e.minX}function l(t,e){return t.minY-e.minY}function c(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function d(t){return t.maxX-t.minX+(t.maxY-t.minY)}function u(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function g(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function m(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function f(e,i,n,s,r){for(var o=[i,n];o.length;)if(!((n=o.pop())-(i=o.pop())<=s)){var h=i+Math.ceil((n-i)/s/2)*s;t(e,h,i,n,r),o.push(i,h,h,n)}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(t){var e=this.data,i=[];if(!g(t,e))return i;for(var n=this.toBBox,s=[];e;){for(var r=0;r<e.children.length;r++){var o=e.children[r],h=e.leaf?n(o):o;g(t,h)&&(e.leaf?i.push(o):u(t,h)?this._all(o,i):s.push(o))}e=s.pop()}return i},n.prototype.collides=function(t){var e=this.data;if(!g(t,e))return!1;for(var i=[];e;){for(var n=0;n<e.children.length;n++){var s=e.children[n],r=e.leaf?this.toBBox(s):s;if(g(t,r)){if(e.leaf||u(t,r))return!0;i.push(s)}}e=i.pop()}return!1},n.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var n=this.data;this.data=i,i=n}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},n.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},n.prototype.clear=function(){return this.data=m([]),this},n.prototype.remove=function(t,e){if(!t)return this;for(var i,n,r,o=this.data,h=this.toBBox(t),a=[],l=[];o||a.length;){if(o||(o=a.pop(),n=a[a.length-1],i=l.pop(),r=!0),o.leaf){var c=s(t,o.children,e);if(-1!==c)return o.children.splice(c,1),a.push(o),this._condense(a),this}r||o.leaf||!u(o,h)?n?(i++,o=n.children[i],r=!1):o=null:(a.push(o),l.push(i),i=0,n=o,o=o.children[0])}return this},n.prototype.toBBox=function(t){return t},n.prototype.compareMinX=function(t,e){return t.minX-e.minX},n.prototype.compareMinY=function(t,e){return t.minY-e.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(t){return this.data=t,this},n.prototype._all=function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},n.prototype._build=function(t,e,i,n){var s,o=i-e+1,h=this._maxEntries;if(o<=h)return r(s=m(t.slice(e,i+1)),this.toBBox),s;n||(n=Math.ceil(Math.log(o)/Math.log(h)),h=Math.ceil(o/Math.pow(h,n-1))),(s=m([])).leaf=!1,s.height=n;var a=Math.ceil(o/h),l=a*Math.ceil(Math.sqrt(h));f(t,e,i,l,this.compareMinX);for(var c=e;c<=i;c+=l){var d=Math.min(c+l-1,i);f(t,c,d,a,this.compareMinY);for(var u=c;u<=d;u+=a){var g=Math.min(u+a-1,d);s.children.push(this._build(t,u,g,n-1))}}return r(s,this.toBBox),s},n.prototype._chooseSubtree=function(t,e,i,n){for(;n.push(e),!e.leaf&&n.length-1!==i;){for(var s=1/0,r=1/0,o=void 0,h=0;h<e.children.length;h++){var a=e.children[h],l=c(a),d=(u=t,g=a,(Math.max(g.maxX,u.maxX)-Math.min(g.minX,u.minX))*(Math.max(g.maxY,u.maxY)-Math.min(g.minY,u.minY))-l);d<r?(r=d,s=l<s?l:s,o=a):d===r&&l<s&&(s=l,o=a)}e=o||e.children[0]}var u,g;return e},n.prototype._insert=function(t,e,i){var n=i?t:this.toBBox(t),s=[],r=this._chooseSubtree(n,this.data,e,s);for(r.children.push(t),h(r,n);e>=0&&s[e].children.length>this._maxEntries;)this._split(s,e),e--;this._adjustParentBBoxes(n,s,e)},n.prototype._split=function(t,e){var i=t[e],n=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,n);var o=this._chooseSplitIndex(i,s,n),h=m(i.children.splice(o,i.children.length-o));h.height=i.height,h.leaf=i.leaf,r(i,this.toBBox),r(h,this.toBBox),e?t[e-1].children.push(h):this._splitRoot(i,h)},n.prototype._splitRoot=function(t,e){this.data=m([t,e]),this.data.height=t.height+1,this.data.leaf=!1,r(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(t,e,i){for(var n,s,r,h,a,l,d,u=1/0,g=1/0,m=e;m<=i-e;m++){var f=o(t,0,m,this.toBBox),p=o(t,m,i,this.toBBox),y=(s=f,r=p,void 0,void 0,void 0,void 0,h=Math.max(s.minX,r.minX),a=Math.max(s.minY,r.minY),l=Math.min(s.maxX,r.maxX),d=Math.min(s.maxY,r.maxY),Math.max(0,l-h)*Math.max(0,d-a)),v=c(f)+c(p);y<u?(u=y,n=m,g=v<g?v:g):y===u&&v<g&&(g=v,n=m)}return n||i-e},n.prototype._chooseSplitAxis=function(t,e,i){var n=t.leaf?this.compareMinX:a,s=t.leaf?this.compareMinY:l;this._allDistMargin(t,e,i,n)<this._allDistMargin(t,e,i,s)&&t.children.sort(n)},n.prototype._allDistMargin=function(t,e,i,n){t.children.sort(n);for(var s=this.toBBox,r=o(t,0,e,s),a=o(t,i-e,i,s),l=d(r)+d(a),c=e;c<i-e;c++){var u=t.children[c];h(r,t.leaf?s(u):u),l+=d(r)}for(var g=i-e-1;g>=e;g--){var m=t.children[g];h(a,t.leaf?s(m):m),l+=d(a)}return l},n.prototype._adjustParentBBoxes=function(t,e,i){for(var n=i;n>=0;n--)h(e[n],t)},n.prototype._condense=function(t){for(var e=t.length-1,i=void 0;e>=0;e--)0===t[e].children.length?e>0?(i=t[e-1].children).splice(i.indexOf(t[e]),1):this.clear():r(t[e],this.toBBox)},n}()}}]);