(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[46781],{443143:(e,r,t)=>{"use strict";t.d(r,{qH:()=>s,qj:()=>d,qq:()=>f,TM:()=>v});var n,a=t(717621),i=t.n(a),o=t(14841),l=t.n(o),u=t(264721),c=t.n(u),s=function(e,r,t,a){var i=e;isNaN(parseFloat(e))&&(i=n.hexToHsv(e)[0]);var o=.5/(t-1),l=r/(t-1),u=[];1===t&&(o=.5,l=r/2);for(var c=0;c<t;c++){var s=i+c*l-r/2,d=o*c+.3,f=d;a&&(s=a.h||s,d=a.s||d,f=a.v||f),u.push(n.hsvToHex(s,d,f,c))}return u},d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"red";return i()(e).toHexString()},f=function(e,r,t){var n=i()(e);return e&&n.setAlpha(l()(void 0!==r?r:n.getAlpha())).toRgbString()||t},v=function e(r){var t=Math.round,a=Math.random,i=[t(255*a()),t(255*a()),t(255*a())],o=n.rgbToHex(i);if(r)for(;c()(r,o)||"#000000"===o||"#FFFFFF"===o;)e(r);return o};n={decToHex:function(e){var r="0123456789ABCDEF",t=parseInt(e,10);return t=isNaN(t)?0:t,r.charAt(((t=t>255||t<0?0:t)-t%16)/16)+r.charAt(t%16)},rgbToHex:function(e,r,t){return e instanceof Array?n.rgbToHex(e[0],e[1],e[2]):"#"+n.decToHex(e)+n.decToHex(r)+n.decToHex(t)},realToDec:function(e){return Math.min(255,Math.round(256*e))},rgbToHsv:function(e,r,t){if(e instanceof Array)return n.rgbToHsv(e[0],e[1],e[2]);var a,i,o,l,u,c=e/255,s=r/255,d=t/255;switch(a=Math.min(Math.min(c,s),d),o=(i=Math.max(Math.max(c,s),d))-a,i){case a:l=0;break;case c:l=60*(s-d)/o,s<d&&(l+=360);break;case s:l=60*(d-c)/o+120;break;case d:l=60*(c-s)/o+240}return u=0===i?0:1-a/i,[Math.round(l),u,i]},distributedColorsHEX:function(e){for(var r=360/(e-1),t=[],a=function e(r,t,a){var i=e(r,t,a);return n.rgbToHex(i)},i=0;i<e;i++)t.push(a(r*i,.57,.63));return t},sameToneRangeColors:s,hsvToRgb:function(e,r,t){if(e instanceof Array)return n.hsvToRgb(e[0],e[1],e[2]);var a,i,o,l=Math.floor(e/60%6),u=e/60-l,c=t*(1-r),s=t*(1-u*r),d=t*(1-(1-u)*r);switch(l){case 0:a=t,i=d,o=c;break;case 1:a=s,i=t,o=c;break;case 2:a=c,i=t,o=d;break;case 3:a=c,i=s,o=t;break;case 4:a=d,i=c,o=t;break;case 5:a=t,i=c,o=s}return[n.realToDec(a),n.realToDec(i),n.realToDec(o)]},hsvToHex:function(e,r,t){var a=n.hsvToRgb(e,r,t);return n.rgbToHex(a)},hexToHsv:function(e){var r=e;if(r.length>0){"#"===r[0]&&(r=e.substring(1));var t=n.hexToRgb(r);return n.rgbToHsv(t)}return null},hexToRgb:function(e){var r,t,n,a=e;return"#"===a.charAt(0)&&(a=e.substring(1)),r=a.charAt(0)+a.charAt(1),t=a.charAt(2)+a.charAt(3),n=a.charAt(4)+a.charAt(5),[parseInt(r,16),parseInt(t,16),parseInt(n,16)]},colorToHexStr:d,colorToRgbaStr:f,generateRandomHexColor:v}},246781:(e,r,t)=>{"use strict";t.d(r,{h6:()=>de,nb:()=>Y,t3:()=>be,sq:()=>ie,YA:()=>ee,uo:()=>le,lF:()=>he,Sk:()=>ce,mK:()=>ve,lw:()=>ne,Yj:()=>te,Mt:()=>X,YE:()=>ue,Oe:()=>se,D6:()=>z,Ug:()=>J,nJ:()=>ye,cu:()=>me,aw:()=>ae,p3:()=>pe,wM:()=>ge,IO:()=>oe});var n=t(227361),a=t.n(n),i=t(313311),o=t.n(i),l=t(281763),u=t.n(l),c=(t(59854),t(630998)),s=t.n(c),d=t(264721),f=t.n(d),v=t(441609),p=t.n(v),g=t(150361),m=t.n(g),h=t(957557),y=t.n(h),b=t(984596),x=t.n(b),A=t(478718),I=t.n(A),O=t(747037),T=t.n(O),w=t(944908),C=t.n(w),M=t(728252),S=t.n(M),j=t(557579),k=function(e,r,t){var n,a,i=[],o=[],l=e;for(i.push(l);i.length>0;)if(!t[l=i.shift()])for(t[l]=!0,o.push(l),n=0;n<r.length;n+=1)(a=r[n])[0]!==l||t[a[1]]?a[1]!==l||t[a[0]]||i.push(a[0]):i.push(a[1]);return o},P=t(443143),D=t(423570),H=t.n(D),F=t(761868);function B(e){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},B(e)}var q=["classificationAttributeType"],E=["textinfo","includeLegendPercent"];function U(e,r){if(null==e)return{};var t,n,a=function(e,r){if(null==e)return{};var t={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(r.indexOf(n)>=0)continue;t[n]=e[n]}return t}(e,r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)t=i[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}function V(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function K(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?V(Object(t),!0).forEach((function(r){N(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):V(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function N(e,r,t){var n;return n=function(e,r){if("object"!=B(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=B(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r),(r="symbol"==B(n)?n:n+"")in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function R(e){return function(e){if(Array.isArray(e))return G(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||$(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var n,a,i,o,l=[],u=!0,c=!1;try{if(i=(t=t.call(e)).next,0===r){if(Object(t)!==t)return;u=!1}else for(;!(u=(n=i.call(t)).done)&&(l.push(n.value),l.length!==r);u=!0);}catch(e){c=!0,a=e}finally{try{if(!u&&null!=t.return&&(o=t.return(),Object(o)!==o))return}finally{if(c)throw a}}return l}}(e,r)||$(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $(e,r){if(e){if("string"==typeof e)return G(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?G(e,r):void 0}}function G(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Y={FAMILY:"inherit",SIZE:12,COLOR:"#000000"},_=function(e,r){var t=L(j.oU.exec(e),2),n=t[0],a=t[1];return n?o()(r,{id:a}):null},z=function(e,r,t){var n=j.oU.exec(e),i=n&&n[2];i=function(e,r,t){var n=L(j.h9.exec(e)||[],2),a=n[0],i=n[1],l=(o()(t,{id:r})||{}).maps;if(a&&!p()(l)){var u=s()(l,{mapId:i});return a.replace(i,u)}return e}(i,n[1],t);var l=_(e,r);return i?a()(l,i):l},J=function(){var e=function(e){for(var r={},t=[],n=0,a=e.length;n<a;n+=1){var i=e[n],o=i[0],l=i[1],u=null;r[o]?r[l]||(u=l):u=o,u&&t.push(k(u,e,r))}return t}(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.reduce((function(r,t){var n=a()(t,"mapSync")&&a()(t,"dependenciesMap")||{},i=Object.keys(n).map((function(r){return _(n[r],e)}))||[];return[].concat(R(r),R(i.filter((function(e){return void 0!==e})).map((function(e){return[t.id,e.id]}))))}),[])}(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[])),r=(0,P.qH)(190,340,e.length+1,{base:10,range:360,s:.67,v:.67});return e.map((function(e,t){return{color:r[t],widgets:e}}))},X=function(){return[{value:"Count",label:"widgets.operations.COUNT"},{value:"Sum",label:"widgets.operations.SUM"},{value:"Average",label:"widgets.operations.AVG"},{value:"StdDev",label:"widgets.operations.STDDEV"},{value:"Min",label:"widgets.operations.MIN"},{value:"Max",label:"widgets.operations.MAX"}]},Z=["selectedChartId","selectedTraceId","id","mapSync","widgetType","charts","dependenciesMap","dataGrid","title","description"],Q={"global.colors.blue":"#0888A1","global.colors.red":"#CD4A29","global.colors.green":"#29CD2E","global.colors.brown":"#CD8029","global.colors.purple":"#CD29C7"},W={"global.colors.blue":"blues","global.colors.red":"reds","global.colors.green":"greens","global.colors.brown":"ylorbr","global.colors.purple":"purples","global.colors.random":"random"},ee=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=r.color,n=void 0===t?Q["global.colors.blue"]:t,a=r.ramp;return"pie"===e?{msClassification:{method:"uniqueInterval",intervals:5,reverse:!1,ramp:void 0===a?"blues":a}}:"bar"===e?{msMode:"simple",line:{color:"rgb(0, 0, 0)",width:0},marker:{color:n}}:{line:{color:n,width:2},marker:{color:n,size:6}}},re=function(e){var r=e.autoColorOptions,t=e.type,n=e.classificationAttributeType;if(!r)return{style:ee(t)};var a="number"===n?"equalInterval":"uniqueInterval";if("global.colors.custom"===(null==r?void 0:r.name))return{style:K(K({},"bar"===t&&{msMode:"classification"}),{},{msClassification:{method:a,intervals:5,reverse:!1,ramp:"viridis",defaultColor:r.defaultCustomColor,defaultLabel:r.defaultClassLabel,classes:("uniqueInterval"===a?r.classification:r.rangeClassification)||[]}})};if("pie"===t)return{style:{msClassification:{method:a,intervals:5,reverse:!1,ramp:W[r.name]}}};var i=Q[r.name];return{style:ee(t,{color:i})}},te=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.aggregateFunction&&"None"!==e.aggregateFunction?"".concat(e.aggregateFunction,"(").concat(e.aggregationAttribute,")"):e.aggregationAttribute||""},ne=function(e){var r=(null==e?void 0:e.type)||"bar",t=null!=e&&e.color?e.color:null!=e&&e.randomColor?"rgb(".concat(255*Math.random(),", ").concat(255*Math.random(),", ").concat(255*Math.random(),")"):void 0;return K(K(K({id:H()(),type:r,layer:null==e?void 0:e.layer},(null==e?void 0:e.geomProp)&&{geomProp:e.geomProp}),(null==e?void 0:e.filter)&&{filter:e.filter}),{},{options:{},style:ee(r,{color:t})})},ae=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.yAxis,t=e.xAxisAngle,n=e.type,a=e.options,i=e.autoColorOptions,o=e.legend,l=e.cartesian,u=e.chartId,c=e.xAxisOpts,s=e.yAxisOpts,d=e.yAxisLabel,f=e.tickPrefix,v=e.format,p=e.tickSuffix,g=e.formula,m=e.name,h=e.geomProp,y=e.layer,b=e.barChartType,x=a||{},A=x.classificationAttributeType,I=U(x,q),O=s||{},T=O.textinfo,w=O.includeLegendPercent,C=U(O,E);return{name:m,legend:o,cartesian:l,chartId:u,barChartType:b,xAxisOpts:[K(K({},c),{},{angle:t,id:0})],yAxisOpts:[K(K({},C),{},{hide:!1===r,id:0})],traces:[K(K({id:"trace-".concat(u),name:d,type:n,options:I},re({autoColorOptions:i,classificationAttributeType:A,type:n})),{},{textinfo:T,tickPrefix:f,format:v,tickSuffix:p,formula:g,geomProp:h,layer:y,includeLegendPercent:w})]}},ie=function(e){var r=["layers","viewport","zoom","center"],t=m()(e),n=(null==t?void 0:t.widgets)||[],a=[];return K(K({},t),{},{widgets:n.map((function(e){var t,n,i=K({},e);if("map"===e.widgetType&&e.map){var l=H()();i=y()(K(K({},e),{},{selectedMapId:l,maps:x()(K(K({},e.map),{},{mapId:l}))}),"map"),a.push({widgetId:i.id,mapId:l})}if("chart"===e.widgetType&&e.layer){var u=H()(),c=y()(i,Z)||{},s=I()(i,Z)||{};i=K(K({},s),{},{selectedChartId:u,charts:x()(K(K({},c),{},{layer:e.layer,name:"Chart-1",chartId:u}))})}if("chart"===e.widgetType&&null!==(t=i)&&void 0!==t&&null!==(n=t.charts)&&void 0!==n&&n.find((function(e){return!e.traces}))&&(i.charts=i.charts.map((function(e){return e.traces?e:ae(e)}))),!p()(i.dependenciesMap)){var d=Object.values(i.dependenciesMap)[0],v=L(j.oU.exec(d)||[],2)[1],g=o()(a,{widgetId:v})||{},m=g.widgetId,h=g.mapId;if(m)return K(K({},i),{},{dependenciesMap:Object.keys(i.dependenciesMap).filter((function(e){return void 0!==i.dependenciesMap[e]})).reduce((function(e,t){return f()(r,t)?K(K({},e),{},N({},t,i.dependenciesMap[t].replace(".map.",".maps[".concat(h,"].")))):K(K({},e),{},N({},t,i.dependenciesMap[t]))}),{})})}return i}))})},oe=function(){var e=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,t=R(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]);return t.filter((function(e){return e.dependenciesMap})).some((function(r){return Object.values(r.dependenciesMap).some((function(r){return(j.oU.exec(r)||[])[1]===e}))}))&&(t=t.map((function(t){var n=t.dependenciesMap,a=!p()(n)&&(j.oU.exec(Object.values(n)[0])||[])[1];return K(K({},t),!p()(n)&&a===e&&{dependenciesMap:Object.keys(n).reduce((function(e,t){var a=L(j.jB.exec(n[t])||[],3)[2];return K(K({},e),{},N({},t,a?n[t].replace(a,r):n[t]))}),{})})}))),t},le=function(e,r){var t,n=function(e){var r=e.key,t=r,n=e.value,a="",i="";return r.includes("maps")?(t="maps",a=j.h9,i="mapId"):r.includes("charts")&&(t="charts",a=j.Jo,i="chartId"),{path:"builder.editor.".concat(t),value:n,key:r,regex:a,identifier:i}}(e),i=n.key,o=n.path,l=n.identifier,u=n.regex,c=n.value;if(["maps","charts"].some((function(e){return i.includes(e)}))){if("maps"===i&&void 0===c)return S()(o,c,r);var s=L(u.exec(i)||[],3),d=s[1],f=s[2],v=c;return d&&(v=function(e){var r=e.identifier,t=e.id,n=e.charts,i=e.pathToUpdate,o=e.value;if(i.includes("traces[")){var l=n.find((function(e){return e[r]===t})),u=a()(l,"traces",[]),c=L(j.sR.exec(i)||[],3),s=c[1],d=c[2];if(u.map((function(e){return e.id})).indexOf(s)>-1){var f=u.map((function(e){return e.id===s?S()(d,o,e):e}));return S()("traces",f,n.find((function(e){return e[r]===t})))}}return S()(i,o,n.find((function(e){return e[r]===t})))}({identifier:l,id:d,charts:a()(r,o,[]),pathToUpdate:f,value:c})),(0,F.vy)(o,v,N({},l,d||(null==c?void 0:c[l])),r)}var p=K({},null==r||null===(t=r.builder)||void 0===t?void 0:t.editor);return i.includes("chart-")?S()("builder.editor",function(e){var r=e.editorData,t=e.key,n=e.value,a=I()(r,Z)||{};if("chart-layers"===t){var i,o,l,u,c=null==n?void 0:n.map((function(e){return{chartId:H()(),traces:[ne({layer:e})]}}));return K(K({},a),{},{charts:c,selectedChartId:null==c||null===(i=c[0])||void 0===i?void 0:i.chartId,selectedTraceId:null==c||null===(o=c[0])||void 0===o||null===(l=o.traces)||void 0===l||null===(u=l[0])||void 0===u?void 0:u.id})}if("chart-delete"===t){var s,d,f,v,p=n;return K(K({},a),{},{charts:p,selectedChartId:null==p||null===(s=p[0])||void 0===s?void 0:s.chartId,selectedTraceId:null==p||null===(d=p[0])||void 0===d||null===(f=d.traces)||void 0===f||null===(v=f[0])||void 0===v?void 0:v.id})}if("chart-add"===t){var g,m,h,y,b,x,A,O,T=null==n?void 0:n.map((function(e){return{chartId:H()(),traces:[ne({layer:e})]}})),w=[].concat(R((null==a?void 0:a.charts)||[]),R(T));return K(K({},a),{},{charts:w,selectedChartId:(null==T||null===(g=T[0])||void 0===g?void 0:g.chartId)||(null==w||null===(m=w[0])||void 0===m?void 0:m.chartId),selectedTraceId:(null==T||null===(h=T[0])||void 0===h||null===(y=h.traces)||void 0===y||null===(b=y[0])||void 0===b?void 0:b.id)||(null==w||null===(x=w[0])||void 0===x||null===(A=x.traces)||void 0===A||null===(O=A[0])||void 0===O?void 0:O.id)})}if("chart-layer-replace"===t){var C=n.layer[0],M=(a.charts||[]).map((function(e){return e.chartId===n.chartId?K(K({},e),{},{traces:((null==e?void 0:e.traces)||[]).map((function(e){return e.id===n.traceId?K(K({},e),{},{layer:C,options:{}}):e}))}):e}));return K(K({},a),{},{charts:M})}return a}({key:i,value:c,editorData:p}),r):S()(o,c,r)},ue=function(e){var r=e.widgets,t=void 0===r?[]:r,n=e.dependenciesMap,a=void 0===n?{}:n;return(null==t?void 0:t.find((function(e){var r;return e.id===(j.oU.exec(null===(r=Object.values(a))||void 0===r?void 0:r[0])||[])[1]})))||{}},ce=function(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=r.selectedChartId,n=r.selectedTraceId,a=(r.charts||[]).find((function(e){return e.chartId===t}));return((null==a?void 0:a.traces)||[]).find((function(e){return e.id===n}))||(null==a||null===(e=a.traces)||void 0===e?void 0:e[0])},se=function(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return"chart"===r.widgetType||r.charts?ce(r):"map"===r.widgetType||r.maps?(null==r||null===(e=r.maps)||void 0===e?void 0:e.find((function(e){return e.mapId===(null==r?void 0:r.selectedMapId)})))||{}:r},de={projection:"EPSG:900913",units:"m",center:{x:11.22894105149402,y:43.380053862794,crs:"EPSG:4326"},maxExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34],mapId:null,size:{width:1300,height:920},version:2,limits:{},mousePointer:"pointer",resolutions:[156543.03392804097,78271.51696402048,39135.75848201024,19567.87924100512,9783.93962050256,4891.96981025128,2445.98490512564,1222.99245256282,611.49622628141,305.748113140705,152.8740565703525,76.43702828517625,38.21851414258813,19.109257071294063,9.554628535647032,4.777314267823516,2.388657133911758,1.194328566955879,.5971642834779395,.29858214173896974,.14929107086948487,.07464553543474244,.03732276771737122,.01866138385868561,.009330691929342804,.004665345964671402,.002332672982335701,.0011663364911678506,.0005831682455839253,.00029158412279196264,.00014579206139598132]},fe=function(e){var r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).legendValue;return e.map((function(e,r,t){return K(K({},e),{},{index:r},void 0!==e.unique?{label:e.title||e.unique,insideClass:function(r){return r===e.unique}}:{label:e.title||(r<t.length-1?">= ".concat(e.min,"<br>< ").concat(e.max):">= ".concat(e.min,"<br><= ").concat(e.max)),insideClass:function(n){return r<t.length-1?n>=e.min&&n<e.max:n>=e.min&&n<=e.max}})})).map((function(e){var t,n;return K(K({},e),{},{label:"".concat(e.label||"").replace("${minValue}",null!==(t=e.min)&&void 0!==t?t:"").replace("${maxValue}",null!==(n=e.max)&&void 0!==n?n:"").replace("${legendValue}",r||"")})}))},ve=function(e){var r,t=e.type,n=e.data,a=e.sortBy,i=e.options,o=e.msClassification,l=e.classifyGeoJSON,u=e.excludeOthers,c=e.applyCustomSortFunctionOnClasses,s=o||{},d=s.ramp,f=void 0===d?"viridis":d,v=s.intervals,p=void 0===v?5:v,g=s.reverse,m=s.method,h=void 0===m?"uniqueInterval":m,y=s.classes,b=s.defaultColor,x=void 0===b?"#ffff00":b,A=s.defaultLabel,I=void 0===A?"Others":A,O=function(e){var r=e.type,t=e.options,n=e.sortBy;if("pie"===r){var a=null==t?void 0:t.groupByAttributes,i=te(t),o=(null==t?void 0:t.classificationAttribute)||a,l="groupBy"!==n?i:a,u=!(o===a);return{sortKey:u?o:l,sortByKey:l,classificationDataKey:o,legendValue:o,customSortFunc:!u&&(l===i?function(e,r){return e.index>r.index?-1:1}:function(e,r){return e.index>r.index?1:-1})}}if("bar"===r){var c=null==t?void 0:t.groupByAttributes,s=(null==t?void 0:t.classificationAttribute)||c,d=te(t),f="aggregation"!==n?c:d;return{sortKey:s===c?f:s,sortByKey:f,classificationDataKey:s,legendValue:d}}return{}}({type:t,options:i,sortBy:a}),w=O.customSortFunc,C=O.sortKey,M=O.sortByKey,S=O.classificationDataKey,j=O.legendValue,k=y&&fe(y,{legendValue:j}),P=T()(null==n||null===(r=n[0])||void 0===r?void 0:r[S]),D="pie"===n.type?function(e,r){return e[C]>r[C]?-1:1}:function(e,r){return e[C]>r[C]?1:-1},H=R(n).sort(D),F=P?"uniqueInterval":h,B=k||fe(l({type:"FeatureCollection",features:H.map((function(e){return{properties:e,type:"Feature",geometry:null}}))},{attribute:S,method:F,ramp:f,reverse:g,intervals:p,sort:!1})),q={color:x,label:(I||"").replace("${legendValue}",j||""),index:B.length},E=H.map((function(e){var r=B.find((function(r){return(0,r.insideClass)(e[S])}))||q;return K(K({},r),{},{properties:e,label:(r.label||"").replace("${groupByValue}",e[null==i?void 0:i.groupByAttributes]||"")})})),U=u?B:[].concat(R(B),[q]);return{sortByKey:M,classes:w&&c?U.sort(w):U,classifiedData:w?E.sort(w):E}},pe=function(e){return u()(e)&&!isNaN(e)?e:0},ge=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=null==r?void 0:r.groupByAttributes,n=te(r),a=!(!r.aggregateFunction||"None"===r.aggregateFunction),i=(null==r?void 0:r.classificationAttribute)||t;return e&&!a&&i===t?C()(e.map((function(e){return e[t]}))).map((function(r){var a=e.filter((function(e){return e[t]===r}));return N(N({},t,r),n,a.reduce((function(e,r){return e+pe(r[n])}),0))})):e},me=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(arguments.length>1?arguments[1]:void 0).hasAggregateProcess;return!!(e.aggregationAttribute&&e.groupByAttributes&&(!r||r&&e.aggregateFunction)||e.classificationAttribute)},he=function(){var e,r,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=null===(e=(null==n?void 0:n.traces)||[])||void 0===e?void 0:e.filter((function(e){return"bar"===e.type}));return 1===a.length?"classification"===(null===(r=a[0])||void 0===r||null===(t=r.style)||void 0===t?void 0:t.msMode):a.length>1&&1===(n.xAxisOpts||[{id:0}]).length&&1===(n.yAxisOpts||[{id:0}]).length},ye=function(e,r){var t,n=null==r||null===(t=r.layer)||void 0===t?void 0:t.name;return n&&a()(e,"charts",[]).every((function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).traces;return(void 0===e?[]:e).every((function(e){return a()(e,"layer.name")===n}))}))},be=function(e,r){var t=e&&"chart"===e.widgetType,n=e&&"map"===e.widgetType,i=function(e){var r=null==e?void 0:e.widgetType;return p()(e)?[]:"map"!==r?"chart"===r?C()(a()(e,"charts",[]).map((function(e){return a()(e,"traces",[]).map((function(e){return a()(e,"layer.name","")}))})).flat().filter((function(e){return e}))):x()(a()(e,"layer.name",[])):C()(a()(e,"maps",[]).map((function(e){return a()(e,"layers",[]).map((function(e){return a()(e,"name","")}))})).flat().filter((function(e){return e})))}(e);if(n)return!p()(i);var o=i.includes(a()(r,"layer.name"));return t?o&&ye(e,r):o}}}]);