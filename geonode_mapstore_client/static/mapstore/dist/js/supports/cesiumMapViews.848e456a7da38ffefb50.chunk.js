(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[78384,82582,65417],{858979:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>B});var r=n(124852),i=n(660904),o=n(532056),a=n(143450),l=n(638601),u=n(344485),c=n(883900),s=n(472568),f=n(185447),d=n(745332),h=n(644001),p=n(405254),m=n(160629),v=n(218157),g=n(485662),y=n(35961),Z=n(753577),b=n(550172),w=n(637453),x=n(379853);function D(e){return D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},D(e)}var O=["center","cameraPosition"];function _(e){return function(e){if(Array.isArray(e))return M(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return M(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?M(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach((function(t){var r,i,o,a;r=e,i=t,o=n[t],a=function(e,t){if("object"!=D(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=D(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i),(i="symbol"==D(a)?a:a+"")in r?Object.defineProperty(r,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[i]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const B=function(e){var t,n,D,M,I,B,C,E,Y,P,A=e.map,T=e.selectedId,X=e.views,N=e.apiRef,R=void 0===N?function(){}:N,j=e.showViewsGeometries,L=e.showClipGeometries,k=e.resources,F=null==X?void 0:X.find((function(e){return e.id===T})),z=(0,r.useRef)(),V=(0,r.useRef)(),U=(0,r.useRef)(),G=(0,r.useRef)(),q=(0,r.useRef)();return(0,r.useEffect)((function(){var e={options:{settings:[x.so.DESCRIPTION,x.so.POSITION,x.so.ANIMATION,x.so.MASK,x.so.GLOBE_TRANSLUCENCY,x.so.LAYERS_OPTIONS],unsupportedLayers:[],showClipGeometriesEnabled:!0},getView:function(){var e=A.camera.positionCartographic,t=(0,x.GM)(e.height),n=A.camera.computeViewRectangle(A.scene.globe.ellipsoid,new a.Z),r=A.scene.globe.pick(new l.Z(A.camera.position,A.camera.direction),A.scene);r||(r=i.Z.add(i.Z.clone(A.camera.position),i.Z.multiplyByScalar(i.Z.clone(A.camera.direction),1e5,new i.Z),new i.Z));var c=o.Z.fromCartesian(new i.Z(r.x,r.y,r.z));return{zoom:t,center:{longitude:u.Z.toDegrees(c.longitude),latitude:u.Z.toDegrees(c.latitude),height:c.height},cameraPosition:{longitude:u.Z.toDegrees(e.longitude),latitude:u.Z.toDegrees(e.latitude),height:e.height},bbox:[u.Z.toDegrees(n.west),u.Z.toDegrees(n.south),u.Z.toDegrees(n.east),u.Z.toDegrees(n.north)]}},setView:function(e){var t=function(e,t){var n=t.center,r=t.cameraPosition,a=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(t,O);if(a.orientation&&a.position)return{destination:a.position,orientation:a.orientation};var l,u={position:i.Z.clone(e.camera.position),orientation:{heading:e.camera.heading,pitch:e.camera.pitch,roll:e.camera.roll}},c=o.Z.toCartesian(o.Z.fromDegrees(n.longitude,n.latitude,n.height,new o.Z)),s=o.Z.toCartesian(o.Z.fromDegrees(n.longitude,n.latitude,n.height+1,new o.Z)),f=o.Z.toCartesian(o.Z.fromDegrees(r.longitude,r.latitude,r.height,new o.Z)),d=o.Z.toCartesian(o.Z.fromDegrees(r.longitude,r.latitude,r.height+1,new o.Z)),h=i.Z.subtract(f,c,new i.Z),p=i.Z.subtract(s,c,new i.Z),m=n.latitude>0&&Math.round((0,w.tj)(h,p))<=5?i.Z.subtract(f,d,new i.Z):i.Z.subtract(d,f,new i.Z);l=i.Z.subtract(c,f,new i.Z),i.Z.normalize(l,l),e.camera.setView({destination:f,orientation:{direction:l,up:m}}),e.camera.setView({destination:f,orientation:{direction:l,up:m}});var v={destination:{x:e.camera.position.x,y:e.camera.position.y,z:e.camera.position.z},orientation:{heading:e.camera.heading,pitch:e.camera.pitch,roll:e.camera.roll}};return e.camera.setView({destination:u.position,orientation:u.orientation}),v}(A,e),n=t.destination,r=t.orientation;A.camera.cancelFlight(),A.camera[e.flyTo?"flyTo":"setView"]({destination:n,orientation:r})},computeViewCoordinates:function(t,n){e.setView(S(S({},n),{},{flyTo:!1}));var r=A.camera.positionCartographic,i=(0,x.GM)(r.height),o=A.camera.computeViewRectangle(A.scene.globe.ellipsoid,new a.Z);return S(S({},n),{},{zoom:i,bbox:[u.Z.toDegrees(o.west),u.Z.toDegrees(o.south),u.Z.toDegrees(o.east),u.Z.toDegrees(o.north)]})}};R(e)}),[A]),(0,r.useEffect)((function(){return A&&(z.current=new c.Z({destroyPrimitives:!0}),A.scene.primitives.add(z.current),V.current=new s.Z,A.scene.primitives.add(V.current),U.current=new f.Z,A.scene.primitives.add(U.current),G.current=(0,b.xB)(16,{stroke:"#ffffff",strokeWidth:2,fill:!1}),q.current=new d.Z("clipGeometriesDataSource")),function(){null!=A&&A.isDestroyed&&!A.isDestroyed()&&((0,b.U2)(A,z.current),z.current=null,(0,b.U2)(A,V.current),V.current=null,(0,b.U2)(A,U.current),U.current=null)}}),[A]),(0,r.useEffect)((function(){return(j||L)&&null!=A&&A.isDestroyed&&!A.isDestroyed()&&(null==X?void 0:X.length)>0&&(j&&X.forEach((function(e){var t=o.Z.toCartesian(o.Z.fromDegrees(e.cameraPosition.longitude,e.cameraPosition.latitude,e.cameraPosition.height)),n=o.Z.toCartesian(o.Z.fromDegrees(e.center.longitude,e.center.latitude,e.center.height)),r=e.id===T;z.current.add((0,b.c4)({color:r?"#ffcc33":"#ffffff",opacity:1,depthFailColor:"#000000",depthFailOpacity:0,width:1,dashLength:10,coordinates:[t,n]})),V.current.add({position:t,image:G.current,color:(0,b.KF)({color:r?"#ffcc33":"#ffffff"}),disableDepthTestDistance:Number.POSITIVE_INFINITY,allowPicking:!1}),U.current.add({position:t,text:e.title,font:"12px sans-serif",disableDepthTestDistance:Number.POSITIVE_INFINITY,fillColor:(0,b.KF)({color:"#ffffff"}),outlineColor:(0,b.KF)({color:"#000000"}),outlineWidth:4,style:h.Z.FILL_AND_OUTLINE,showBackground:!1,backgroundPadding:new p.Z(4,4),pixelOffset:new p.Z(0,-16),horizontalOrigin:m.Z.CENTER,verticalOrigin:v.Z.BASELINE})})),L&&k.filter((function(e){var t,n,r=!(null==X||!X.find((function(t){var n,r;return(null==t||null===(n=t.terrain)||void 0===n?void 0:n.clippingLayerResourceId)===e.id||(null==t||null===(r=t.layers)||void 0===r?void 0:r.find((function(t){return(null==t?void 0:t.clippingLayerResourceId)===e.id})))})));return!(null==e||null===(t=e.data)||void 0===t||null===(n=t.collection)||void 0===n||!n.features||!r)})).forEach((function(e){(0,x.er)(e.data.collection.features).forEach((function(e){z.current.add((0,b.c4)({color:"#ff0000",opacity:1,width:3,dashLength:10,clampToGround:!0,coordinates:i.Z.fromDegreesArray(e.geometry.coordinates[0].reduce((function(e,t){return[].concat(_(e),_(t))}),[]))})),U.current.add({position:i.Z.fromDegreesArray(e.geometry.coordinates[0][0])[0],text:e.id,font:"12px sans-serif",disableDepthTestDistance:Number.POSITIVE_INFINITY,fillColor:(0,b.KF)({color:"#ffffff"}),outlineColor:(0,b.KF)({color:"#000000"}),outlineWidth:4,style:h.Z.FILL_AND_OUTLINE,showBackground:!1,backgroundPadding:new p.Z(4,4),pixelOffset:new p.Z(0,-16),horizontalOrigin:m.Z.CENTER,verticalOrigin:v.Z.BASELINE})}))})),A.scene.requestRender()),function(){var e,t,n;null!=A&&A.isDestroyed&&!A.isDestroyed()&&(null===(e=z.current)||void 0===e||e.removeAll(),null===(t=V.current)||void 0===t||t.removeAll(),null===(n=U.current)||void 0===n||n.removeAll(),A.scene.requestRender())}}),[X,T,A,j,L,k]),(0,r.useEffect)((function(){var e,t,n,r,i,o,a=A.scene.globe,l=(F||{}).globeTranslucency,u=void 0===l?{}:l;a.translucency.frontFaceAlphaByDistance=new g.Z(null!==(e=null==F||null===(t=F.globeTranslucency)||void 0===t?void 0:t.nearDistance)&&void 0!==e?e:x.Ih.TRANSLUCENCY_NEAR_DISTANCE,0,null!==(n=null==F||null===(r=F.globeTranslucency)||void 0===r?void 0:r.farDistance)&&void 0!==n?n:x.Ih.TRANSLUCENCY_FAR_DISTANCE,1);var c=null!==(i=null==u?void 0:u.opacity)&&void 0!==i?i:x.Ih.TRANSLUCENCY_OPACITY;return a.translucency.enabled=null!==(o=null==u?void 0:u.enabled)&&void 0!==o&&o,a.translucency.frontFaceAlphaByDistance.nearValue=c,a.translucency.frontFaceAlphaByDistance.farValue=null!=u&&u.fadeByDistance?1:c,A.scene.requestRender(),function(){null!=A&&A.isDestroyed&&!A.isDestroyed()&&(a.translucency.enabled=!1)}}),[null==F||null===(t=F.globeTranslucency)||void 0===t?void 0:t.enabled,null==F||null===(n=F.globeTranslucency)||void 0===n?void 0:n.fadeByDistance,null==F||null===(D=F.globeTranslucency)||void 0===D?void 0:D.nearDistance,null==F||null===(M=F.globeTranslucency)||void 0===M?void 0:M.farDistance,null==F||null===(I=F.globeTranslucency)||void 0===I?void 0:I.opacity]),(0,r.useEffect)((function(){var e,t=A.scene;return t.invertClassification=!(null==F||null===(e=F.mask)||void 0===e||!e.enabled),t.invertClassificationColor=new y.Z(0,0,0,0),function(){null!=A&&A.isDestroyed&&!A.isDestroyed()&&(t.invertClassification=!1)}}),[null==F||null===(B=F.mask)||void 0===B?void 0:B.enabled]),(0,r.useEffect)((function(){var e,t,n,r,i,o=A.scene.globe,a=null==k||null===(e=k.find((function(e){var t;return e.id===(null==F||null===(t=F.terrain)||void 0===t?void 0:t.clippingLayerResourceId)})))||void 0===e?void 0:e.data,l=null===(t=(0,x.er)(null==a||null===(n=a.collection)||void 0===n?void 0:n.features))||void 0===t?void 0:t.find((function(e){var t;return e.id===(null==F||null===(t=F.terrain)||void 0===t?void 0:t.clippingPolygonFeatureId)}));return l?(0,b.ir)(l,!(null==F||null===(r=F.terrain)||void 0===r||!r.clippingPolygonUnion),null==F||null===(i=F.terrain)||void 0===i?void 0:i.clipOriginalGeometry).then((function(e){var t;o.clippingPlanes=new Z.Z({planes:e,edgeWidth:1,edgeColor:y.Z.WHITE,unionClippingRegions:!(null==F||null===(t=F.terrain)||void 0===t||!t.clippingPolygonUnion)}),o.backFaceCulling=!0,o.showSkirts=!0,A.scene.requestRender()})):(o.clippingPlanes=new Z.Z({planes:[]}),A.scene.requestRender()),function(){null!=A&&A.isDestroyed&&!A.isDestroyed()&&(o.clippingPlanes=new Z.Z({planes:[]}),A.scene.requestRender())}}),[null==F||null===(C=F.terrain)||void 0===C?void 0:C.clippingPolygonFeatureId,null==F||null===(E=F.terrain)||void 0===E?void 0:E.clippingPolygonUnion,null==F||null===(Y=F.terrain)||void 0===Y?void 0:Y.clipOriginalGeometry,null==F||null===(P=F.terrain)||void 0===P?void 0:P.clippingLayerResourceId,k]),null}},637453:(e,t,n)=>{"use strict";n.d(t,{eN:()=>h,tj:()=>p,Ys:()=>m,bj:()=>v,Qg:()=>g,nz:()=>y,Qk:()=>b,vZ:()=>w,g7:()=>x,Rk:()=>D});var r=n(660904),i=n(344485),o=n(405254),a=n(532056),l=n(835189),u=n(509187),c=n.n(u);function s(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(s=function(){return!!e})()}function f(e,t){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},f(e,t)}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function h(e,t){var n=r.Z.subtract(t,e,new r.Z),i=r.Z.multiplyByScalar(n,.5,new r.Z);return r.Z.add(e,i,new r.Z)}function p(e,t){var n=r.Z.normalize(e,new r.Z),o=r.Z.normalize(t,new r.Z),a=r.Z.dot(n,o);return i.Z.toDegrees(Math.acos(a))}function m(e){return e.map((function(t,n){var i=e[n-1],o=e[n+1];return i&&o?p(r.Z.subtract(i,t,new r.Z),r.Z.subtract(o,t,new r.Z)):null})).filter((function(e){return null!==e}))}function v(e){return new r.Z((e[0].x+e[1].x+e[2].x)/3,(e[0].y+e[1].y+e[2].y)/3,(e[0].z+e[1].z+e[2].z)/3)}function g(e,t){return e.map((function(n,i){var o=e[i-1],a=e[i+1];if(o&&a){var l=function(e,t){var n=r.Z.normalize(e,new r.Z),i=r.Z.normalize(t,new r.Z);return r.Z.cross(n,i,new r.Z)}(r.Z.subtract(o,n,new r.Z),r.Z.subtract(a,n,new r.Z)),u=-Math.sign(r.Z.dot(l,r.Z.subtract(n,t,new r.Z),new r.Z));return p(r.Z.multiplyByScalar(l,u,new r.Z),n)}return null})).filter((function(e){return null!==e}))}function y(e,t){if((null==e?void 0:e.length)<3)return 0;for(var n=o.Z.packArray(e),i=c()(n,t,2),a=0,l=0;l<i.length;l+=3){var u=e[i[l]],s=e[i[l+1]],f=e[i[l+2]],d=r.Z.subtract(s,u,new r.Z),h=r.Z.subtract(f,u,new r.Z),p=r.Z.cross(d,h,new r.Z);a+=r.Z.magnitude(p)/2}return a}function Z(e,t){var n,r=[e,t].map((function(e){return a.Z.fromCartesian(e)}));return function(e,t,n){if(s())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,t);var i=new(e.bind.apply(e,r));return n&&f(i,n.prototype),i}(l.Z,(n=r.map((function(e){var t=e.longitude,n=e.latitude;return new a.Z(t,n,0)})),function(e){if(Array.isArray(e))return d(e)}(n)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||function(e,t){if(e){if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())).surfaceDistance}function b(e,t){return(null==e?void 0:e.length)<2?0:e.reduce((function(n,i,o){return e[o-1]?n+(t?Z(i,e[o-1]):r.Z.distance(i,e[o-1])):n}),0)}function w(e){return Math.sign(a.Z.fromCartesian(e[1]).height-a.Z.fromCartesian(e[0]).height)}function x(e,t){var n=a.Z.fromCartesian(e),r=n.longitude,o=n.latitude,l=n.height;return[i.Z.toDegrees(r),i.Z.toDegrees(o),null!=t?t:l]}function D(e,t){var n=e.map((function(e){return a.Z.fromCartesian(e)})),r=t?t(n):0;return n.map((function(e){var t=e.longitude,n=e.latitude;return a.Z.toCartesian(new a.Z(t,n,r))}))}},382582:function(e){e.exports=function(){"use strict";function e(e,r,i,o,a){!function e(n,r,i,o,a){for(;o>i;){if(o-i>600){var l=o-i+1,u=r-i+1,c=Math.log(l),s=.5*Math.exp(2*c/3),f=.5*Math.sqrt(c*s*(l-s)/l)*(u-l/2<0?-1:1);e(n,r,Math.max(i,Math.floor(r-u*s/l+f)),Math.min(o,Math.floor(r+(l-u)*s/l+f)),a)}var d=n[r],h=i,p=o;for(t(n,i,r),a(n[o],d)>0&&t(n,i,o);h<p;){for(t(n,h,p),h++,p--;a(n[h],d)<0;)h++;for(;a(n[p],d)>0;)p--}0===a(n[i],d)?t(n,i,p):t(n,++p,o),p<=r&&(i=p+1),r<=p&&(o=p-1)}}(e,r,i||0,o||e.length-1,a||n)}function t(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function n(e,t){return e<t?-1:e>t?1:0}var r=function(e){void 0===e&&(e=9),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function i(e,t,n){if(!n)return t.indexOf(e);for(var r=0;r<t.length;r++)if(n(e,t[r]))return r;return-1}function o(e,t){a(e,0,e.children.length,t,e)}function a(e,t,n,r,i){i||(i=p(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o=t;o<n;o++){var a=e.children[o];l(i,e.leaf?r(a):a)}return i}function l(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function u(e,t){return e.minX-t.minX}function c(e,t){return e.minY-t.minY}function s(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function f(e){return e.maxX-e.minX+(e.maxY-e.minY)}function d(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function h(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function p(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function m(t,n,r,i,o){for(var a=[n,r];a.length;)if(!((r=a.pop())-(n=a.pop())<=i)){var l=n+Math.ceil((r-n)/i/2)*i;e(t,l,n,r,o),a.push(n,l,l,r)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(e){var t=this.data,n=[];if(!h(e,t))return n;for(var r=this.toBBox,i=[];t;){for(var o=0;o<t.children.length;o++){var a=t.children[o],l=t.leaf?r(a):a;h(e,l)&&(t.leaf?n.push(a):d(e,l)?this._all(a,n):i.push(a))}t=i.pop()}return n},r.prototype.collides=function(e){var t=this.data;if(!h(e,t))return!1;for(var n=[];t;){for(var r=0;r<t.children.length;r++){var i=t.children[r],o=t.leaf?this.toBBox(i):i;if(h(e,o)){if(t.leaf||d(e,o))return!0;n.push(i)}}t=n.pop()}return!1},r.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var n=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},r.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},r.prototype.clear=function(){return this.data=p([]),this},r.prototype.remove=function(e,t){if(!e)return this;for(var n,r,o,a=this.data,l=this.toBBox(e),u=[],c=[];a||u.length;){if(a||(a=u.pop(),r=u[u.length-1],n=c.pop(),o=!0),a.leaf){var s=i(e,a.children,t);if(-1!==s)return a.children.splice(s,1),u.push(a),this._condense(u),this}o||a.leaf||!d(a,l)?r?(n++,a=r.children[n],o=!1):a=null:(u.push(a),c.push(n),n=0,r=a,a=a.children[0])}return this},r.prototype.toBBox=function(e){return e},r.prototype.compareMinX=function(e,t){return e.minX-t.minX},r.prototype.compareMinY=function(e,t){return e.minY-t.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(e){return this.data=e,this},r.prototype._all=function(e,t){for(var n=[];e;)e.leaf?t.push.apply(t,e.children):n.push.apply(n,e.children),e=n.pop();return t},r.prototype._build=function(e,t,n,r){var i,a=n-t+1,l=this._maxEntries;if(a<=l)return o(i=p(e.slice(t,n+1)),this.toBBox),i;r||(r=Math.ceil(Math.log(a)/Math.log(l)),l=Math.ceil(a/Math.pow(l,r-1))),(i=p([])).leaf=!1,i.height=r;var u=Math.ceil(a/l),c=u*Math.ceil(Math.sqrt(l));m(e,t,n,c,this.compareMinX);for(var s=t;s<=n;s+=c){var f=Math.min(s+c-1,n);m(e,s,f,u,this.compareMinY);for(var d=s;d<=f;d+=u){var h=Math.min(d+u-1,f);i.children.push(this._build(e,d,h,r-1))}}return o(i,this.toBBox),i},r.prototype._chooseSubtree=function(e,t,n,r){for(;r.push(t),!t.leaf&&r.length-1!==n;){for(var i=1/0,o=1/0,a=void 0,l=0;l<t.children.length;l++){var u=t.children[l],c=s(u),f=(d=e,h=u,(Math.max(h.maxX,d.maxX)-Math.min(h.minX,d.minX))*(Math.max(h.maxY,d.maxY)-Math.min(h.minY,d.minY))-c);f<o?(o=f,i=c<i?c:i,a=u):f===o&&c<i&&(i=c,a=u)}t=a||t.children[0]}var d,h;return t},r.prototype._insert=function(e,t,n){var r=n?e:this.toBBox(e),i=[],o=this._chooseSubtree(r,this.data,t,i);for(o.children.push(e),l(o,r);t>=0&&i[t].children.length>this._maxEntries;)this._split(i,t),t--;this._adjustParentBBoxes(r,i,t)},r.prototype._split=function(e,t){var n=e[t],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);var a=this._chooseSplitIndex(n,i,r),l=p(n.children.splice(a,n.children.length-a));l.height=n.height,l.leaf=n.leaf,o(n,this.toBBox),o(l,this.toBBox),t?e[t-1].children.push(l):this._splitRoot(n,l)},r.prototype._splitRoot=function(e,t){this.data=p([e,t]),this.data.height=e.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(e,t,n){for(var r,i,o,l,u,c,f,d=1/0,h=1/0,p=t;p<=n-t;p++){var m=a(e,0,p,this.toBBox),v=a(e,p,n,this.toBBox),g=(i=m,o=v,void 0,void 0,void 0,void 0,l=Math.max(i.minX,o.minX),u=Math.max(i.minY,o.minY),c=Math.min(i.maxX,o.maxX),f=Math.min(i.maxY,o.maxY),Math.max(0,c-l)*Math.max(0,f-u)),y=s(m)+s(v);g<d?(d=g,r=p,h=y<h?y:h):g===d&&y<h&&(h=y,r=p)}return r||n-t},r.prototype._chooseSplitAxis=function(e,t,n){var r=e.leaf?this.compareMinX:u,i=e.leaf?this.compareMinY:c;this._allDistMargin(e,t,n,r)<this._allDistMargin(e,t,n,i)&&e.children.sort(r)},r.prototype._allDistMargin=function(e,t,n,r){e.children.sort(r);for(var i=this.toBBox,o=a(e,0,t,i),u=a(e,n-t,n,i),c=f(o)+f(u),s=t;s<n-t;s++){var d=e.children[s];l(o,e.leaf?i(d):d),c+=f(o)}for(var h=n-t-1;h>=t;h--){var p=e.children[h];l(u,e.leaf?i(p):p),c+=f(u)}return c},r.prototype._adjustParentBBoxes=function(e,t,n){for(var r=n;r>=0;r--)l(t[r],e)},r.prototype._condense=function(e){for(var t=e.length-1,n=void 0;t>=0;t--)0===e[t].children.length?t>0?(n=e[t-1].children).splice(n.indexOf(e[t]),1):this.clear():o(e[t],this.toBBox)},r}()}}]);